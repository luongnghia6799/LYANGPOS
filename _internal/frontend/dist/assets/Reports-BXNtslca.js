import{r as n,j as e,a1 as Re}from"./vendor-C23Namvk.js";import{a as g}from"./vendor-utils-C44aPrMG.js";import{c as f,b as H,f as re,P as ne}from"./index-UsWd1F3S.js";import{O as Me}from"./OrderEditPopup-D_7BTVt5.js";import{C as je,$ as ke,X as ve,u as Ue,b as Fe,aa as fe,ah as Ge,q as Qe,d as Ke,m as We,c as ye,W as Ye,U as Ve,T as Xe,v as Je,ar as Ze,a7 as et,i as tt}from"./vendor-icons-B3K5gD8o.js";import{A as Q,m as h}from"./vendor-framer-DVZK1f_z.js";import"./Toast-DQljrx14.js";function xe({options:a,value:p,onChange:u,placeholder:A="Chọn...",className:y,searchPlaceholder:Y="Tìm kiếm...",displayValue:c,valueKey:b="id",disabled:m=!1}){const[j,N]=n.useState(!1),[B,w]=n.useState(""),[z,P]=n.useState(0),D=n.useRef(null),$=n.useRef(null),k=n.useRef(null),i=a.filter(l=>{if(!B)return!0;const o=typeof c=="function"?c(l):c?l[c]:l;return String(o).toLowerCase().includes(B.toLowerCase())});n.useEffect(()=>{j?(P(0),setTimeout(()=>$.current?.focus(),100)):w("")},[j]),n.useEffect(()=>{const l=o=>{D.current&&!D.current.contains(o.target)&&N(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),n.useEffect(()=>{j&&k.current&&k.current.children[z]&&k.current.children[z].scrollIntoView({behavior:"smooth",block:"nearest"})},[z,j]);const d=l=>{if(!j){(l.key==="Enter"||l.key==="ArrowDown"||l.key===" ")&&(N(!0),l.preventDefault());return}switch(l.key){case"ArrowDown":l.preventDefault(),P(o=>o<i.length-1?o+1:0);break;case"ArrowUp":l.preventDefault(),P(o=>o>0?o-1:i.length-1);break;case"Enter":l.preventDefault(),i[z]&&S(i[z]);break;case"Escape":l.preventDefault(),N(!1);break;case"Tab":N(!1);break}},S=l=>{const o=b&&typeof l=="object"?l[b]:l;u(o),N(!1)},V=l=>l?typeof c=="function"?c(l):c?l[c]:l:"",R=a.find(l=>b&&typeof l=="object"?l[b]==p:l===p);return e.jsxs("div",{className:f("relative min-w-[150px]",y),ref:D,children:[e.jsxs("button",{type:"button",onClick:()=>!m&&N(!j),onKeyDown:d,disabled:m,className:f("flex items-center justify-between w-full px-3 py-2 text-xs font-black bg-emerald-50/50 dark:bg-slate-800 border-none rounded-xl outline-none dark:text-emerald-400 transition-all text-left",m?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-emerald-100/50 dark:hover:bg-slate-700"),children:[e.jsx("span",{className:"truncate mr-2",children:R?V(R):A}),e.jsx(je,{size:14,className:"flex-shrink-0 text-emerald-600/50"})]}),e.jsx(Q,{children:j&&e.jsxs(h.div,{initial:{opacity:0,y:5,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:5,scale:.95},transition:{duration:.1},className:"absolute top-full left-0 z-50 w-full min-w-[200px] mt-1 bg-white dark:bg-slate-900 border dark:border-slate-700 rounded-xl shadow-xl overflow-hidden",children:[e.jsx("div",{className:"p-2 border-b dark:border-slate-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{size:14,className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{ref:$,type:"text",value:B,onChange:l=>w(l.target.value),onKeyDown:d,placeholder:Y,autoComplete:"off",className:"w-full pl-7 pr-2 py-1.5 text-xs bg-gray-50 dark:bg-slate-800 rounded-lg outline-none border-none dark:text-white font-bold"}),B&&e.jsx("button",{onClick:()=>{w(""),$.current?.focus()},className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500",children:e.jsx(ve,{size:12})})]})}),e.jsxs("ul",{ref:k,className:"max-h-60 overflow-y-auto no-scrollbar py-1",children:[e.jsx("li",{className:f("px-3 py-2 text-xs font-bold cursor-pointer transition-colors flex items-center justify-between",p?"hover:bg-gray-50 dark:hover:bg-slate-800 text-gray-700 dark:text-gray-300":"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600"),onClick:()=>S(""),children:A}),i.length>0?i.map((l,o)=>{const K=b&&typeof l=="object"?l[b]==p:l===p,M=o===z;return e.jsx("li",{onClick:()=>S(l),onMouseEnter:()=>P(o),className:f("px-3 py-2 text-xs font-bold cursor-pointer transition-colors truncate",K?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600":"text-gray-700 dark:text-gray-300",M&&!K&&"bg-gray-50 dark:bg-slate-800"),children:V(l)},b&&typeof l=="object"?l[b]:o)}):e.jsx("li",{className:"px-3 py-4 text-center text-xs text-gray-400",children:"Không tìm thấy kết quả"})]})]})})]})}const pe=({label:a,value:p,color:u,icon:A})=>e.jsxs("div",{className:"relative overflow-hidden bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl p-6 rounded-3xl shadow-lg border-2 border-[#d4a574]/30 group transition-all duration-500 hover:-translate-y-1",children:[e.jsx("div",{className:`absolute top-0 right-0 w-24 h-24 ${u} opacity-5 rounded-bl-full -mr-8 -mt-8`}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-4 rounded-2xl ${u} shadow-lg`,children:e.jsx(A,{size:24,className:"text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black text-[#8b6f47] dark:text-[#d4a574] uppercase tracking-[0.2em]",children:a}),e.jsx("h3",{className:"text-3xl font-black text-[#2d5016] dark:text-white tracking-tighter mt-1",children:p})]})]})]});function it(){Re();const[a,p]=n.useState("products"),[u,A]=n.useState(new Date().getFullYear()),[y,Y]=n.useState(new Date().getMonth()+1),[c,b]=n.useState(""),[m,j]=n.useState(new Date().getDate()),[N,B]=n.useState([]),[w,z]=n.useState(""),[P,D]=n.useState(!1),[$,k]=n.useState(!1),[i,d]=n.useState(1),[S,V]=n.useState(30),[R,l]=n.useState(0),[o,K]=n.useState(1),[M,ue]=n.useState(a==="products"?"revenue":"total_amount"),[X,le]=n.useState("desc"),[Ne,we]=n.useState([]),[W,Se]=n.useState(""),[v,Ce]=n.useState(null),[me,he]=n.useState([]),[J,Z]=n.useState(!1),[U,Te]=n.useState(1),[de,be]=n.useState(1),[_e]=n.useState(20),[ee,te]=n.useState(null),[C,Ie]=n.useState("Sale"),[E,ze]=n.useState(""),[L,Pe]=n.useState(""),[F,De]=n.useState(""),[G,Ee]=n.useState(""),[Le,Oe]=n.useState([]),[He,Be]=n.useState([]),ge=[];for(let t=2023;t<=new Date().getFullYear()+1;t++)ge.push(t);n.useEffect(()=>{d(1),ue(a==="products"?"revenue":"total_amount"),le("desc")},[a]),n.useEffect(()=>{oe()},[a,u,y,m,c,i,S,M,X,w,W,C,E,L,F,G]),n.useEffect(()=>{$e()},[]);const $e=async()=>{try{const t=await g.get("/api/products/brands");we(t.data);const s=await g.get("/api/partners");Oe(s.data);const r=await g.get("/api/products");Be(r.data)}catch(t){console.error(t)}};n.useEffect(()=>{const t=s=>{s.key==="Escape"&&(k(!1),Z(!1),te(null))};if(window.addEventListener("keydown",t),$||J||ee||P){document.body.style.overflow="hidden";const s=document.getElementById("main-content");s&&(s.style.overflow="hidden")}else{document.body.style.overflow="";const s=document.getElementById("main-content");s&&(s.style.overflow="auto")}return()=>{window.removeEventListener("keydown",t),document.body.style.overflow="";const s=document.getElementById("main-content");s&&(s.style.overflow="auto")}},[$,J,ee,P]);const oe=async()=>{D(!0);try{let t;const s=new URLSearchParams({year:u,month:y,day:m,quarter:c,page:i,limit:S,sort_by:M,sort_order:X,search:w,brand:W});a==="products"?t=await g.get(`/api/reports/products?${s.toString()}`):a==="customers"?(s.append("type","Customer"),t=await g.get(`/api/reports/partners?${s.toString()}`)):a==="suppliers"?(s.append("type","Supplier"),t=await g.get(`/api/reports/partners?${s.toString()}`)):a==="synthesis"&&(s.append("type",C),E&&s.append("start_date",E),L&&s.append("end_date",L),F&&s.append("partner_id",F),G&&s.append("product_id",G),t=await g.get(`/api/reports/synthesis?${s.toString()}`)),t.data.items?(B(t.data.items),l(t.data.total),K(t.data.pages)):(B(t.data),l(t.data.length),K(1))}catch(t){console.error("Lỗi tải báo cáo:",t)}finally{D(!1)}},T=t=>{M===t?le(X==="asc"?"desc":"asc"):(ue(t),le("desc")),d(1)},_=({field:t})=>M!==t?e.jsx(et,{size:14,className:"ml-1 opacity-20 group-hover:opacity-50 transition-all"}):X==="asc"?e.jsx(tt,{size:14,className:"ml-1 text-[#4a7c59]"}):e.jsx(je,{size:14,className:"ml-1 text-[#4a7c59]"}),[I,qe]=n.useState({revenue:0,profit:0,count:0});n.useEffect(()=>{(async()=>{try{const s=new URLSearchParams({year:u,month:y,day:m,quarter:c,search:w,brand:W});let r;a==="products"?r=await g.get(`/api/reports/products?${s.toString()}`):a==="synthesis"?(s.append("type",C),E&&s.append("start_date",E),L&&s.append("end_date",L),F&&s.append("partner_id",F),G&&s.append("product_id",G),r=await g.get(`/api/reports/synthesis?${s.toString()}`)):(s.append("type",a==="customers"?"Customer":"Supplier"),r=await g.get(`/api/reports/partners?${s.toString()}`));const x=r.data.items||r.data,ie=a==="synthesis"?0:x.reduce((q,O)=>q+(O.revenue||O.total_amount||0),0),se=a==="products"||a==="customers"?x.reduce((q,O)=>q+(O.profit||0),0):0;let ce;a==="synthesis"?ce=x.reduce((q,O)=>q+(O.quantity||0),0):ce=a==="products"?x.length:x.reduce((q,O)=>q+(O.count||0),0),qe({revenue:ie,profit:se,count:ce})}catch(s){console.error(s)}})()},[a,u,y,m,c,w,W]);const ae=async(t,s=1)=>{Ce(t),Te(s),D(!0);try{const r=new URLSearchParams({year:u,month:y,day:m,quarter:c,page:s,limit:_e});a==="products"?(r.append("product_id",t.id),r.append("type","Sale")):a==="synthesis"?(r.append("type",C),t.product_id&&r.append("product_id",t.product_id),t.partner_id!==void 0&&t.partner_id!==null?r.append("partner_id",t.partner_id):r.append("partner_id","0"),E&&r.append("start_date",E),L&&r.append("end_date",L)):(r.append("partner_id",t.id),r.append("type",a==="customers"?"Sale":"Purchase"));const x=await g.get(`/api/orders?${r.toString()}`);x.data.items?(he(x.data.items),be(x.data.pages)):(he(x.data),be(1)),Z(!0)}catch(r){console.error(r)}finally{D(!1)}},Ae=()=>{if(!document.getElementById("summary-modal-content"))return;const s=document.createElement("iframe");s.style.position="fixed",s.style.right="0",s.style.bottom="0",s.style.width="0",s.style.height="0",s.style.border="none",document.body.appendChild(s);const r=s.contentWindow.document;r.open(),r.write(`
            <html>
                <head>
                    <title>Báo cáo vụ mùa</title>
                    <style>
                        @page { size: auto; margin: 15mm; }
                        body { margin: 0; padding: 0; font-family: sans-serif; }
                        h2 { text-transform: uppercase; color: #065f46; border-bottom: 2px solid #065f46; padding-bottom: 10px; }
                        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
                        .stat-item { border: 1px solid #e2e8f0; padding: 15px; border-radius: 10px; }
                        .stat-label { font-size: 10px; font-weight: bold; text-transform: uppercase; color: #64748b; }
                        .stat-value { font-size: 20px; font-weight: 900; color: #0f172a; margin-top: 5px; }
                        .no-print { display: none !important; }
                    </style>
                </head>
                <body>
                    \${modal.innerHTML}
                </body>
            </html>
        `),r.close(),document.querySelectorAll("style").forEach(ie=>{const se=r.createElement("style");se.textContent=ie.textContent,r.head.appendChild(se)}),setTimeout(()=>{s.contentWindow.focus(),s.contentWindow.print(),document.body.removeChild(s)},300)};return e.jsxs("div",{className:"p-4 md:p-8 pb-20 w-full max-w-[98%] mx-auto transition-colors",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black text-[#2d5016] dark:text-[#4a7c59] uppercase tracking-tight flex items-center gap-3 py-1",children:[e.jsx(Ue,{size:36,className:"text-[#4a7c59]"}),"BÁO CÁO VỤ MÙA"]}),e.jsx("p",{className:"text-[#8b6f47] dark:text-[#d4a574]/60 font-medium tracking-tight",children:"Số liệu doanh thu và hiệu quả sản xuất"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 bg-white/80 dark:bg-slate-900/80 border border-emerald-50 dark:border-emerald-800/50 p-2 rounded-2xl shadow-sm transition-all hover:shadow-lg backdrop-blur-md",children:[a==="synthesis"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-600/60",children:"Từ:"}),e.jsx("input",{type:"date",value:E,onChange:t=>{ze(t.target.value),d(1)},className:"bg-transparent border-none outline-none font-bold text-xs text-gray-800 dark:text-white uppercase"}),e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-600/60",children:"Đến:"}),e.jsx("input",{type:"date",value:L,onChange:t=>{Pe(t.target.value),d(1)},className:"bg-transparent border-none outline-none font-bold text-xs text-gray-800 dark:text-white uppercase"})]}),e.jsx("div",{className:"w-px h-6 bg-gray-200 dark:bg-slate-700 mx-1"})]}),e.jsx(Fe,{size:20,className:"ml-2 text-emerald-500"}),e.jsxs("select",{value:m,onChange:t=>{j(t.target.value),d(1)},className:"bg-transparent border-none outline-none font-black text-sm text-gray-800 dark:text-white cursor-pointer uppercase",children:[e.jsx("option",{value:"",children:"Ngày: Tất cả"}),[...Array(31)].map((t,s)=>e.jsx("option",{value:s+1,children:s+1},s+1))]}),e.jsx("div",{className:"w-px h-6 bg-gray-200 dark:bg-slate-700 mx-1"}),e.jsxs("select",{value:y,onChange:t=>{Y(t.target.value),b(""),d(1)},className:"bg-transparent border-none outline-none font-black text-sm text-gray-800 dark:text-white cursor-pointer uppercase",children:[e.jsx("option",{value:"",children:"Tháng: Tất cả"}),[...Array(12)].map((t,s)=>e.jsx("option",{value:s+1,children:s+1},s+1))]}),e.jsx("div",{className:"w-px h-6 bg-gray-200 dark:bg-slate-700 mx-1"}),e.jsxs("select",{value:c,onChange:t=>{b(t.target.value),Y(""),j(""),d(1)},className:"bg-transparent border-none outline-none font-black text-sm text-gray-800 dark:text-white cursor-pointer uppercase",children:[e.jsx("option",{value:"",children:"Quý: Tất cả"}),e.jsx("option",{value:"1",children:"Quý 1"}),e.jsx("option",{value:"2",children:"Quý 2"}),e.jsx("option",{value:"3",children:"Quý 3"}),e.jsx("option",{value:"4",children:"Quý 4"})]}),e.jsx("div",{className:"w-px h-6 bg-gray-200 dark:bg-slate-700 mx-1"}),e.jsx("select",{value:u,onChange:t=>{A(parseInt(t.target.value)),d(1)},className:"bg-transparent border-none outline-none font-black text-sm text-gray-800 dark:text-white cursor-pointer pr-4 uppercase",children:ge.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>oe(),className:"p-3 bg-white dark:bg-slate-800 text-emerald-600 rounded-2xl border border-emerald-100 dark:border-slate-800 hover:bg-emerald-50 transition-all shadow-sm glow-hover",title:"Tải lại dữ liệu",children:e.jsx(fe,{size:20})}),e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-2 bg-rose-600 hover:bg-rose-700 text-white px-6 py-3 rounded-2xl font-black shadow-lg shadow-rose-200 dark:shadow-none active:scale-95 transition-all glow-hover",children:[e.jsx(Ge,{size:20})," XUẤT BÁO CÁO"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(pe,{label:a==="synthesis"?"Tổng số lượng hàng":"Tổng doanh thu",value:a==="synthesis"?H(I.count):re(I.revenue),color:"bg-[#4a7c59]",icon:a==="synthesis"?Qe:Ke}),e.jsx(pe,{label:a==="synthesis"?"Loại báo cáo":"Tổng lợi nhuận",value:a==="synthesis"?C==="Sale"?"Hàng Bán":"Hàng Nhập":re(I.profit),color:"bg-[#2d5016]",icon:We}),e.jsx(pe,{label:"Số lượng giao dịch",value:a==="synthesis"?"-":I.count,color:"bg-[#f4c430]",icon:ye})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-slate-900/60 backdrop-blur-md rounded-2xl shadow-xl border-2 border-[#d4a574]/30 overflow-hidden",children:[e.jsxs("div",{className:"flex p-2 bg-gradient-to-r from-[#faf8f3]/50 to-[#f5f1e8]/50 dark:from-slate-900 dark:to-slate-800 gap-2 relative",children:[e.jsxs("button",{onClick:()=>p("products"),className:f("relative z-10 flex-1 py-4 font-black uppercase tracking-widest text-xs flex items-center justify-center gap-2 transition-all rounded-2xl",a==="products"?"text-white":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:[e.jsx(Ye,{size:18})," SẢN PHẨM",a==="products"&&e.jsx(h.div,{layoutId:"reportsTabIndicator",className:"absolute inset-0 bg-gradient-to-r from-[#2d5016] to-[#4a7c59] rounded-2xl -z-10 shadow-lg",transition:{type:"spring",bounce:.2,duration:.6}})]}),e.jsxs("button",{onClick:()=>p("customers"),className:f("relative z-10 flex-1 py-4 font-black uppercase tracking-widest text-xs flex items-center justify-center gap-2 transition-all rounded-2xl",a==="customers"?"text-white":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:[e.jsx(Ve,{size:18})," KHÁCH HÀNG",a==="customers"&&e.jsx(h.div,{layoutId:"reportsTabIndicator",className:"absolute inset-0 bg-gradient-to-r from-[#2d5016] to-[#4a7c59] rounded-2xl -z-10 shadow-lg",transition:{type:"spring",bounce:.2,duration:.6}})]}),e.jsxs("button",{onClick:()=>p("suppliers"),className:f("relative z-10 flex-1 py-4 font-black uppercase tracking-widest text-xs flex items-center justify-center gap-2 transition-all rounded-2xl",a==="suppliers"?"text-white":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:[e.jsx(Xe,{size:18})," NHÀ CUNG CẤP",a==="suppliers"&&e.jsx(h.div,{layoutId:"reportsTabIndicator",className:"absolute inset-0 bg-gradient-to-r from-[#2d5016] to-[#4a7c59] rounded-2xl -z-10 shadow-lg",transition:{type:"spring",bounce:.2,duration:.6}})]}),e.jsxs("button",{onClick:()=>p("synthesis"),className:f("relative z-10 flex-1 py-4 font-black uppercase tracking-widest text-xs flex items-center justify-center gap-2 transition-all rounded-2xl",a==="synthesis"?"text-white":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:[e.jsx(Je,{size:18})," TỔNG HỢP",a==="synthesis"&&e.jsx(h.div,{layoutId:"reportsTabIndicator",className:"absolute inset-0 bg-gradient-to-r from-[#2d5016] to-[#4a7c59] rounded-2xl -z-10 shadow-lg",transition:{type:"spring",bounce:.2,duration:.6}})]})]}),e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-900 border-b dark:border-emerald-900/30 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(ke,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-emerald-500/50",size:18}),e.jsx("input",{type:"text",placeholder:"Tìm kiếm trong vụ mùa...",className:"w-full pl-12 pr-4 py-3 bg-white dark:bg-slate-950 border-2 border-emerald-50 dark:border-emerald-900/30 rounded-2xl outline-none focus:border-emerald-500 font-bold text-sm transition-all dark:text-emerald-50",value:w,onChange:t=>{z(t.target.value),d(1)}})]}),a==="synthesis"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full md:w-auto",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-600/40",children:"Loại:"}),e.jsxs("select",{value:C,onChange:t=>{Ie(t.target.value),d(1)},className:"bg-emerald-50/50 dark:bg-slate-800 border-none rounded-xl px-2 py-2 text-xs font-black outline-none dark:text-emerald-400 cursor-pointer",children:[e.jsx("option",{value:"Sale",children:"Hàng Bán"}),e.jsx("option",{value:"Purchase",children:"Hàng Nhập"})]}),e.jsx(xe,{placeholder:"Tất cả đối tác",options:[{id:"0",name:C==="Sale"?"KHÁCH LẺ":"NCC VÃNG LAI"},...Le.filter(t=>!C||(C==="Sale"?t.is_customer:t.is_supplier))],value:F,onChange:t=>{De(t),d(1)},displayValue:"name",valueKey:"id",className:"w-48"}),e.jsx(xe,{placeholder:"Tất cả hàng hóa",options:He,value:G,onChange:t=>{Ee(t),d(1)},displayValue:"name",valueKey:"id",className:"w-48"}),e.jsx(xe,{placeholder:"Tất cả hãng",options:Ne,value:W,onChange:t=>{Se(t),d(1)},displayValue:t=>t,valueKey:null,className:"w-48"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-600/40",children:"Dòng:"}),e.jsxs("select",{value:S,onChange:t=>{V(parseInt(t.target.value)),d(1)},className:"bg-white/80 dark:bg-slate-950/80 border-2 border-emerald-50 dark:border-emerald-900/30 rounded-xl px-4 py-2 text-xs font-black outline-none dark:text-emerald-400 focus:ring-4 focus:ring-emerald-500/10 transition-all cursor-pointer shadow-sm",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"p-4 overflow-x-auto no-scrollbar min-h-[400px]",children:e.jsx(Q,{mode:"wait",children:e.jsx(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gradient-to-r from-[#2d5016]/10 via-[#4a7c59]/8 to-[#2d5016]/10",children:a==="synthesis"?e.jsxs(e.Fragment,{children:[e.jsxs("th",{onClick:()=>T("partner_name"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:["ĐỐI TÁC ",e.jsx(_,{field:"partner_name"})]}),e.jsxs("th",{onClick:()=>T("product_name"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:["SẢN PHẨM ",e.jsx(_,{field:"product_name"})]}),e.jsxs("th",{onClick:()=>T("brand"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:["HÃNG ",e.jsx(_,{field:"brand"})]}),e.jsx("th",{className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-center border-b-2 border-[#d4a574]/40",children:"ĐVT"}),e.jsxs("th",{onClick:()=>T("quantity"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-center cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:["SỐ LƯỢNG ",e.jsx(_,{field:"quantity"})]}),e.jsxs("th",{onClick:()=>T("revenue"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-right cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:["THÀNH TIỀN ",e.jsx(_,{field:"revenue"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{onClick:()=>T("name"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:e.jsxs("div",{className:"flex items-center",children:["TÊN ",a==="products"?"SẢN PHẨM":"ĐỐI TÁC"," ",e.jsx(_,{field:"name"})]})}),a==="products"&&e.jsx("th",{className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-center border-b-2 border-[#d4a574]/40",children:"ĐVT"}),e.jsx("th",{onClick:()=>T(a==="products"?"quantity":"count"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-center cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:e.jsxs("div",{className:"flex items-center justify-center",children:[a==="products"?"SỐ LƯỢNG":"SỐ ĐƠN"," ",e.jsx(_,{field:a==="products"?"quantity":"count"})]})}),e.jsx("th",{onClick:()=>T(a==="products"?"revenue":"total_amount"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-right cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:e.jsxs("div",{className:"flex items-center justify-end",children:["DOANH THU ",e.jsx(_,{field:a==="products"?"revenue":"total_amount"})]})}),a!=="suppliers"&&e.jsx("th",{onClick:()=>T("profit"),className:"p-4 text-[10px] font-black uppercase tracking-widest text-[#2d5016] dark:text-[#d4a574] text-right cursor-pointer hover:text-[#4a7c59] transition-colors group border-b-2 border-[#d4a574]/40",children:e.jsxs("div",{className:"flex items-center justify-end",children:["LỢI NHUẬN ",e.jsx(_,{field:"profit"})]})})]})})}),e.jsx("tbody",{className:"divide-y dark:divide-emerald-950/30",children:N.length>0?N.map((t,s)=>e.jsxs("tr",{onClick:()=>ae(t),className:"hover:bg-emerald-50/30 dark:hover:bg-emerald-950/20 transition-all group cursor-pointer",children:[a==="synthesis"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-4 font-black text-gray-900 dark:text-emerald-50 text-xs",children:t.partner_name}),e.jsx("td",{className:"p-4 font-bold text-gray-700 dark:text-gray-300 text-xs",children:t.product_name}),e.jsx("td",{className:"p-4 font-bold text-gray-500 text-[10px] uppercase",children:t.brand}),e.jsx("td",{className:"p-4 text-center font-bold text-gray-400 text-xs",children:t.unit})]}):e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-black text-gray-900 dark:text-emerald-50 uppercase text-xs tracking-tight group-hover:text-emerald-600 transition-colors",children:t.name}),a==="products"&&t.brand&&e.jsx("div",{className:"text-[9px] text-gray-400 font-bold uppercase",children:t.brand})]}),a==="products"&&a!=="synthesis"&&e.jsx("td",{className:"p-4 text-center font-bold text-gray-400 text-xs",children:t.unit}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:"bg-emerald-100/50 dark:bg-emerald-900/30 px-3 py-1 rounded-lg font-black text-emerald-700 dark:text-emerald-400 text-xs",children:H(t.quantity||t.count)})}),(a!=="products"||a==="synthesis")&&e.jsx("td",{className:"p-4 text-right font-black text-emerald-600 dark:text-emerald-400 text-base",children:H(t.revenue||t.total_amount)}),a==="products"&&e.jsx("td",{className:"p-4 text-right font-black text-emerald-600 dark:text-emerald-400 text-base",children:H(t.revenue)}),a!=="suppliers"&&a!=="synthesis"&&e.jsxs("td",{className:"p-4 text-right",children:[e.jsx("div",{className:f("font-black text-sm",t.profit>0?"text-emerald-600":"text-rose-500"),children:H(t.profit)}),e.jsxs("div",{className:"text-[9px] text-gray-400 font-black uppercase",children:[(t.revenue||t.total_amount)>0?(t.profit/(t.revenue||t.total_amount)*100).toFixed(1):0,"% LÃI"]})]})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-20 text-center text-emerald-600/30 font-black uppercase tracking-widest text-xs",children:"Không có dữ liệu thu hoạch"})})})]})},a+i)})}),e.jsxs("div",{className:"p-6 bg-gradient-to-r from-[#faf8f3]/50 to-[#f5f1e8]/50 dark:bg-[#2d5016]/5 border-t-2 border-[#d4a574]/20 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-[10px] font-black text-[#8b6f47] uppercase tracking-widest",children:["Hiển thị ",e.jsxs("span",{className:"text-[#2d5016] dark:text-[#4a7c59]",children:[(i-1)*S+1," - ",Math.min(i*S,R)]})," trên ",e.jsx("span",{className:"text-[#2d5016] dark:text-[#4a7c59]",children:R})," kết quả"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{disabled:i===1,onClick:()=>d(t=>Math.max(1,t-1)),className:"px-5 py-2.5 border-2 border-[#d4a574]/30 rounded-2xl text-[10px] font-black uppercase tracking-widest disabled:opacity-30 hover:bg-[#d4a574]/10 transition-all text-[#2d5016] dark:text-[#d4a574]",children:"Trước"}),[...Array(o)].map((t,s)=>{const r=s+1;return r===1||r===o||r>=i-2&&r<=i+2?e.jsx("button",{onClick:()=>d(r),className:f("w-10 h-10 rounded-2xl text-[10px] font-black transition-all",i===r?"bg-gradient-to-r from-[#2d5016] to-[#4a7c59] text-white shadow-lg shadow-[#2d5016]/30":"hover:bg-[#d4a574]/10 text-[#8b6f47] dark:text-[#d4a574]/60 border-2 border-[#d4a574]/30"),children:r},r):r===i-3||r===i+3?e.jsx("span",{className:"px-1 text-[#d4a574]",children:"..."},r):null}),e.jsx("button",{disabled:i===o,onClick:()=>d(t=>Math.min(o,t+1)),className:"px-5 py-2.5 border-2 border-[#d4a574]/30 rounded-2xl text-[10px] font-black uppercase tracking-widest disabled:opacity-30 hover:bg-[#d4a574]/10 transition-all text-[#2d5016] dark:text-[#d4a574]",children:"Sau"})]})]})]}),e.jsx(ne,{children:e.jsx(Q,{children:$&&e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4 overflow-y-auto bg-slate-900/40 backdrop-blur-sm",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0",onClick:()=>k(!1)}),e.jsxs(h.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10,filter:"blur(10px)"},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-slate-900 w-full max-w-2xl rounded-[3rem] shadow-2xl overflow-hidden border border-white dark:border-emerald-900/30 relative z-10",children:[e.jsxs("div",{id:"summary-modal-content",children:[e.jsxs("div",{className:"p-8 border-b dark:border-emerald-900/30 flex justify-between items-center bg-emerald-50/50 dark:bg-emerald-950/20",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-emerald-600 dark:text-emerald-400 uppercase tracking-tighter",children:"Báo cáo kết sổ vụ mùa"}),e.jsxs("p",{className:"text-[10px] text-emerald-800/40 font-black uppercase tracking-widest",children:[m&&`Ngày ${m} `,y&&`Tháng ${y} `,c&&`Quý ${c} `," Năm ",u]})]}),e.jsx("button",{onClick:()=>k(!1),className:"p-3 hover:bg-white dark:hover:bg-slate-800 rounded-2xl transition-all text-emerald-600 no-print",children:e.jsx(fe,{size:24})})]}),e.jsxs("div",{className:"p-10 space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-800/30 uppercase tracking-[0.2em]",children:"Doanh thu"}),e.jsx("p",{className:"text-4xl font-black text-emerald-600 tracking-tighter",children:re(I.revenue)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-black text-emerald-800/30 uppercase tracking-[0.2em]",children:"Lợi nhuận"}),e.jsx("p",{className:"text-4xl font-black text-amber-500 tracking-tighter",children:re(I.profit)})]})]}),e.jsxs("div",{className:"p-8 bg-emerald-50/30 dark:bg-emerald-950/10 rounded-[2rem] border-2 border-emerald-50 dark:border-emerald-900/20",children:[e.jsx("h4",{className:"text-[10px] font-black text-emerald-600 uppercase mb-4 tracking-[0.3em]",children:"Chi tiết vụ mùa"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"justify-between flex items-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Đối tượng báo cáo:"}),e.jsxs("span",{className:"font-black text-emerald-600 text-sm uppercase",children:[H(R)," ",a==="products"?"Sản phẩm":"Đối tác"]})]}),e.jsxs("div",{className:"justify-between flex items-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tỷ suất sinh lời:"}),e.jsxs("span",{className:"font-black text-amber-500 text-sm uppercase",children:[I.revenue>0?(I.profit/I.revenue*100).toFixed(1):0,"% LÃI ròng"]})]})]})]})]})]}),e.jsxs("div",{className:"p-10 pt-0 flex gap-4",children:[e.jsx("button",{onClick:Ae,className:"flex-1 bg-emerald-600 text-white py-4 rounded-[1.5rem] font-black uppercase tracking-widest text-xs hover:bg-emerald-700 shadow-lg shadow-emerald-500/20 transition-all active:scale-95 no-print",children:"In báo cáo vụ mùa"}),e.jsx("button",{onClick:()=>k(!1),className:"flex-1 bg-slate-100 dark:bg-slate-800 text-slate-500 py-4 rounded-[1.5rem] font-black uppercase tracking-widest text-xs hover:bg-slate-200 transition-all active:scale-95 no-print",children:"Đóng lại"})]})]})]})})}),e.jsx(ne,{children:e.jsx(Q,{children:J&&e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0",onClick:()=>Z(!1)}),e.jsxs(h.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10,filter:"blur(10px)"},className:"bg-white dark:bg-slate-900 w-full max-w-4xl rounded-[2.5rem] shadow-2xl overflow-hidden border border-white dark:border-emerald-900/30 relative z-10 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b dark:border-emerald-900/30 flex justify-between items-center bg-emerald-50/50 dark:bg-emerald-950/20",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-black text-emerald-600 dark:text-emerald-400 uppercase tracking-tighter",children:["Lịch sử giao dịch: ",a==="synthesis"?`${v?.product_name} - ${v?.partner_name}`:v?.name]}),e.jsx("p",{className:"text-[10px] text-emerald-800/40 font-black uppercase tracking-widest",children:"Hiển thị tối đa 100 đơn hàng gần nhất trong kỳ"})]}),e.jsx("button",{onClick:()=>Z(!1),className:"p-2 hover:bg-white dark:hover:bg-slate-800 rounded-full transition-all",children:e.jsx(ve,{size:24,className:"text-emerald-600"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-white dark:bg-slate-900 z-10",children:e.jsxs("tr",{className:"border-b dark:border-emerald-900/30",children:[e.jsx("th",{className:"p-3 text-[10px] font-black uppercase text-emerald-800/40",children:"Mã đơn"}),e.jsx("th",{className:"p-3 text-[10px] font-black uppercase text-emerald-800/40",children:"Ngày giờ"}),(a==="products"||a==="synthesis"||a==="customers"||a==="suppliers")&&e.jsx("th",{className:"p-3 text-[10px] font-black uppercase text-emerald-800/40 text-center",children:a==="suppliers"?"SL Mua":"SL Bán"}),e.jsx("th",{className:"p-3 text-[10px] font-black uppercase text-emerald-800/40 text-right",children:"Tổng thanh toán"}),e.jsx("th",{className:"p-3 text-[10px] font-black uppercase text-emerald-800/40 text-center",children:"PTTT"})]})}),e.jsxs("tbody",{className:"divide-y dark:divide-emerald-950/30",children:[me.map(t=>{const s=a==="products"?t.details.find(r=>r.product_id===v?.id):null;return e.jsxs("tr",{className:"hover:bg-emerald-50/20 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-3",children:e.jsxs("button",{onClick:()=>te(t),className:"flex items-center gap-1.5 font-black text-xs text-emerald-600 hover:text-emerald-700 hover:underline",children:["#",t.display_id||t.id,e.jsx(Ze,{size:10})]})}),e.jsx("td",{className:"p-3 text-xs text-gray-500 font-bold",children:new Date(t.date).toLocaleString("vi-VN")}),(a==="products"||a==="synthesis"||a==="customers"||a==="suppliers")&&e.jsx("td",{className:"p-3 text-center text-xs font-black text-amber-600",children:a==="products"&&s?H(s.quantity):a==="synthesis"?t.details.filter(r=>r.product_id===v?.product_id).reduce((r,x)=>r+x.quantity,0):a==="customers"||a==="suppliers"?t.details.reduce((r,x)=>r+x.quantity,0):"-"}),e.jsx("td",{className:"p-3 text-xs text-right font-black text-emerald-600",children:H(t.total_amount)}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:f("px-2 py-0.5 rounded text-[10px] font-black uppercase",t.payment_method==="Cash"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"),children:t.payment_method==="Cash"?"Tiền mặt":"Công nợ"})})]},t.id)}),me.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:a==="products"?"5":"4",className:"p-10 text-center text-gray-400 font-bold",children:"Không tìm thấy đơn hàng nào."})})]})]})}),de>1&&e.jsxs("div",{className:"p-4 border-t dark:border-emerald-900/30 bg-emerald-50/50 dark:bg-emerald-950/20 flex justify-center items-center gap-4",children:[e.jsx("button",{disabled:U===1,onClick:()=>ae(v,U-1),className:"px-4 py-1.5 bg-white dark:bg-slate-800 border border-emerald-100 dark:border-emerald-900/30 rounded-xl text-[10px] font-black uppercase text-emerald-600 disabled:opacity-30 hover:shadow-md transition-all",children:"Trang trước"}),e.jsxs("span",{className:"text-[10px] font-black text-emerald-800/40 uppercase",children:["Trang ",U," / ",de]}),e.jsx("button",{disabled:U===de,onClick:()=>ae(v,U+1),className:"px-4 py-1.5 bg-white dark:bg-slate-800 border border-emerald-100 dark:border-emerald-900/30 rounded-xl text-[10px] font-black uppercase text-emerald-600 disabled:opacity-30 hover:shadow-md transition-all",children:"Trang sau"})]})]})]})})}),e.jsx(ne,{children:e.jsx(Q,{children:ee&&e.jsx(Me,{order:ee,partner:a==="customers"||a==="suppliers"?v:null,onClose:()=>te(null),onSave:()=>{J&&v&&ae(v,U),oe(),te(null)}})})}),e.jsx(ne,{children:e.jsx(Q,{children:P&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100000] flex items-center justify-center bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:e.jsxs(h.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:200,damping:20},className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-emerald-100 dark:border-emerald-900/30 rounded-full"}),e.jsx("div",{className:"absolute top-0 left-0 w-16 h-16 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"}),e.jsx(ye,{size:24,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-emerald-600 dark:text-emerald-400"})]}),e.jsx("div",{className:"text-emerald-600 dark:text-emerald-400 font-black uppercase text-xs tracking-[0.3em]",children:"Đang tải dữ liệu..."})]})})})})]})}export{it as default};
