import{r as c,a0 as Dt,a9 as F,j as e}from"./vendor-C23Namvk.js";import{a as L}from"./vendor-utils-C44aPrMG.js";import{c as p,a as Pt,b as C,P as tt,L as Tt}from"./index-UsWd1F3S.js";import{D as at}from"./settings-BT5ickwW.js";import{P as rt}from"./ProductEditModal-DOGOkWHJ.js";import{P as st}from"./PartnerEditModal-Dpv7L0QI.js";import{P as nt}from"./PrintTemplate-Caxf_GDA.js";import{W as We,c as we,G as it,X as Oe,q as Lt,a4 as zt,J as ot,N as Re,O as ve,Q as Et,V as Wt,Y as lt,k as Ot,$ as Rt,j as At,_ as ct,l as Mt,L as $t,d as Ft,a1 as Bt,a2 as dt}from"./vendor-icons-B3K5gD8o.js";import{A as ee,m as x}from"./vendor-framer-DVZK1f_z.js";import"./Toast-DQljrx14.js";function ta(){const[z,ut]=c.useState([]),[B,pt]=c.useState([]),[j,E]=c.useState(""),[u,v]=c.useState([]),[d,b]=c.useState(null),[Q,q]=c.useState(""),[ke,_]=c.useState(!1),[H,te]=c.useState(""),[W,O]=c.useState(0),[g,I]=c.useState(()=>(localStorage.getItem("unified_pos_mode")||"Wholesale")==="Wholesale"?"Pending":"Cash"),[Ae,le]=c.useState(null),[ce,Me]=c.useState(!1),[N,de]=c.useState(null),[je,$e]=c.useState(null),[D,Ne]=c.useState(0),[mt,Fe]=c.useState(!1),[m,V]=c.useState(0),[R,xt]=c.useState(at),[Ce,ue]=c.useState(!1),[_e,pe]=c.useState(!1),[Be,He]=c.useState(""),[ht,Ue]=c.useState(!1),[Ke,ft]=c.useState(null),[Ht,ae]=c.useState(null),G=Dt(),[S,Se]=c.useState(()=>{const t=localStorage.getItem("held_purchases");return t?JSON.parse(t):[]}),[qe,U]=c.useState(!1),[w,gt]=c.useState(()=>localStorage.getItem("unified_pos_mode")||"Wholesale"),[i,A]=c.useState({product:null,quantity:1,price:0,secondary_qty:0,name:""}),[J,M]=c.useState(null),[X,Qe]=c.useState(""),[re,me]=c.useState(0),[Ie,Y]=c.useState(!1),[yt,xe]=c.useState(null);F.useRef({});const P=F.useRef(null),Z=F.useRef(null),De=F.useRef(null),he=F.useRef(null),Pe=F.useRef(null),Te=F.useRef(null),se=F.useRef(null),[bt,Le]=c.useState(!1),[wt,Ve]=c.useState(null),[Ge,vt]=c.useState(!1),[Je,kt]=c.useState(new Date);c.useEffect(()=>{const t=setInterval(()=>kt(new Date),1e3);return()=>clearInterval(t)},[]);const Xe=c.useMemo(()=>i.product?i.price*i.quantity:0,[i.product,i.price,i.quantity]),$=c.useMemo(()=>u.reduce((t,a)=>t+a.price*a.quantity,0)+Xe,[u,Xe]),fe=d?d.debt_balance:0,jt=g==="Debt"?fe-($>=0?$-W:$+W):fe;c.useEffect(()=>{localStorage.setItem("held_purchases",JSON.stringify(S))},[S]);const ne=async()=>{try{const t=await L.get("/api/products");ut(t.data)}catch(t){console.error(t)}},ie=async()=>{try{const t=await L.get("/api/partners");pt(t.data)}catch(t){console.error(t)}},Nt=async()=>{try{const[t,a]=await Promise.all([L.get("/api/print-templates?module=Purchase"),L.get("/api/settings")]);let r={...at};if(a.data&&(r={...r,...a.data}),t.data&&t.data.length>0){const n=t.data.find(o=>o.is_default)||t.data[0];if(n)try{const o=JSON.parse(n.config);r={...r,...o}}catch(o){console.error("Error parsing template config",o)}}xt(r);const s=N||G.state?.editOrder||new URLSearchParams(window.location.search).get("edit");u.length===0&&!s&&I(w==="Wholesale"?"Pending":"Cash")}catch(t){console.error("Lá»—i khi táº£i cÃ i Ä‘áº·t:",t)}},ge=()=>{const t=localStorage.getItem("purchase_draft");if(t)try{const a=JSON.parse(t);if(v(a.cart||[]),te(a.note||""),O(a.amountPaid||0),I(a.paymentMethod||(localStorage.getItem("unified_pos_mode")==="Wholesale"?"Pending":"Cash")),a.selectedPartnerId){const r=B.find(s=>s.id===a.selectedPartnerId);b(r||null)}else b(null);return de(null),Ne(0),!0}catch(a){console.error("Error loading draft",a)}return!1},ze=t=>{de(t.id),v(t.details.map(a=>({product_id:a.product_id,product_name:a.product_name,unit:a.product_unit,secondary_unit:a.secondary_unit,multiplier:a.multiplier||1,price:a.price,quantity:a.quantity,secondary_qty:a.quantity/(a.multiplier||1),stock:a.stock||0,active_ingredient:a.active_ingredient}))),te(t.note||""),O(t.amount_paid||0),I(t.payment_method),$e(t.partner_id),q(""),E(""),_(!1)},Ct=async t=>{try{const a=await L.get(`/api/orders/${t}`);a.data&&ze(a.data)}catch(a){console.error("Error fetching order",a),ae({message:"KhÃ´ng tÃ¬m tháº¥y hÃ³a Ä‘Æ¡n",type:"error"})}};c.useEffect(()=>{if(ne(),ie(),Nt(),G.state?.editOrder||ge(),G.state?.editOrder)ze(G.state.editOrder);else{const a=new URLSearchParams(window.location.search).get("edit");a?Ct(a):N&&T(!1)}vt(!0)},[G.search,G.state]);const _t=t=>{gt(t),localStorage.setItem("unified_pos_mode",t),u.length===0&&!N&&I(t==="Wholesale"?"Pending":"Cash")};c.useEffect(()=>{g==="Cash"&&O($)},[g,$]),c.useEffect(()=>{if(Ge&&!N){const t={cart:u,selectedPartnerId:d?.id,note:H,amountPaid:W,paymentMethod:g};localStorage.setItem("purchase_draft",JSON.stringify(t))}},[u,d,H,W,g,N,Ge]),c.useEffect(()=>{const t=a=>{const r=a.key.toUpperCase();a.key==="Escape"?(ke||qe||Ce||_e||Ie||j||J!==null)&&(_(!1),U(!1),ue(!1),pe(!1),Y(!1),E(""),M(null)):r===(R.kb_search||"F2").toUpperCase()?(a.preventDefault(),P.current?.focus()):r===(R.kb_save||"F12").toUpperCase()?(a.preventDefault(),be(!1)):r===(R.kb_pay||"F9").toUpperCase()?(a.preventDefault(),be(!0)):r===(R.kb_new||"F4").toUpperCase()?(a.preventDefault(),T()):r===(R.kb_hold||"F8").toUpperCase()&&(a.preventDefault(),Ze())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[u,d,W,H,R,ke,qe,Ce,_e,Ie,j,J]),c.useEffect(()=>{if(B.length>0&&je){const t=B.find(a=>a.id==je);t&&(b(t),$e(null),q(""))}},[B,je]);const ye=(t,a=null,r=null)=>{const s=a!==null?a:1,n=u.find(l=>l.product_id===t.id),o=r!==null?r:t.cost_price;v(n?u.map(l=>l.product_id===t.id?{...l,quantity:l.quantity+s,price:o,secondary_qty:(l.quantity+s)/(l.multiplier||1)}:l):[{product_id:t.id,product_name:t.name,unit:t.unit,secondary_unit:t.secondary_unit,multiplier:t.multiplier||1,price:o,quantity:s,secondary_qty:s/(t.multiplier||1),stock:t.stock,active_ingredient:t.active_ingredient},...u]),E(""),V(0),A({product:null,quantity:1,price:0,secondary_qty:0,name:""}),setTimeout(()=>P.current?.focus(),10)},Ee=(t,a,r)=>{const s=[...u],n=s[t];a==="secondary_qty"?(n.secondary_qty=r,n.quantity=r*n.multiplier):a==="quantity"?(n.quantity=r,n.secondary_qty=r/n.multiplier):n[a]=r,v(s)},St=t=>v(u.filter((a,r)=>r!==t)),be=async(t=!0)=>{let a=[...u];if(i.product&&i.quantity!==0){const r=a.findIndex(s=>s.product_id===i.product.id&&s.price===i.price);r>-1?(a[r].quantity+=i.quantity,a[r].secondary_qty+=i.secondary_qty):a=[{product_id:i.product.id,product_name:i.product.name,unit:i.product.unit,secondary_unit:i.product.secondary_unit,multiplier:i.product.multiplier||1,price:i.price,stock:i.product.stock,quantity:i.quantity,secondary_qty:i.secondary_qty},...a]}if(a.length!==0){Me(!0);try{const r={partner_id:d?d.id:null,type:"Purchase",payment_method:g,details:a.map(n=>({product_id:n.product_id,product_name:n.product_name,quantity:n.quantity,price:n.price})),note:H,amount_paid:W};let s;N?s=await L.put(`/api/orders/${N}`,r):s=await L.post("/api/orders",r),le(s.data),t?setTimeout(()=>{window.print(),setTimeout(()=>{T(!1),ne(),ie(),le(null)},1e3)},1e3):(T(!1),ne(),ie(),ae({message:"ÄÃ£ lÆ°u Ä‘Æ¡n nháº­p hÃ ng thÃ nh cÃ´ng!",type:"success"}),le(null),localStorage.removeItem("purchase_draft"))}catch(r){ae({message:r.response?.data?.error||"Lá»—i khi lÆ°u Ä‘Æ¡n nháº­p hÃ ng",type:"error"})}finally{Me(!1)}}},T=(t=!1)=>{v([]),t||(b(null),q("")),E(""),_(!1),O(0);const a=w==="Wholesale"?"Pending":"Cash";I(a),a==="Cash"&&O(0),te(""),de(null),le(null),Ne(0),setTimeout(()=>P.current?.focus(),100)},Ye=async t=>{let a;if(t==="prev"?a=D+1:a=Math.max(0,D-1),a===0){ge()||T();return}try{Fe(!0);const r=await L.get(`/api/orders?type=Purchase&limit=1&page=${a}`),s=r.data.items||r.data;if(s&&s.length>0){const n=s[0];await new Promise(l=>setTimeout(l,150)),ze(n);const o=B.find(l=>l.id===n.partner_id);b(o||null),Ne(a)}else t==="prev"?ae({message:"KhÃ´ng cÃ²n Ä‘Æ¡n nháº­p hÃ ng cÅ© hÆ¡n.",type:"error"}):ge()||T()}catch(r){console.error(r),ae({message:"Lá»—i khi táº£i lá»‹ch sá»­ Ä‘Æ¡n nháº­p hÃ ng",type:"error"})}finally{setTimeout(()=>Fe(!1),300)}},Ze=()=>{if(u.length===0)return;const t={id:Date.now(),cart:[...u],partner:d,total:$,time:new Date().toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),note:H,paymentMethod:g,editOrderId:N};Se([t,...S]),localStorage.removeItem("purchase_draft"),T(),U(!0)},qt=t=>{v(t.cart),b(t.partner),te(t.note||""),I(t.paymentMethod||(w==="Wholesale"?"Pending":"Cash")),de(t.editOrderId||null),Se(S.filter(a=>a.id!==t.id)),U(!1)},It=t=>Se(S.filter(a=>a.id!==t)),K=c.useMemo(()=>{const t=j.toLowerCase();return t?z.filter(a=>(a.name||"").toLowerCase().includes(t)||(a.code||"").toLowerCase().includes(t)||(a.active_ingredient||"").toLowerCase().includes(t)).sort((a,r)=>{const s=(a.name||"").toLowerCase(),n=(r.name||"").toLowerCase(),o=s.startsWith(t),l=n.startsWith(t);return o&&!l?-1:!o&&l?1:a.code?.toLowerCase()===t&&r.code?.toLowerCase()!==t?-1:a.code?.toLowerCase()!==t&&r.code?.toLowerCase()===t?1:s.localeCompare(n,"vi",{sensitivity:"base"})}).slice(0,10):z.slice(0,10)},[z,j]),oe=c.useMemo(()=>{const t=Q.toLowerCase();return B.filter(a=>(a.name||"").toLowerCase().includes(t)||(a.phone||"").includes(t)).sort((a,r)=>{const s=(a.name||"").toLowerCase(),n=(r.name||"").toLowerCase(),o=s.startsWith(t),l=n.startsWith(t);return o&&!l?-1:!o&&l?1:s.localeCompare(n,"vi",{sensitivity:"base"})})},[B,Q]);return e.jsxs("div",{className:"flex flex-col h-screen main-content-bg font-sans overflow-hidden transition-colors",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden no-print",children:[e.jsxs("div",{className:"p-4 flex gap-6 items-center print:hidden transition-colors relative border-[#d4a574]/20 z-[80]",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute right-[-40px] top-[-40px] opacity-[0.03] dark:opacity-[0.06] -rotate-12 transition-all duration-1000",children:e.jsx(We,{size:240,className:"text-primary"})}),e.jsx("div",{className:"absolute left-[-20px] bottom-[-20px] opacity-[0.02] dark:opacity-[0.04] rotate-45 transition-all duration-1000",children:e.jsx(we,{size:180,className:"text-[#4a7c59]"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mr-4 relative z-10",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-primary-hover rounded-2xl shadow-lg",children:e.jsx(We,{size:28,className:"text-white",strokeWidth:2.5})}),e.jsxs("h1",{className:"text-2xl font-black text-primary dark:text-[#d4a574] uppercase tracking-tighter flex items-center gap-2",children:["Kho HÃ ng",e.jsxs("span",{className:"text-sm font-bold px-3 py-1 bg-gradient-to-r from-[#d4a574]/20 to-[#f4c430]/20 text-muted dark:text-[#d4a574] rounded-xl border border-[#d4a574]/30",children:["#",N||"Má»šI"]})]}),e.jsxs("button",{onClick:()=>{const t={display_id:N?`ÄÆ¡n #${N}`:"XEM TRÆ¯á»šC",date:new Date().toISOString(),partner_name:d?d.name:"NCC VÃ£ng Lai",partner_address:d?d.address:"",partner_phone:d?d.phone:"",total_amount:$,amount_paid:W,payment_method:g,note:H,old_debt:fe,details:u.map(a=>({...a}))};ft(t),Ue(!0)},className:"flex items-center gap-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm text-muted hover:text-primary hover:bg-[#d4a574]/20 dark:hover:bg-[#4a7c59]/20 px-4 py-2 rounded-xl border-2 border-[#d4a574]/30 transition-all font-black text-[10px] uppercase tracking-widest shadow-sm hover:shadow-md",children:[e.jsx(it,{size:16})," Xem trÆ°á»›c in"]})]}),e.jsxs("div",{className:"flex-1 flex gap-4 relative z-10",children:[e.jsxs("div",{className:"w-80 relative z-50",onBlur:()=>setTimeout(()=>_(!1),200),children:[e.jsxs("div",{className:"relative cursor-pointer",onDoubleClick:t=>{t.preventDefault(),d&&(Ve(d),Le(!0))},children:[e.jsx(we,{className:"absolute left-3 top-3 text-[#4a7c59]",size:18,strokeWidth:2.5}),e.jsx("input",{type:"text",className:"w-full pl-10 p-2.5 border-2 border-[#d4a574]/30 dark:border-slate-800 rounded-xl focus:border-primary dark:focus:border-[#4a7c59] outline-none font-bold text-primary dark:text-gray-200 bg-white/90 dark:bg-slate-950/90 backdrop-blur-sm cursor-pointer transition-all shadow-sm focus:shadow-md",placeholder:"ðŸ” TÃ¬m kiáº¿m NCC...",value:d?d.name:Q,onDoubleClick:t=>{d&&(t.stopPropagation(),Ve(d),Le(!0))},onChange:t=>{q(t.target.value),d&&b(null),_(!0)},onKeyDown:t=>{if(t.key==="ArrowDown")t.preventDefault(),V(a=>{const r=Math.min(a+1,oe.length),s=Pe.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="ArrowUp")t.preventDefault(),V(a=>{const r=Math.max(a-1,0),s=Pe.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="Enter"){if(t.preventDefault(),m===0)b(null),q(""),_(!1);else if(oe[m-1]){const a=oe[m-1];b(a),q(""),_(!1)}}}}),d&&e.jsx("button",{onClick:()=>{b(null),q("")},className:"absolute right-3 top-3 text-muted hover:text-red-500 transition-colors",children:e.jsx(Oe,{size:16})})]}),e.jsx(ee,{children:ke&&!d&&e.jsxs(x.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{type:"spring",stiffness:400,damping:30},className:"dropdown-premium min-w-[320px] !z-[200]",ref:Pe,children:[e.jsxs("div",{className:p("dropdown-item flex items-center gap-3",m===0&&"active"),onClick:()=>{b(null),q(""),_(!1)},children:[e.jsx("div",{className:p("w-8 h-8 rounded-full flex items-center justify-center transition-colors",m===0?"bg-white/20 text-white":"bg-gray-100 dark:bg-slate-800 text-gray-500"),children:e.jsx(Lt,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:p("font-black uppercase tracking-tight",m===0?"text-white":"text-gray-800 dark:text-gray-100"),children:"NCC vÃ£ng lai"}),e.jsx("div",{className:p("text-[10px] font-bold",m===0?"text-white/70":"text-gray-400"),children:"Mua hÃ ng thanh toÃ¡n ngay"})]})]}),e.jsx("div",{className:"max-h-[350px] overflow-y-auto no-scrollbar scroll-smooth",children:oe.map((t,a)=>e.jsxs("div",{onClick:()=>{b(t),q(""),_(!1)},className:p("dropdown-item flex justify-between items-center",m===a+1&&"active"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:p("w-8 h-8 rounded-full flex items-center justify-center transition-colors",m===a+1?"bg-white/20 text-white":"bg-primary/10 text-primary"),children:e.jsx(zt,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:p("font-black uppercase tracking-tight",m===a+1?"text-white":"text-gray-800 dark:text-gray-100"),children:t.name}),e.jsxs("div",{className:p("text-[10px] font-bold flex items-center gap-2",m===a+1?"text-white/70":"text-gray-400"),children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(ot,{size:10,strokeWidth:3})," ",t.phone||"N/A"]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-current opacity-30"}),e.jsx("span",{className:"flex items-center gap-0.5 uppercase tracking-tighter",children:t.is_customer&&t.is_supplier?"KH & NCC":t.is_customer?"KhÃ¡ch hÃ ng":"NhÃ  CC"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:p("text-[10px] font-black uppercase opacity-60 mb-0.5",m===a+1?"text-white/60":"text-gray-400"),children:"DÆ° ná»£"}),e.jsx("div",{className:p("font-black text-sm",m===a+1?"text-white":"text-red-500"),children:Pt(t.debt_balance)})]})]},t.id))}),Q&&oe.length===0&&e.jsxs("div",{className:"p-4 bg-primary text-white cursor-pointer font-black uppercase text-xs flex items-center gap-2 hover:brightness-110 transition-all",onClick:()=>{He(Q),ue(!0),_(!1)},children:[e.jsx(Re,{size:18,strokeWidth:3}),' ThÃªm nhÃ  cung cáº¥p má»›i: "',Q,'"']})]})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(x.button,{whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},onClick:()=>U(!0),className:"relative p-2.5 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm text-muted dark:text-gray-400 rounded-xl hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all font-bold flex items-center gap-2 border-2 border-[#d4a574]/20 shadow-sm hover:shadow-md",title:"ÄÆ¡n nháº­p táº¡m",children:[e.jsx(ve,{size:20}),S.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-gradient-to-br from-[#f4c430] to-[#d4a574] text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-black shadow-lg",children:S.length}),e.jsx("span",{className:"hidden lg:inline text-xs uppercase",children:"ÄÆ¡n Táº¡m"})]}),e.jsxs("div",{className:"flex bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-xl overflow-hidden shadow-sm border-2 border-[#d4a574]/20",children:[e.jsx(x.button,{whileTap:{scale:.9},onClick:()=>Ye("prev"),className:"p-2.5 text-muted dark:text-gray-400 hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all border-r border-[#d4a574]/20 dark:border-slate-700",title:"ÄÆ¡n trÆ°á»›c",children:e.jsx(Et,{size:20})}),e.jsxs(x.button,{whileTap:{scale:.95},onClick:()=>{D!==0&&(ge()||T())},className:"px-3 flex flex-col items-center justify-center min-w-[70px] hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-colors",title:"Quay vá» Ä‘Æ¡n má»›i",children:[e.jsx("span",{className:p("text-[10px] font-black uppercase tracking-tighter",D===0?"text-primary dark:text-[#4a7c59]":"text-[#f4c430]"),children:D===0?"Má»›i":`#${D}`}),D!==0&&e.jsx("span",{className:"text-[8px] font-bold text-muted dark:text-gray-400 uppercase leading-none",children:"Vá» Má»›i"})]}),e.jsx(x.button,{whileTap:{scale:.9},onClick:()=>Ye("next"),disabled:D===0,className:p("p-2.5 text-muted dark:text-gray-400 hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all border-l border-[#d4a574]/20 dark:border-slate-700",D===0&&"opacity-30 cursor-not-allowed"),title:"ÄÆ¡n sau",children:e.jsx(Wt,{size:20})})]}),e.jsxs(x.button,{whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},onClick:T,className:"p-2.5 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm text-muted dark:text-gray-400 rounded-xl hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all font-bold flex items-center gap-2 border-2 border-[#d4a574]/20 shadow-sm hover:shadow-md",title:"LÃ m má»›i",children:[e.jsx(lt,{size:20}),e.jsx("span",{className:"hidden lg:inline text-xs uppercase",children:"LÃ m má»›i"})]}),e.jsxs(x.button,{whileTap:{scale:.95},onClick:()=>_t(w==="Retail"?"Wholesale":"Retail"),className:p("px-4 py-2.5 rounded-xl font-black text-xs uppercase tracking-wider flex items-center gap-2 transition-all cursor-pointer select-none shadow-sm hover:shadow-md border-2",w==="Wholesale"?"bg-gradient-to-r from-[#f4c430]/20 to-[#d4a574]/20 text-muted border-[#d4a574]/30 hover:from-[#f4c430]/30 hover:to-[#d4a574]/30":"bg-gradient-to-r from-primary/20 to-primary-hover/20 text-primary dark:text-[#4a7c59] border-[#4a7c59]/30 hover:from-primary/30 hover:to-primary-hover/30"),children:[e.jsx("div",{className:p("w-2 h-2 rounded-full",w==="Wholesale"?"bg-amber-500":"bg-emerald-500")}),w==="Wholesale"?"Sá»ˆ":"Láºº"]})]}),e.jsx("div",{className:"flex-1 flex justify-end items-center mr-2",children:e.jsxs("div",{className:"flex flex-col items-end opacity-80 hover:opacity-100 transition-opacity select-none",children:[e.jsx("div",{className:"text-2xl font-black text-primary dark:text-[#d4a574] tracking-tighter leading-none flex items-center gap-2 tabular-nums",children:Je.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"text-[10px] font-bold text-muted dark:text-gray-400 uppercase tracking-widest flex items-center gap-1.5",children:[e.jsx(Ot,{size:10,strokeWidth:2.5}),e.jsx("span",{children:Je.toLocaleDateString("vi-VN",{weekday:"short",day:"2-digit",month:"2-digit",year:"numeric"})})]})]})})]})]}),e.jsx("div",{className:"flex-1 p-4 pb-2 pt-2 print:hidden min-h-0",children:e.jsxs("div",{className:"w-full h-full rounded-[2.5rem] border-2 border-primary/30 shadow-2xl overflow-hidden relative h-full main-content-bg",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(139, 111, 71, 0.1) 10px, rgba(139, 111, 71, 0.1) 20px),
                                            radial-gradient(circle at 3px 3px, rgba(45, 80, 22, 0.08) 1px, transparent 0)`,backgroundSize:"40px 40px, 30px 30px",backgroundPosition:"0 0, 15px 15px"}}),e.jsx("div",{className:"absolute inset-0 overflow-auto",children:e.jsxs("div",{className:"hidden md:block min-w-[1000px] transition-colors relative group/decoration min-h-full",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden rounded-[2.5rem] pointer-events-none",children:[e.jsx("div",{className:"absolute right-[-100px] bottom-[-100px] opacity-[0.02] dark:opacity-[0.04] group-hover/decoration:scale-110 transition-transform duration-[2000ms] text-[#4a7c59]",children:e.jsx(we,{size:600})}),e.jsx("div",{className:"absolute left-[-50px] top-[-50px] opacity-[0.015] dark:opacity-[0.03] group-hover/decoration:rotate-12 transition-transform duration-[3000ms] text-muted",children:e.jsx(We,{size:400})})]}),e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gradient-to-r from-primary/10 via-primary/8 to-primary-hover/10 border-b-2 border-[#d4a574]/40 text-primary dark:text-[#d4a574] uppercase text-[11px] font-black tracking-wider transition-colors sticky top-0 z-[40] shadow-md backdrop-blur-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-12 text-center",children:"Stt"}),e.jsx("th",{className:"p-4",children:"TÃªn Sáº£n Pháº©m"}),e.jsx("th",{className:"p-4 w-24 text-center",children:"ÄVT"}),e.jsx("th",{className:"p-4 w-32 text-center",children:"SL Quy Ä‘á»•i"}),e.jsx("th",{className:"p-4 w-24 text-center text-primary",children:"Sá»‘ lÆ°á»£ng"}),e.jsx("th",{className:"p-4 w-32 text-right",children:"GiÃ¡ nháº­p"}),e.jsx("th",{className:"p-4 w-32 text-right",children:"ThÃ nh tiá»n"}),e.jsx("th",{className:"p-4 w-24 text-center text-sm",children:"Kho"}),e.jsx("th",{className:"p-4 w-12"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800",children:[e.jsxs("tr",{className:"bg-gradient-to-r from-[#faf8f3]/60 via-white/40 to-[#faf8f3]/60 dark:bg-slate-900/40 print:hidden border-b-2 border-[#d4a574]/30 sticky top-[52px] z-[45] backdrop-blur-md cursor-pointer shadow-sm",onDoubleClick:()=>{i.product&&(xe(i.product),Y(!0))},children:[e.jsx("td",{className:"p-4 text-center",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto",children:e.jsx(Re,{size:18,className:"text-primary"})})}),e.jsx("td",{className:"p-2 relative",children:e.jsxs("div",{className:"relative group/search",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 text-gray-400",children:e.jsx(Rt,{size:20})}),e.jsx("input",{type:"text",placeholder:"TÃªn sáº£n pháº©m (F2)...",className:"w-full p-2.5 pl-12 bg-white/80 dark:bg-slate-800 border-2 border-[#d4a574]/20 focus:border-primary dark:focus:border-[#4a7c59] focus:bg-white rounded-xl font-black text-gray-800 dark:text-gray-100 uppercase outline-none transition-all shadow-sm",autoComplete:"off",value:j,onChange:t=>{const a=t.target.value;E(a),V(0),i.product&&a!==i.name&&A({...i,product:null,name:a})},onKeyDown:t=>{if(t.key==="ArrowUp")t.preventDefault(),V(a=>{const r=Math.max(a-1,0),s=Te.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="ArrowDown")t.preventDefault(),V(a=>{const r=Math.min(a+1,K.length-1),s=Te.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="Enter"){if(t.preventDefault(),j&&K[m]){const a=K[m],r=i.quantity>0?i.quantity:1;A({product:a,quantity:r,price:a.cost_price,secondary_qty:r/(a.multiplier||1),name:a.name}),E(a.name),ye(a,1,a.cost_price)}}else if(t.key==="Tab"){if(i.product){t.preventDefault();const a=w==="Wholesale"&&i.product.secondary_unit?he:Z;setTimeout(()=>{a.current?.focus(),a.current?.select()},10)}else if(j&&K[m]){t.preventDefault();const a=K[m],r=i.quantity>0?i.quantity:1;A({product:a,quantity:r,price:a.cost_price,secondary_qty:r/(a.multiplier||1),name:a.name}),E(a.name);const s=w==="Wholesale"&&a.secondary_unit?he:Z;setTimeout(()=>{s.current?.focus(),s.current?.select()},10)}}},ref:P}),e.jsx(ee,{children:j&&!i.product&&e.jsxs(x.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{type:"spring",stiffness:400,damping:30},className:"dropdown-premium min-w-[500px]",children:[e.jsx("div",{className:"max-h-[400px] overflow-y-auto no-scrollbar scroll-smooth",ref:Te,children:K.map((t,a)=>e.jsxs("div",{onClick:()=>{const r=i.quantity>0?i.quantity:1;A({product:t,quantity:r,price:t.cost_price,secondary_qty:r/(t.multiplier||1),name:t.name}),E(t.name);const s=w==="Wholesale"&&t.secondary_unit?he:Z;setTimeout(()=>{s.current?.focus(),s.current?.select()},10)},onDoubleClick:()=>{xe(t),Y(!0)},className:p("dropdown-item flex justify-between items-center",a===m&&"active"),children:[e.jsxs("div",{children:[e.jsx("div",{className:p("font-black uppercase tracking-tight",a===m?"text-white":"text-gray-800 dark:text-gray-100"),children:t.name}),e.jsx("div",{className:p("text-[10px] font-bold italic mb-0.5",a===m?"text-white/80":"text-primary dark:text-emerald-400"),children:t.active_ingredient}),e.jsxs("div",{className:p("text-[10px] uppercase font-black flex items-center gap-2",a===m?"text-white/70":"text-gray-400"),children:[t.unit," ",t.multiplier>1&&`/ ${t.secondary_unit} (x${t.multiplier})`,e.jsx("span",{className:"w-1 h-1 rounded-full bg-current opacity-30"}),e.jsxs("span",{className:p(a===m?"text-white":"text-emerald-500"),children:[t.stock," Tá»’N"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:p("font-black text-lg tracking-tighter",a===m?"text-white":"text-emerald-400"),children:C(t.cost_price)})})]},t.id))}),j&&K.length===0&&e.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 hover:bg-primary hover:text-white cursor-pointer text-primary dark:text-emerald-400 font-black uppercase text-xs flex items-center gap-2",onClick:()=>{He(j),pe(!0)},children:[e.jsx(Re,{size:16}),' ThÃªm sáº£n pháº©m má»›i: "',j,'"']})]})})]})}),e.jsxs("td",{className:"p-4 text-center",children:[e.jsx("div",{className:"font-bold text-gray-700 dark:text-gray-200 text-xs",children:i.product?.unit||"-"}),i.product?.secondary_unit&&e.jsxs("div",{className:"text-[10px] text-primary font-black uppercase tracking-tighter",children:["1 ",i.product.secondary_unit," = ",i.product.multiplier," ",i.product.unit]})]}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",disabled:!i.product?.secondary_unit,className:"w-full p-2 text-center bg-gray-50 dark:bg-slate-800 border border-transparent dark:border-slate-700 rounded focus:border-emerald-300 outline-none font-bold disabled:opacity-30 dark:text-gray-200",id:"working-sec-qty",ref:he,value:i.secondary_qty,autoComplete:"off",onFocus:t=>t.target.select(),onChange:t=>{const a=parseFloat(t.target.value)||0;A(r=>{const s=parseFloat(r.product?.multiplier)||1;return{...r,secondary_qty:a,quantity:a*s}})},onKeyDown:t=>{t.key==="Tab"?(t.preventDefault(),Z.current?.focus()):t.key==="Enter"&&(t.preventDefault(),i.product&&i.quantity!==0&&ye(i.product,i.quantity,i.price))}})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full p-2 text-center bg-emerald-50/50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800/50 rounded focus:border-secondary outline-none font-black text-lg text-emerald-700 dark:text-emerald-400",value:i.quantity,id:"working-main-qty",ref:Z,autoComplete:"off",onFocus:t=>t.target.select(),onChange:t=>{const a=parseFloat(t.target.value)||0;A(r=>{const s=parseFloat(r.product?.multiplier)||1;return{...r,quantity:a,secondary_qty:a/s}})},onKeyDown:t=>{t.key==="Tab"?(t.preventDefault(),De.current?.focus()):t.key==="Enter"&&(t.preventDefault(),i.product&&i.quantity!==0&&ye(i.product,i.quantity,i.price))}})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("input",{type:"text",className:"w-full p-2 text-right bg-transparent border-none focus:ring-2 focus:ring-emerald-200 rounded font-bold outline-none dark:text-gray-200",value:C(i.price),id:"working-price",ref:De,autoComplete:"off",onFocus:t=>t.target.select(),onChange:t=>{const a=parseFloat(t.target.value.replace(/,/g,""))||0;A({...i,price:a})},onKeyDown:t=>{t.key==="Enter"?(t.preventDefault(),i.product&&i.quantity!==0&&ye(i.product,i.quantity,i.price)):t.key==="Tab"&&!t.shiftKey&&(t.preventDefault(),P.current?.focus())}})}),e.jsx("td",{className:"p-4 text-right font-black text-gray-900 dark:text-white text-lg",children:C(i.price*i.quantity)}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:"text-sm font-black text-gray-400",children:i.product?.stock||"-"})}),e.jsx("td",{className:"p-4"})]}),e.jsx(ee,{initial:!1,mode:"wait",children:mt?e.jsx(x.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"w-full",children:e.jsx("td",{colSpan:10,className:"h-[400px] text-center relative align-middle",children:e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-xl rounded-full"}),e.jsx(At,{size:48,className:"animate-spin text-primary relative z-10"})]}),e.jsx("span",{className:"text-sm font-black text-muted dark:text-[#d4a574] uppercase tracking-widest",children:"Äang Ä‘á»“ng bá»™ dá»¯ liá»‡u..."})]})})},"loading-skeleton"):u.map((t,a)=>e.jsxs(x.tr,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}},transition:{duration:.2,delay:a*.01},className:p("transition-all group cursor-pointer",a%2===0?"bg-white/30 hover:bg-[#d4a574]/10":"bg-[#faf8f3]/20 hover:bg-[#d4a574]/15"),onDoubleClick:()=>{const r=z.find(s=>s.id===t.product_id);r&&(xe(r),Y(!0))},children:[e.jsx("td",{className:"p-4 text-center text-gray-400 font-bold",children:a+1}),e.jsx("td",{className:"p-2 relative",children:e.jsxs("div",{className:"relative group/search-row",onDoubleClick:r=>{r.preventDefault();const s=z.find(n=>n.id===t.product_id);s&&(xe(s),Y(!0))},children:[e.jsx("input",{className:"w-full p-2 bg-transparent border-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 rounded font-bold text-gray-800 dark:text-gray-100 uppercase outline-none",autoComplete:"off",value:J===a?X:t.product_name,onFocus:r=>{M(a),Qe(t.product_name),me(0),r.target.select()},onChange:r=>{Qe(r.target.value),me(0)},onBlur:()=>{setTimeout(()=>{M(r=>r===a?null:r)},200)},onKeyDown:r=>{const s=z.filter(n=>{const o=X.toLowerCase();return(n.name||"").toLowerCase().includes(o)||(n.code||"").toLowerCase().includes(o)||(n.active_ingredient||"").toLowerCase().includes(o)}).sort((n,o)=>{const l=X.toLowerCase(),f=(n.name||"").toLowerCase(),h=(o.name||"").toLowerCase(),y=f.startsWith(l),k=h.startsWith(l);return y&&!k?-1:!y&&k?1:n.code?.toLowerCase()===l&&o.code?.toLowerCase()!==l?-1:n.code?.toLowerCase()!==l&&o.code?.toLowerCase()===l?1:f.localeCompare(h,"vi",{sensitivity:"base"})}).slice(0,10);if(r.key==="ArrowDown")if(J===a&&s.length>0)r.preventDefault(),me(n=>{const o=Math.min(n+1,s.length-1);if(se.current){const l=se.current.children[o];l&&l.scrollIntoView({block:"nearest"})}return o});else{r.preventDefault();const n=a+1;n<u.length&&document.getElementById(`row-name-${n}`)?.focus()}else if(r.key==="ArrowUp")if(J===a&&s.length>0)r.preventDefault(),me(n=>{const o=Math.max(n-1,0);if(se.current){const l=se.current.children[o];l&&l.scrollIntoView({block:"nearest"})}return o});else{r.preventDefault();const n=a-1;n>=0?document.getElementById(`row-name-${n}`)?.focus():P.current?.focus()}else if(r.key==="Enter"){if(r.preventDefault(),s[re]){const n=s[re];let o=[...u];const l=o[a].quantity,f=o.findIndex((h,y)=>y!==a&&h.product_id===n.id);f>-1?(o[f].quantity+=l,o[f].secondary_qty=o[f].quantity/(o[f].multiplier||1),o.splice(a,1)):o[a]={...o[a],product_id:n.id,product_name:n.name,unit:n.unit,secondary_unit:n.secondary_unit,multiplier:n.multiplier||1,price:n.cost_price,stock:n.stock,secondary_qty:l/(n.multiplier||1),active_ingredient:n.active_ingredient},v(o),M(null)}P.current?.focus()}else if(r.key==="Tab"){r.preventDefault();const n=s.length>0?s:[];if(n[re]){const o=n[re];let l=[...u];const f=l[a].quantity,h=l.findIndex((y,k)=>k!==a&&y.product_id===o.id);h>-1?(l[h].quantity+=f,l[h].secondary_qty=l[h].quantity/(l[h].multiplier||1),l.splice(a,1),v(l),M(null),setTimeout(()=>{const y=h>a?h-1:h,k=document.getElementById(`qty-sec-${y}`);if(w==="Wholesale"&&k&&!k.disabled)k.focus(),k.select?.();else{const et=document.getElementById(`qty-main-${y}`);et?.focus(),et?.select?.()}},200)):(l[a]={...l[a],product_id:o.id,product_name:o.name,unit:o.unit,secondary_unit:o.secondary_unit,multiplier:o.multiplier||1,price:o.cost_price,stock:o.stock,secondary_qty:f/(o.multiplier||1),active_ingredient:o.active_ingredient},v(l),M(null),setTimeout(()=>{const y=document.getElementById(`qty-sec-${a}`);if(w==="Wholesale"&&y&&!y.disabled)y.focus(),y.select?.();else{const k=document.getElementById(`qty-main-${a}`);k?.focus(),k?.select?.()}},200))}else M(null),setTimeout(()=>{const o=document.getElementById(`qty-sec-${a}`);if(w==="Wholesale"&&o&&!o.disabled)o.focus(),o.select?.();else{const l=document.getElementById(`qty-main-${a}`);l?.focus(),l?.select?.()}},200)}},id:`row-name-${a}`}),J===a&&X&&e.jsx("div",{className:"dropdown-premium min-w-[400px] mt-2",children:e.jsx("div",{ref:se,className:"max-h-64 overflow-y-auto no-scrollbar",children:z.filter(r=>{const s=X.toLowerCase();return(r.name||"").toLowerCase().includes(s)||(r.code||"").toLowerCase().includes(s)||(r.active_ingredient||"").toLowerCase().includes(s)}).sort((r,s)=>{const n=X.toLowerCase(),o=(r.name||"").toLowerCase(),l=(s.name||"").toLowerCase(),f=o.startsWith(n),h=l.startsWith(n);return f&&!h?-1:!f&&h?1:r.code?.toLowerCase()===n&&s.code?.toLowerCase()!==n?-1:r.code?.toLowerCase()!==n&&s.code?.toLowerCase()===n?1:o.localeCompare(l,"vi",{sensitivity:"base"})}).slice(0,10).map((r,s)=>e.jsxs("div",{onClick:()=>{let n=[...u];const o=n[a].quantity,l=n.findIndex((f,h)=>h!==a&&f.product_id===r.id);l>-1?(n[l].quantity+=o,n[l].secondary_qty=n[l].quantity/(n[l].multiplier||1),n.splice(a,1)):n[a]={...n[a],product_id:r.id,product_name:r.name,unit:r.unit,secondary_unit:r.secondary_unit,multiplier:r.multiplier||1,price:r.cost_price,stock:r.stock,secondary_qty:o/(r.multiplier||1),active_ingredient:r.active_ingredient},v(n),M(null)},className:p("dropdown-item flex justify-between items-center",s===re&&"active"),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-black text-gray-800 dark:text-gray-100 uppercase tracking-tight",children:r.name}),e.jsxs("div",{className:"text-[11px] text-gray-500 uppercase font-black flex items-center gap-2",children:[e.jsx("span",{children:r.unit}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),e.jsxs("span",{className:"text-emerald-500",children:[r.stock," Tá»’N"]})]})]}),e.jsx("div",{className:"text-right font-black text-primary",children:C(r.cost_price)})]},r.id))})}),t.active_ingredient&&e.jsxs("div",{className:"absolute left-0 bottom-full mb-2 hidden group-hover/search-row:block z-[2000] w-64 bg-slate-800 text-white p-3 rounded-xl shadow-2xl animate-in fade-in slide-in-from-bottom-2 duration-200 border border-slate-700 uppercase-none",children:[e.jsx("div",{className:"text-[10px] font-black uppercase text-emerald-400 mb-1 tracking-widest border-b border-white/10 pb-1",children:"Hoáº¡t cháº¥t / ThÃ nh pháº§n"}),e.jsx("div",{className:"text-xs font-bold leading-relaxed",children:t.active_ingredient})]})]})}),e.jsxs("td",{className:"p-4 text-center",children:[e.jsx("div",{className:"font-bold text-gray-700 dark:text-gray-200",children:t.unit}),t.secondary_unit&&e.jsxs("div",{className:"text-[10px] text-primary font-black uppercase tracking-tighter",children:["1 ",t.secondary_unit," = ",t.multiplier," ",t.unit]})]}),e.jsx("td",{className:"p-2",children:t.secondary_unit?e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 dark:bg-slate-800 p-1.5 rounded-xl border border-transparent focus-within:border-emerald-200 transition-all",children:[e.jsx("input",{type:"number",className:"w-full bg-transparent text-center font-black text-gray-800 dark:text-white outline-none",value:t.secondary_qty,onFocus:r=>r.target.select(),autoComplete:"off",onChange:r=>Ee(a,"secondary_qty",parseFloat(r.target.value)||0),onKeyDown:r=>{if(r.key==="ArrowDown"){r.preventDefault();const s=a+1;s<u.length&&document.getElementById(`qty-sec-${s}`)?.focus()}else if(r.key==="ArrowUp"){r.preventDefault();const s=a-1;s>=0&&document.getElementById(`qty-sec-${s}`)?.focus()}},id:`qty-sec-${a}`}),e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase pr-2",children:t.secondary_unit})]}):e.jsx("div",{className:"text-center text-gray-300 italic text-[10px] font-bold",children:"N/A"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full p-2 text-center bg-emerald-50 dark:bg-emerald-900/30 border border-emerald-100 dark:border-emerald-800/50 rounded focus:border-secondary outline-none font-black text-lg text-emerald-700 dark:text-emerald-400",value:t.quantity,onFocus:r=>r.target.select(),autoComplete:"off",onChange:r=>Ee(a,"quantity",parseFloat(r.target.value)||0),onKeyDown:r=>{if(r.key==="Enter")r.preventDefault(),P.current?.focus();else if(r.key==="Tab")r.preventDefault(),document.getElementById(`price-${a}`)?.focus();else if(r.key==="ArrowDown"){r.preventDefault();const s=a+1;s<u.length&&document.getElementById(`qty-main-${s}`)?.focus()}else if(r.key==="ArrowUp"){r.preventDefault();const s=a-1;s>=0?document.getElementById(`qty-main-${s}`)?.focus():Z.current?.focus()}},id:`qty-main-${a}`})}),e.jsx("td",{className:"p-2 text-right text-gray-700 dark:text-gray-200 font-bold",children:e.jsx("input",{type:"text",className:"w-full p-2 text-right bg-transparent border-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 rounded font-bold outline-none",value:C(t.price),onFocus:r=>r.target.select(),autoComplete:"off",onChange:r=>{const s=parseFloat(r.target.value.replace(/,/g,""))||0;Ee(a,"price",s)},onKeyDown:r=>{if(r.key==="Enter"||r.key==="Tab")r.preventDefault(),P.current?.focus();else if(r.key==="ArrowDown"){r.preventDefault();const s=a+1;s<u.length&&document.getElementById(`price-${s}`)?.focus()}else if(r.key==="ArrowUp"){r.preventDefault();const s=a-1;s>=0?document.getElementById(`price-${s}`)?.focus():De.current?.focus()}},id:`price-${a}`})}),e.jsx("td",{className:"p-4 text-right font-black text-gray-900 dark:text-white text-lg",children:C(t.price*t.quantity)}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-black bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-gray-400 transition-colors shadow-sm",children:t.stock})}),e.jsx("td",{className:"p-4",children:e.jsx(x.button,{whileHover:{scale:1.1,color:"#ef4444"},whileTap:{scale:.9},onClick:()=>St(a),className:"text-gray-300 hover:text-red-500 transition-all",children:e.jsx(ct,{size:18})})})]},`edit-row-${a}`))})]})]})]})})]})}),e.jsxs("div",{className:"border-2 border-primary/30 p-4 print:hidden transition-colors rounded-[2.5rem] mx-4 mb-4 mt-2 shadow-2xl overflow-hidden relative main-content-bg",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.01] pointer-events-none",style:{backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(139, 111, 71, 0.05) 20px, rgba(139, 111, 71, 0.05) 40px)",backgroundSize:"80px 80px"}}),e.jsxs("div",{className:"max-w-[1600px] mx-auto flex gap-4 items-start relative z-10",children:[e.jsxs("div",{className:"w-[22%] space-y-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm p-4 rounded-[2rem] border-2 border-[#d4a574]/20 shadow-sm transition-all hover:shadow-md group/partner",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary/10 to-primary-hover/20 rounded-2xl shadow-inner flex items-center justify-center text-primary dark:text-[#d4a574] border border-white dark:border-slate-800 transition-transform group-hover/partner:scale-105 duration-500",children:e.jsx(we,{size:28})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[10px] font-black text-muted dark:text-[#d4a574]/60 uppercase tracking-[0.2em]",children:"NhÃ  cung cáº¥p"}),e.jsx("div",{className:"font-black text-primary dark:text-white text-xl uppercase leading-tight group-hover/partner:text-[#4a7c59] transition-colors duration-500 truncate",children:d?d.name:"NhÃ  cung cáº¥p láº»"}),d&&e.jsxs("div",{className:"flex flex-col gap-0.5 mt-1",children:[d.address&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-muted/80 dark:text-[#d4a574]/80 truncate",children:[e.jsx(Mt,{size:10,strokeWidth:2.5}),e.jsx("span",{className:"truncate",children:d.address})]}),d.phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-muted/60 dark:text-[#d4a574]/60 truncate",children:[e.jsx(ot,{size:10,strokeWidth:2.5}),e.jsx("span",{className:"truncate",children:d.phone})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-3 text-primary/30 dark:text-[#d4a574]/30",children:e.jsx($t,{size:18})}),e.jsx("textarea",{placeholder:"Ghi chÃº Ä‘Æ¡n nháº­p...",className:"w-full pl-10 p-3 bg-white/50 dark:bg-slate-800/50 border-2 border-[#d4a574]/10 rounded-2xl focus:bg-white dark:focus:bg-slate-800 focus:border-primary dark:focus:border-[#4a7c59] outline-none transition-all resize-none h-20 text-sm italic dark:text-gray-300",value:H,onChange:t=>te(t.target.value)})]})]}),e.jsxs("div",{className:"flex-1 space-y-4 pt-2 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center bg-primary/5 dark:bg-[#4a7c59]/10 p-4 rounded-2xl border-2 border-[#d4a574]/20 shadow-inner",children:[e.jsx("span",{className:"text-xs font-black text-muted dark:text-[#d4a574]/80 uppercase tracking-widest",children:"Cá»™ng tiá»n:"}),e.jsx("span",{className:"font-black text-4xl text-primary dark:text-[#f4c430]",children:C($)})]}),e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsx("span",{className:"text-xs font-black text-muted/60 dark:text-[#d4a574]/40 uppercase tracking-widest",children:"Ná»£ cÅ© NCC:"}),e.jsx("span",{className:"font-black text-xl text-red-500 dark:text-red-400/80",children:C(fe)})]}),e.jsx("div",{className:"border-t border-dashed border-[#d4a574]/30 my-2"}),e.jsxs("div",{className:"flex justify-between items-center px-4 gap-3",children:[e.jsxs("div",{className:"flex bg-primary/10 dark:bg-[#4a7c59]/20 p-1.5 rounded-xl gap-1 border border-[#d4a574]/30 shrink-0",children:[e.jsx("button",{onClick:()=>I("Cash"),className:p("px-3 py-2 rounded-lg text-[10px] font-black transition-all whitespace-nowrap",g==="Cash"?"bg-primary text-white shadow-md scale-105":"text-primary/60 hover:text-primary dark:text-[#d4a574]/60"),children:"TIá»€N Máº¶T"}),e.jsx("button",{onClick:()=>{I("Debt"),O(0)},className:p("px-3 py-2 rounded-lg text-[10px] font-black transition-all whitespace-nowrap",g==="Debt"?"bg-[#8b6f47] text-white shadow-md scale-105":"text-muted/60 hover:text-muted dark:text-[#d4a574]/60"),children:"CÃ”NG Ná»¢"}),e.jsx("button",{onClick:()=>{I("Pending"),O(0)},className:p("px-3 py-2 rounded-lg text-[10px] font-black transition-all whitespace-nowrap",g==="Pending"?"bg-[#f4c430] text-white shadow-md scale-105":"text-[#f4c430]/60 hover:text-[#f4c430] dark:text-[#d4a574]/60"),children:"CHá»œ T/T"})]}),e.jsx("input",{type:"text",readOnly:g==="Cash"||g==="Pending",className:p("flex-1 min-w-0 p-3 text-right rounded-xl font-black text-2xl outline-none border-none shadow-inner",g==="Cash"||g==="Pending"?"bg-primary/5 dark:bg-slate-800 text-primary/40":"bg-white dark:bg-slate-800 text-primary dark:text-[#d4a574] ring-2 ring-[#d4a574]/30 focus:ring-primary"),value:C(W),autoComplete:"off",onChange:t=>O(parseFloat(t.target.value.replace(/,/g,""))||0)})]})]}),e.jsxs("div",{className:"w-[33%] space-y-4 min-w-0 shrink-0",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-primary-hover text-white p-6 rounded-[2.5rem] flex justify-between items-center shadow-xl shadow-primary/20 group transition-all border border-white/20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-8 -mt-8 blur-3xl"}),e.jsxs("div",{className:"relative z-10 min-w-0 flex-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase opacity-60 tracking-[0.2em] block mb-1 whitespace-nowrap",children:"Ná»¢ NHÃ€ CUNG Cáº¤P:"}),e.jsx("span",{className:"text-5xl font-black tracking-tighter block truncate",children:C(jt)})]}),e.jsx(Ft,{className:"text-white/20 group-hover:rotate-12 transition-transform duration-500 shrink-0 ml-2",size:48})]}),e.jsxs("div",{className:"flex gap-4 h-[72px]",children:[e.jsxs(x.button,{whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},disabled:u.length===0,onClick:Ze,className:"w-20 bg-white/80 dark:bg-slate-800/80 text-muted dark:text-[#d4a574] rounded-[2rem] font-black text-[10px] uppercase flex flex-col items-center justify-center gap-1 hover:bg-[#d4a574]/10 transition-all border-2 border-[#d4a574]/20 group shadow-sm shrink-0",children:[e.jsx(ve,{size:18,className:"group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Táº¡m"})]}),e.jsxs(x.button,{whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},disabled:u.length===0||ce,onClick:()=>be(!1),className:"flex-1 min-w-0 bg-white/80 dark:bg-slate-800/80 text-primary dark:text-[#d4a574] rounded-[2rem] font-black hover:bg-primary/5 transition-all border-2 border-primary/20 group shadow-lg flex items-center justify-center gap-3 px-6",children:[e.jsx(Bt,{size:28,className:"group-hover:scale-110 transition-transform shrink-0"}),e.jsx("span",{className:"text-3xl uppercase tracking-widest font-black whitespace-nowrap",children:"LÆ¯U"})]}),e.jsx(x.button,{whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:17},disabled:u.length===0||ce,onClick:()=>be(!0),className:"flex-1 min-w-0 bg-gradient-to-r from-primary font-black to-primary-hover text-white rounded-[2rem] flex items-center justify-center shadow-xl shadow-primary/30 border border-white/20 transition-all group px-6",children:ce?e.jsx("div",{className:"w-6 h-6 border-4 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(dt,{size:28,className:"group-hover:translate-x-1 transition-transform shrink-0"}),e.jsx("span",{className:"text-3xl tracking-widest uppercase font-black whitespace-nowrap",children:"IN"})]})})]})]})]})]})]}),e.jsx(ee,{children:qe&&e.jsx(tt,{children:e.jsxs("div",{className:"fixed inset-0 z-[2000] flex justify-end font-sans",children:[e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]",onClick:()=>U(!1)}),e.jsxs(x.div,{initial:{x:"100%",opacity:.5},animate:{x:0,opacity:1},exit:{x:"100%",opacity:.5},transition:{type:"spring",damping:30,stiffness:300,mass:.8},className:"relative w-[340px] md:w-[400px] bg-white dark:bg-slate-900 shadow-2xl h-full flex flex-col p-8 border-l border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-gray-800 dark:text-gray-100 uppercase tracking-tighter flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-xl",children:e.jsx(ve,{className:"text-amber-600 dark:text-amber-400",size:24})}),"ÄÆ¡n nháº­p táº¡m"]}),e.jsxs("p",{className:"text-[10px] font-black text-amber-600/60 uppercase tracking-[0.2em] mt-1 ml-1",children:["Äang chá» (",S.length,")"]})]}),e.jsx("button",{onClick:()=>U(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-full transition-all hover:rotate-90",children:e.jsx(Oe,{size:24,className:"text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-auto space-y-4 pr-2 no-scrollbar",children:S.length===0?e.jsxs("div",{className:"text-center py-32 text-gray-300 dark:text-slate-700",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx(ve,{size:64,className:"opacity-20 mx-auto"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white dark:from-slate-900 to-transparent"})]}),e.jsx("p",{className:"font-black uppercase text-xs tracking-widest",children:"Trá»‘ng tráº£i..."})]}):e.jsx(ee,{mode:"popLayout",children:S.map((t,a)=>e.jsxs(x.div,{layout:!0,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.9,x:20},transition:{delay:a*.05,type:"spring",stiffness:400,damping:30},className:"bg-white dark:bg-slate-800/40 border-2 border-amber-50 dark:border-amber-900/10 rounded-[2rem] p-5 hover:border-amber-200 dark:hover:border-amber-600/30 transition-all group shadow-sm hover:shadow-xl hover:-translate-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-black text-gray-800 dark:text-gray-100 uppercase text-sm leading-tight group-hover:text-amber-600 transition-colors",children:t.partner?t.partner.name:"NCC VÃƒNG LAI"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"text-[10px] font-black text-gray-400 bg-gray-50 dark:bg-slate-900 px-2 py-0.5 rounded-full uppercase tabular-nums",children:["ðŸ•’ ",t.time]}),e.jsxs("div",{className:"text-[10px] font-black text-amber-600/70 bg-amber-50 dark:bg-amber-900/20 px-2 py-0.5 rounded-full uppercase",children:[t.cart.length," mÃ³n"]})]})]}),e.jsx("button",{onClick:()=>It(t.id),className:"text-gray-300 hover:text-rose-500 transition-colors p-1.5 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg",children:e.jsx(ct,{size:18})})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-slate-900/50 p-3 rounded-2xl border border-dashed border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-black text-gray-400 uppercase leading-none mb-1",children:"Tá»•ng cá»™ng"}),e.jsx("div",{className:"text-amber-600 dark:text-amber-400 font-black text-xl tracking-tighter",children:C(t.total)})]}),e.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>qt(t),className:"bg-gradient-to-r from-amber-500 to-amber-600 text-white px-5 py-2 rounded-xl font-black text-[11px] uppercase flex items-center gap-2 shadow-lg shadow-amber-500/30 hover:shadow-amber-500/50 transition-all",children:[e.jsx(lt,{size:14,strokeWidth:3}),"THU Há»’I"]})]})]},t.id))})}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-100 dark:border-slate-800",children:e.jsx("button",{onClick:()=>U(!1),className:"w-full py-4 rounded-2xl border-2 border-gray-200 dark:border-slate-800 text-gray-500 font-black uppercase text-xs hover:bg-gray-50 dark:hover:bg-slate-800 transition-all tracking-widest",children:"ÄÃ³ng sidebar"})})]})]})})}),e.jsx(st,{isOpen:Ce,partner:{name:Be,is_customer:!1,is_supplier:!0},onClose:()=>ue(!1),onSave:()=>{ie(),ue(!1)}}),e.jsx(rt,{isOpen:_e,product:{name:Be},onClose:()=>pe(!1),onSave:()=>{ne(),pe(!1)}}),e.jsx(rt,{isOpen:Ie,onClose:()=>Y(!1),product:yt,onSave:ne}),e.jsx(st,{isOpen:bt,partner:wt,onClose:()=>Le(!1),onSave:async()=>{if(await ie(),d){const a=(await L.get("/api/partners")).data.find(r=>r.id===d.id);a&&b(a)}}}),Ae&&e.jsx("div",{className:"only-print",children:e.jsx(nt,{data:Ae,settings:R,type:"Purchase"})}),e.jsx(ee,{children:ht&&Ke&&e.jsx(tt,{children:e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs(x.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"text-xl font-black text-slate-800 dark:text-white flex items-center gap-3 uppercase tracking-tighter",children:[e.jsx(it,{size:24,className:"text-primary"}),"XEM TRÆ¯á»šC Báº¢N IN"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center gap-2 bg-primary text-white px-6 py-2.5 rounded-2xl font-black uppercase text-xs hover:shadow-lg hover:shadow-primary/30 transition-all active:scale-95",children:[e.jsx(dt,{size:18})," In ngay"]}),e.jsx("button",{onClick:()=>Ue(!1),className:"p-2.5 bg-slate-100 dark:bg-slate-800 text-slate-400 hover:text-red-500 rounded-xl transition-all",children:e.jsx(Oe,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 bg-slate-100 dark:bg-slate-950 flex justify-center custom-scrollbar",children:e.jsx("div",{className:"bg-white shadow-2xl h-fit",children:e.jsx(nt,{data:Ke,settings:R,type:"Purchase",isPreview:!0})})})]})})})}),e.jsx(Tt,{isVisible:ce&&z.length===0,message:"Äang náº¡p dá»¯ liá»‡u Nháº­p hÃ ng..."})]})}export{ta as default};
