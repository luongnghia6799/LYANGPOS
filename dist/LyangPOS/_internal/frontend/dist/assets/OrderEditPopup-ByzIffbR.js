import{r as l,j as e}from"./vendor-C23Namvk.js";import{a as P}from"./vendor-utils-C44aPrMG.js";import{c,d as h}from"./index-DXxzNUOO.js";import{T as G}from"./Toast-rpGoMLC9.js";import{m as w,A as L}from"./vendor-framer-DVZK1f_z.js";import{aw as Q,a5 as F,X as R,$ as U,O as X,_ as J,af as V,a1 as W}from"./vendor-icons-C8Df64wb.js";function re({order:r,partner:A,onClose:x,onSave:M}){const[n,b]=l.useState(r.details.map(t=>({...t,product_id:t.product_id,quantity:t.quantity,price:t.price,unit:t.product_unit,secondary_unit:t.secondary_unit,multiplier:t.multiplier||1,secondary_qty:t.quantity/(t.multiplier||1)}))),[k,I]=l.useState(r.note||""),[p,N]=l.useState(r.amount_paid||0),[f,v]=l.useState(r.payment_method||(r.amount_paid>=r.total_amount?"Cash":"Debt")),[_,C]=l.useState(!1),[q,O]=l.useState([]),[y,S]=l.useState(""),[$,T]=l.useState(!1),[o,u]=l.useState(0),[g,z]=l.useState(null),m=l.useMemo(()=>n.reduce((t,a)=>t+a.price*a.quantity,0),[n]);l.useEffect(()=>{B()},[]),l.useEffect(()=>{const t=a=>{a.key==="Escape"&&x()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[x]);const B=async()=>{try{const t=await P.get("/api/products");O(t.data)}catch(t){console.error(t)}},j=(t,a,s)=>{const E=[...n],i=E[t];a==="secondary_qty"?(i.secondary_qty=s,i.quantity=s*i.multiplier):a==="quantity"?(i.quantity=s,i.secondary_qty=s/i.multiplier):i[a]=s,b(E)},K=t=>{b(n.filter((a,s)=>s!==t))},H=async()=>{if(n.length!==0){C(!0);try{const t={partner_id:r.partner_id,type:r.type,payment_method:f,details:n.map(a=>({product_id:a.product_id,quantity:a.quantity,price:a.price,product_name:a.product_name})),note:k,amount_paid:p};await P.put(`/api/orders/${r.id}`,t),M()}catch(t){z({message:t.response?.data?.error||"Lá»—i khi lÆ°u",type:"error"})}finally{C(!1)}}},d=l.useMemo(()=>{const t=y.toLowerCase();return t?q.filter(a=>a.name.toLowerCase().includes(t)||a.code&&a.code.toLowerCase().includes(t)).slice(0,10):[]},[q,y]),D=t=>{b([{product_id:t.id,product_name:t.name,product_unit:t.unit,secondary_unit:t.secondary_unit,multiplier:t.multiplier,quantity:1,secondary_qty:1/(t.multiplier||1),price:r.type==="Sale"?t.sale_price:t.cost_price},...n]),S(""),T(!1),u(0),setTimeout(()=>{const a=document.getElementById("edit-sec-qty-0");if(a&&t.secondary_unit)a.focus(),a.select();else{const s=document.getElementById("edit-main-qty-0");s?.focus(),s?.select()}},200)};return e.jsxs("div",{className:"fixed inset-0 z-[100000] flex items-center justify-center p-4 overflow-y-auto bg-slate-900/40 backdrop-blur-sm",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e5},children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:x,className:"fixed inset-0 bg-slate-950/60 backdrop-blur-md"}),e.jsxs(w.div,{initial:{scale:.95,opacity:0,y:30},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:30},className:"relative bg-white dark:bg-slate-950 w-full max-w-5xl max-h-[90vh] overflow-hidden rounded-[2.5rem] shadow-2xl border border-white/10 flex flex-col z-10",children:[e.jsxs("div",{className:"p-6 border-b dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:c("p-3 rounded-2xl",r.type==="Sale"?"bg-blue-100 text-blue-600":"bg-amber-100 text-amber-600"),children:r.type==="Sale"?e.jsx(Q,{size:24}):e.jsx(F,{size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tight",children:["Chi Tiáº¿t HÃ³a ÄÆ¡n #",r.display_id]}),e.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mt-0.5",children:[r.type==="Sale"?"BÃ¡n hÃ ng":"Nháº­p hÃ ng"," â€¢ Äá»‘i tÃ¡c: ",r.partner_name||A?.name||"KhÃ¡ch Láº»"]})]})]}),e.jsx("button",{onClick:x,className:"p-3 hover:bg-rose-50 dark:hover:bg-rose-900/20 text-slate-400 hover:text-rose-500 rounded-2xl transition-all",children:e.jsx(R,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden border-r dark:border-slate-800",children:[e.jsx("div",{className:"p-4 bg-slate-50/30 dark:bg-slate-900/30 border-b dark:border-slate-800",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-4 top-3.5 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"ðŸ” TÃ¬m sáº£n pháº©m thÃªm vÃ o Ä‘Æ¡n...",className:"w-full pl-11 p-3.5 bg-white dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 rounded-2xl focus:border-primary outline-none font-bold text-sm transition-all",value:y,onChange:t=>{S(t.target.value),T(!0),u(0)},onKeyDown:t=>{t.key==="ArrowDown"?(t.preventDefault(),u(a=>Math.min(a+1,d.length-1))):t.key==="ArrowUp"?(t.preventDefault(),u(a=>Math.max(a-1,0))):(t.key==="Enter"||t.key==="Tab")&&d[o]&&(t.preventDefault(),D(d[o]))}}),e.jsx(L,{children:$&&d.length>0&&e.jsx(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute left-0 right-0 top-full mt-2 bg-white dark:bg-slate-900 rounded-2xl shadow-2xl border dark:border-slate-800 z-50 overflow-hidden",children:d.map((t,a)=>e.jsxs("div",{onClick:()=>D(t),className:c("p-3 cursor-pointer flex justify-between items-center transition-colors",a===o?"bg-primary text-white":"hover:bg-slate-50 dark:hover:bg-slate-800"),children:[e.jsxs("div",{children:[e.jsx("div",{className:c("font-bold text-sm",a===o?"text-white":"dark:text-white"),children:t.name}),e.jsxs("div",{className:c("text-[10px] uppercase font-bold",a===o?"text-white/80":"text-slate-400"),children:[t.unit," - ",h(r.type==="Sale"?t.sale_price:t.cost_price)]})]}),e.jsx(X,{size:16,className:a===o?"text-white":"text-primary"})]},t.id))},"product-dropdown")})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:e.jsxs("table",{className:"w-full text-left border-separate border-spacing-y-2",children:[e.jsx("thead",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest sticky top-0 bg-white dark:bg-slate-950 z-10 p-2",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Sáº£n pháº©m"}),e.jsx("th",{className:"p-2 w-28",children:"Quy cÃ¡ch"}),e.jsx("th",{className:"p-2 w-28",children:"Sá»‘ lÆ°á»£ng"}),e.jsx("th",{className:"p-2 w-32",children:"ÄÆ¡n giÃ¡"}),e.jsx("th",{className:"p-2 text-right",children:"ThÃ nh tiá»n"}),e.jsx("th",{className:"p-2 w-10"})]})}),e.jsx("tbody",{children:n.map((t,a)=>e.jsxs("tr",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl overflow-hidden group",children:[e.jsxs("td",{className:"p-3 rounded-l-2xl",children:[e.jsx("div",{className:"font-bold text-sm dark:text-white line-clamp-1",children:t.product_name}),e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase",children:t.product_unit})]}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 bg-white dark:bg-slate-800 px-2 py-1.5 rounded-xl border border-slate-100 dark:border-slate-800",children:[e.jsx("input",{type:"number",className:"w-full bg-transparent outline-none font-black text-xs text-primary text-center",id:`edit-sec-qty-${a}`,value:t.secondary_qty,onFocus:s=>s.target.select(),onChange:s=>j(a,"secondary_qty",parseFloat(s.target.value)||0)}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase",children:t.secondary_unit||"..."})]})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 px-2 py-1.5 rounded-xl border border-slate-100 dark:border-slate-800",children:e.jsx("input",{type:"number",className:"w-full bg-transparent outline-none font-black text-xs text-slate-600 dark:text-slate-300 text-center",id:`edit-main-qty-${a}`,value:t.quantity,onFocus:s=>s.target.select(),onChange:s=>j(a,"quantity",parseFloat(s.target.value)||0)})})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 px-2 py-1.5 rounded-xl border border-slate-100 dark:border-slate-800",children:e.jsx("input",{type:"number",className:"w-full bg-transparent outline-none font-black text-xs text-emerald-600 dark:text-emerald-400 text-right",id:`edit-price-${a}`,value:t.price,onFocus:s=>s.target.select(),onChange:s=>j(a,"price",parseFloat(s.target.value)||0)})})}),e.jsx("td",{className:"p-3 text-right font-black text-slate-700 dark:text-slate-200",children:h(t.price*t.quantity)}),e.jsx("td",{className:"p-3 text-center rounded-r-2xl",children:e.jsx("button",{onClick:()=>K(a),className:"text-slate-300 hover:text-rose-500 transition-colors",children:e.jsx(J,{size:16})})})]},a))})]})})]}),e.jsxs("div",{className:"w-full lg:w-80 bg-slate-50/50 dark:bg-slate-900/30 p-6 flex flex-col gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1",children:"HÃ¬nh thá»©c thanh toÃ¡n"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>v("Cash"),className:c("p-3 rounded-2xl font-black text-xs uppercase flex flex-col items-center gap-2 border-2 transition-all",f==="Cash"?"bg-emerald-600 border-emerald-500 text-white shadow-lg shadow-emerald-600/20":"bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800 text-slate-400"),children:[e.jsx(V,{size:18})," Tiá»n máº·t"]}),e.jsxs("button",{onClick:()=>v("Debt"),className:c("p-3 rounded-2xl font-black text-xs uppercase flex flex-col items-center gap-2 border-2 transition-all",f==="Debt"?"bg-amber-500 border-amber-400 text-white shadow-lg shadow-amber-500/20":"bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800 text-slate-400"),children:[e.jsx(F,{size:18})," CÃ´ng ná»£"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1",children:"Thanh toÃ¡n (ÄÃ£ tráº£)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"w-full p-4 bg-white dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 rounded-2xl outline-none focus:border-primary font-black text-lg text-primary text-right",value:p,onChange:t=>N(parseFloat(t.target.value)||0)}),e.jsx("button",{onClick:()=>N(m),className:"absolute left-3 top-4 text-[10px] font-black text-slate-300 hover:text-primary uppercase",children:"Táº¥t cáº£"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1",children:"Ghi chÃº Ä‘Æ¡n hÃ ng"}),e.jsx("textarea",{className:"w-full p-4 bg-white dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 rounded-2xl outline-none focus:border-primary font-bold text-sm min-h-[80px]",placeholder:"Ná»™i dung ghi chÃº...",value:k,onChange:t=>I(t.target.value)})]})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t dark:border-slate-800 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-slate-400",children:"Tá»•ng cá»™ng"}),e.jsx("span",{className:"text-2xl font-black text-slate-800 dark:text-white",children:h(m)})]}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-slate-400",children:"CÃ²n láº¡i"}),e.jsx("span",{className:c("text-sm font-black",m-p>0?"text-rose-500":"text-emerald-500"),children:h(m-p)})]}),e.jsxs("button",{onClick:H,disabled:_,className:"w-full py-4 bg-primary text-white rounded-[2rem] font-black uppercase tracking-widest shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-3",children:[e.jsx(W,{size:20})," ",_?"Äang lÆ°u...":"LÆ°u cáº­p nháº­t"]})]})]})]})]}),e.jsx(L,{children:g&&e.jsx(G,{message:g.message,type:g.type,onClose:()=>z(null)})})]})}export{re as O};
