import{r as l,j as e,a0 as Jt,a9 as K}from"./vendor-C23Namvk.js";import{a as z}from"./vendor-utils-C44aPrMG.js";import{c as x,b as Xt,d as y,a as Yt,P as ht,L as Zt}from"./index-DXxzNUOO.js";import{D as ft}from"./settings-DRiS_Ul1.js";import{P as gt}from"./ProductEditModal-BVhwk0Ym.js";import{P as bt}from"./PartnerEditModal-CErylDqj.js";import{P as yt}from"./PrintTemplate-LOkWw4wH.js";import{A as Q,m}from"./vendor-framer-DVZK1f_z.js";import{a as Ct,X as we,l as Ve,t as wt,b as ea,I as Ge,W as Be,c as le,J as kt,r as ta,a4 as aa,N as ra,O as Ke,Q as ye,V as vt,Y as Qe,$ as sa,k as na,_ as jt,m as Nt,a1 as _t,a2 as Ue,L as ia,d as la}from"./vendor-icons-C8Df64wb.js";import"./Toast-rpGoMLC9.js";function oa({partner:N,isOpen:oe,onClose:L,onAddToCart:Te}){const[_,E]=l.useState([]),[u,C]=l.useState([]),[d,v]=l.useState(!1),[O,T]=l.useState("invoices");l.useEffect(()=>{oe&&N&&ce()},[oe,N]);const ce=async()=>{v(!0);try{const p=await z.get(`/api/orders?partner_id=${N.id}&limit=10&type=Purchase`),w=p.data.items||p.data;E(w);const h={};w.forEach(b=>{b.details.forEach(f=>{h[f.product_id]||(h[f.product_id]={id:f.product_id,name:f.product_name,unit:f.product_unit,price:f.price,total_qty:0,last_price:f.price,last_date:b.date,multiplier:f.multiplier,secondary_unit:f.secondary_unit,stock:f.stock}),h[f.product_id].total_qty+=f.quantity,new Date(b.date)>new Date(h[f.product_id].last_date)&&(h[f.product_id].last_date=b.date,h[f.product_id].last_price=f.price)})}),C(Object.values(h).sort((b,f)=>f.total_qty-b.total_qty))}catch(p){console.error("Error fetching Purchase history:",p)}finally{v(!1)}},[D,M]=l.useState({}),G=p=>{M(w=>({...w,[p]:!w[p]}))};return e.jsx(Q,{children:oe&&e.jsxs("div",{className:"fixed inset-0 z-[5000] flex justify-end",children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:L,className:"absolute inset-0 bg-black/20 backdrop-blur-[2px]"}),e.jsxs(m.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"relative w-[400px] h-full bg-white dark:bg-slate-900 shadow-2xl flex flex-col border-l border-[#d4a574]/30",children:[e.jsxs("div",{className:"p-6 border-b dark:border-slate-800 bg-gradient-to-r from-[#d4a574]/10 to-transparent flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-[#d4a574]/20 rounded-xl text-[#d4a574]",children:e.jsx(Ct,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-gray-800 dark:text-gray-100 uppercase tracking-tighter leading-none",children:"Lá»‹ch sá»­ nháº­p hÃ ng"}),e.jsx("p",{className:"text-[10px] font-bold text-[#d4a574]/80 uppercase tracking-widest mt-1",children:N.name})]})]}),e.jsx("button",{onClick:L,className:"p-2 hover:bg-rose-50 dark:hover:bg-rose-900/20 text-gray-400 hover:text-rose-500 rounded-xl transition-all",children:e.jsx(we,{size:20})})]}),e.jsxs("div",{className:"flex p-4 gap-2",children:[e.jsxs("button",{onClick:()=>T("invoices"),className:x("flex-1 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2",O==="invoices"?"bg-[#d4a574] text-white shadow-lg shadow-[#d4a574]/20":"bg-gray-100 dark:bg-slate-800 text-gray-500 hover:bg-gray-200 dark:hover:bg-slate-700"),children:[e.jsx(Ve,{size:16})," Phiáº¿u nháº­p"]}),e.jsxs("button",{onClick:()=>T("products"),className:x("flex-1 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2",O==="products"?"bg-[#d4a574] text-white shadow-lg shadow-[#d4a574]/20":"bg-gray-100 dark:bg-slate-800 text-gray-500 hover:bg-gray-200 dark:hover:bg-slate-700"),children:[e.jsx(wt,{size:16})," Sáº£n pháº©m"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-4 space-y-3",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-30",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-[#d4a574] border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("span",{className:"font-black text-[10px] uppercase tracking-[0.2em]",children:"Äang táº£i..."})]}):O==="invoices"?_.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-300 dark:text-slate-700",children:[e.jsx(Ve,{size:48,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"font-black uppercase text-xs tracking-widest",children:"ChÆ°a cÃ³ phiáº¿u nháº­p nÃ o"})]}):_.map((p,w)=>{const h=D[p.id],b=h?p.details:p.details.slice(0,3);return e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:w*.05},className:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-2xl border border-transparent hover:border-[#d4a574]/20 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-black text-[#d4a574] uppercase",children:["#",p.display_id||p.id]}),e.jsxs("div",{className:"text-[10px] font-bold text-gray-400 flex items-center gap-1 mt-0.5",children:[e.jsx(ea,{size:10})," ",Xt(p.date)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-black text-gray-800 dark:text-gray-100",children:y(p.total_amount)}),e.jsx("div",{className:x("text-[9px] font-black uppercase px-1.5 py-0.5 rounded ml-auto w-fit mt-1",p.payment_method==="Debt"?"bg-rose-100 text-rose-600":"bg-emerald-100 text-emerald-600"),children:p.payment_method==="Debt"?"Ghi ná»£":"Tiá»n máº·t"})]})]}),e.jsxs("div",{className:"space-y-1 bg-white/50 dark:bg-slate-900/50 p-2 rounded-xl",children:[b.map((f,Y)=>e.jsxs("div",{className:"text-[10px] flex justify-between text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"truncate flex-1 pr-2 uppercase font-bold",children:["â€¢ ",f.product_name]}),e.jsxs("span",{className:"font-black",children:["x",y(f.quantity)]})]},Y)),p.details.length>3&&e.jsx("button",{onClick:()=>G(p.id),className:"text-[9px] text-[#d4a574] font-bold italic w-full text-left pt-1",children:h?"Thu gá»n":`... vÃ  ${p.details.length-3} sáº£n pháº©m khÃ¡c`})]})]},p.id)}):u.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-300 dark:text-slate-700",children:[e.jsx(wt,{size:48,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"font-black uppercase text-xs tracking-widest",children:"ChÆ°a nháº­p sáº£n pháº©m nÃ o"})]}):u.map((p,w)=>e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:w*.05},className:"bg-gray-50 dark:bg-slate-800/50 p-4 rounded-2xl border border-transparent hover:border-[#d4a574]/20 transition-all group flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("div",{className:"font-black text-xs text-gray-800 dark:text-gray-100 uppercase truncate",title:p.name,children:p.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-[10px] font-black text-[#d4a574] tabular-nums",children:["ÄÃ£ nháº­p: ",y(p.total_qty)," ",p.unit]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),e.jsxs("span",{className:"text-[10px] font-bold text-gray-400",children:["GiÃ¡ nháº­p cuois: ",y(p.last_price)]})]})]}),e.jsx("button",{onClick:()=>Te(p),className:"w-10 h-10 bg-white dark:bg-slate-700 text-[#d4a574] hover:bg-[#d4a574] hover:text-white rounded-xl shadow-sm flex items-center justify-center transition-all active:scale-90",title:"ThÃªm vÃ o phiáº¿u nháº­p",children:e.jsx(Ge,{size:20})})]},p.id))}),e.jsx("div",{className:"p-6 bg-gray-50 dark:bg-slate-800/50 border-t dark:border-slate-800",children:e.jsxs("div",{className:"bg-[#d4a574]/5 rounded-2xl p-4 border border-[#d4a574]/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Tá»•ng ná»£ hiá»‡n táº¡i"}),N.debt_balance!==0&&e.jsx("span",{className:"p-1 px-2 bg-rose-100 text-rose-600 rounded text-[9px] font-black uppercase",children:"Äang ná»£"})]}),e.jsxs("div",{className:"text-2xl font-black text-rose-500 tracking-tighter tabular-nums",children:[y(N.debt_balance)," ",e.jsx("span",{className:"text-xs",children:"VNÄ"})]})]})})]})]})})}function wa(){const[N,oe]=l.useState([]),[L,Te]=l.useState([]),[_,E]=l.useState(""),[u,C]=l.useState([]),[d,v]=l.useState(null),[O,T]=l.useState(""),[ce,D]=l.useState(!1),[M,G]=l.useState(""),[p,w]=l.useState(0),[h,b]=l.useState(()=>(localStorage.getItem("unified_pos_mode")||"Wholesale")==="Wholesale"?"Pending":"Cash"),[f,Y]=l.useState(null),[U,Je]=l.useState(!1),[q,ke]=l.useState(null),[Z,Xe]=l.useState(null),[De,Ye]=l.useState(null),[R,Pe]=l.useState(0),[St,Ze]=l.useState(!1),[g,ee]=l.useState(0),[$,qt]=l.useState(ft),[ze,ve]=l.useState(!1),[Le,je]=l.useState(!1),[et,tt]=l.useState(""),[It,at]=l.useState(!1),[rt,Tt]=l.useState(null),[ca,de]=l.useState(null),[Dt,Pt]=l.useState([]),[st,nt]=l.useState(""),te=Jt(),[W,Ee]=l.useState(()=>{const t=localStorage.getItem("held_purchases");return t?JSON.parse(t):[]}),[Oe,J]=l.useState(!1),[ue,it]=l.useState(!1),[I,zt]=l.useState(()=>localStorage.getItem("unified_pos_mode")||"Wholesale"),[i,H]=l.useState({product:null,quantity:1,price:0,secondary_qty:0,name:""}),[ae,V]=l.useState(null),[re,lt]=l.useState(""),[pe,Ne]=l.useState(0),[We,se]=l.useState(!1),[Lt,_e]=l.useState(null);K.useRef({});const F=K.useRef(null),ne=K.useRef(null),Ae=K.useRef(null),Ce=K.useRef(null),Me=K.useRef(null),Re=K.useRef(null),xe=K.useRef(null),me=K.useRef(null);l.useEffect(()=>{const t=a=>{a.key==="F3"&&(a.preventDefault(),me.current?.focus(),me.current?.select())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const[Et,$e]=l.useState(!1),[Ot,ot]=l.useState(null),[ct,Wt]=l.useState(!1),[dt,At]=l.useState(new Date),[Mt,ut]=l.useState(!1);l.useEffect(()=>{const t=setInterval(()=>At(new Date),1e3);return()=>clearInterval(t)},[]);const pt=l.useMemo(()=>i.product?i.price*i.quantity:0,[i.product,i.price,i.quantity]),A=l.useMemo(()=>u.reduce((t,a)=>t+a.price*a.quantity,0)+pt,[u,pt]),Rt=l.useMemo(()=>u.length+(i.product?1:0),[u,i.product]),$t=l.useMemo(()=>u.reduce((t,a)=>t+(a.quantity||0),0)+(i.quantity||0),[u,i.quantity]),Ht=l.useMemo(()=>u.reduce((t,a)=>t+(a.secondary_qty||0),0)+(i.secondary_qty||0),[u,i.secondary_qty]),Se=l.useMemo(()=>{if(!d)return 0;let t=d.debt_balance;if(q&&Z&&d.id===Z.partner_id&&Z.payment_method==="Debt"){const a=(Z.total_amount||0)-(Z.amount_paid||0);t+=a}return t},[d,q,Z]),Ft=h==="Debt"?Se-(A>=0?A-p:A+p):Se;l.useEffect(()=>{localStorage.setItem("held_purchases",JSON.stringify(W))},[W]);const he=async()=>{try{const t=await z.get("/api/products");oe(t.data)}catch(t){console.error(t)}},fe=async()=>{try{const t=await z.get("/api/partners");Te(t.data)}catch(t){console.error(t)}},Bt=async()=>{try{const t=await z.get("/api/bank-accounts");Pt(t.data),t.data.length>0&&nt(t.data[0].id)}catch(t){console.error(t)}},Kt=async()=>{try{const[t,a]=await Promise.all([z.get("/api/print-templates?module=Purchase"),z.get("/api/settings")]);let r={...ft};if(a.data&&(r={...r,...a.data}),t.data&&t.data.length>0){const n=t.data.find(o=>o.is_default)||t.data[0];if(n)try{const o=JSON.parse(n.config);r={...r,...o}}catch(o){console.error("Error parsing template config",o)}}qt(r);const s=q||te.state?.editOrder||new URLSearchParams(window.location.search).get("edit");u.length===0&&!s&&b(I==="Wholesale"?"Pending":"Cash")}catch(t){console.error("Lá»—i khi táº£i cÃ i Ä‘áº·t:",t)}},qe=()=>{const t=localStorage.getItem("purchase_draft");if(t)try{const a=JSON.parse(t);if(C(a.cart||[]),G(a.note||""),w(a.amountPaid||0),b(a.paymentMethod||(localStorage.getItem("unified_pos_mode")==="Wholesale"?"Pending":"Cash")),a.selectedPartnerId){const r=L.find(s=>s.id===a.selectedPartnerId);v(r||null)}else v(null);return ke(null),Pe(0),!0}catch(a){console.error("Error loading draft",a)}return!1},He=t=>{ke(t.id),Xe(t),C(t.details.map(a=>({product_id:a.product_id,product_name:a.product_name,unit:a.product_unit,secondary_unit:a.secondary_unit,multiplier:a.multiplier||1,price:a.price,quantity:a.quantity,secondary_qty:a.quantity/(a.multiplier||1),stock:a.stock||0,active_ingredient:a.active_ingredient}))),G(t.note||""),w(t.amount_paid||0),b(t.payment_method),Ye(t.partner_id),T(""),E(""),D(!1)},Qt=async t=>{try{const a=await z.get(`/api/orders/${t}`);a.data&&He(a.data)}catch(a){console.error("Error fetching order",a),de({message:"KhÃ´ng tÃ¬m tháº¥y hÃ³a Ä‘Æ¡n",type:"error"})}};l.useEffect(()=>{if(he(),fe(),Kt(),Bt(),te.state?.editOrder||qe(),te.state?.editOrder)He(te.state.editOrder);else{const a=new URLSearchParams(window.location.search).get("edit");a?Qt(a):q&&B(!1)}Wt(!0)},[te.search,te.state]);const Ut=t=>{zt(t),localStorage.setItem("unified_pos_mode",t),u.length===0&&!q&&b(t==="Wholesale"?"Pending":"Cash")};l.useEffect(()=>{h==="Cash"&&w(A)},[h,A]),l.useEffect(()=>{if(ct&&!q){const t={cart:u,selectedPartnerId:d?.id,note:M,amountPaid:p,paymentMethod:h};localStorage.setItem("purchase_draft",JSON.stringify(t))}},[u,d,M,p,h,q,ct]),l.useEffect(()=>{const t=a=>{const r=a.key.toUpperCase();a.key==="Escape"?(ce||Oe||ze||Le||We||_||ae!==null)&&(D(!1),J(!1),ve(!1),je(!1),se(!1),E(""),V(null)):r===($.kb_search||"F2").toUpperCase()?(a.preventDefault(),F.current?.focus()):r===($.kb_save||"F12").toUpperCase()?(a.preventDefault(),ie(!1)):r===($.kb_pay||"F9").toUpperCase()?(a.preventDefault(),ie(!0)):r===($.kb_new||"F4").toUpperCase()?(a.preventDefault(),B()):r===($.kb_hold||"F8").toUpperCase()&&(a.preventDefault(),Fe())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[u,d,p,M,$,ce,Oe,ze,Le,We,_,ae]),l.useEffect(()=>{if(L.length>0&&De){const t=L.find(a=>a.id==De);t&&(v(t),Ye(null),T(""))}},[L,De]);const ge=(t,a=null,r=null)=>{const s=a!==null?a:1,n=u.find(c=>c.product_id===t.id),o=r!==null?r:t.cost_price;C(n?u.map(c=>c.product_id===t.id?{...c,quantity:c.quantity+s,price:o,secondary_qty:(c.quantity+s)/(c.multiplier||1)}:c):[{product_id:t.id,product_name:t.name,unit:t.unit,secondary_unit:t.secondary_unit,multiplier:t.multiplier||1,price:o,quantity:s,secondary_qty:s/(t.multiplier||1),stock:t.stock,active_ingredient:t.active_ingredient},...u]),E(""),ee(0),H({product:null,quantity:1,price:0,secondary_qty:0,name:""}),setTimeout(()=>F.current?.focus(),10)},Ie=(t,a,r)=>{const s=[...u],n=s[t];a==="secondary_qty"?(n.secondary_qty=r,n.quantity=r*n.multiplier):a==="quantity"?(n.quantity=r,n.secondary_qty=r/n.multiplier):n[a]=r,C(s)},ie=async(t=!0)=>{let a=[...u];if(i.product&&i.quantity!==0){const r=a.findIndex(s=>s.product_id===i.product.id&&s.price===i.price);r>-1?(a[r].quantity+=i.quantity,a[r].secondary_qty+=i.secondary_qty):a=[{product_id:i.product.id,product_name:i.product.name,unit:i.product.unit,secondary_unit:i.product.secondary_unit,multiplier:i.product.multiplier||1,price:i.price,stock:i.product.stock,quantity:i.quantity,secondary_qty:i.secondary_qty},...a]}if(a.length!==0){Je(!0);try{const r={partner_id:d?d.id:null,type:"Purchase",payment_method:h,details:a.map(n=>({product_id:n.product_id,product_name:n.product_name,quantity:n.quantity,price:n.price})),note:M,amount_paid:p,bank_account_id:h==="Transfer"?st:null};let s;q?s=await z.put(`/api/orders/${q}`,r):s=await z.post("/api/orders",r),Y(s.data),t?setTimeout(()=>{window.print(),setTimeout(()=>{B(!1),he(),fe(),Y(null)},1e3)},1e3):(B(!1),he(),fe(),de({message:"ÄÃ£ lÆ°u Ä‘Æ¡n nháº­p hÃ ng thÃ nh cÃ´ng!",type:"success"}),Y(null),localStorage.removeItem("purchase_draft"))}catch(r){de({message:r.response?.data?.error||"Lá»—i khi lÆ°u Ä‘Æ¡n nháº­p hÃ ng",type:"error"})}finally{Je(!1)}}},B=(t=!1)=>{C([]),t||(v(null),T("")),E(""),D(!1),w(0);const a=I==="Wholesale"?"Pending":"Cash";b(a),a==="Cash"&&w(0),G(""),ke(null),Xe(null),Y(null),Pe(0),setTimeout(()=>F.current?.focus(),100)},xt=async t=>{let a;if(t==="prev"?a=R+1:a=Math.max(0,R-1),a===0){qe()||B();return}try{Ze(!0);const r=await z.get(`/api/orders?type=Purchase&limit=1&page=${a}`),s=r.data.items||r.data;if(s&&s.length>0){const n=s[0];await new Promise(c=>setTimeout(c,150)),He(n);const o=L.find(c=>c.id===n.partner_id);v(o||null),Pe(a)}else t==="prev"?de({message:"KhÃ´ng cÃ²n Ä‘Æ¡n nháº­p hÃ ng cÅ© hÆ¡n.",type:"error"}):qe()||B()}catch(r){console.error(r),de({message:"Lá»—i khi táº£i lá»‹ch sá»­ Ä‘Æ¡n nháº­p hÃ ng",type:"error"})}finally{setTimeout(()=>Ze(!1),300)}},Fe=()=>{if(u.length===0)return;const t={id:Date.now(),cart:[...u],partner:d,total:A,time:new Date().toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),note:M,paymentMethod:h,editOrderId:q};Ee([t,...W]),localStorage.removeItem("purchase_draft"),B(),J(!0)},Vt=t=>{C(t.cart),v(t.partner),G(t.note||""),b(t.paymentMethod||(I==="Wholesale"?"Pending":"Cash")),ke(t.editOrderId||null),Ee(W.filter(a=>a.id!==t.id)),J(!1)},Gt=t=>Ee(W.filter(a=>a.id!==t)),X=l.useMemo(()=>{const t=_.toLowerCase();return t?N.filter(a=>(a.name||"").toLowerCase().includes(t)||(a.code||"").toLowerCase().includes(t)||(a.active_ingredient||"").toLowerCase().includes(t)).sort((a,r)=>{const s=(a.name||"").toLowerCase(),n=(r.name||"").toLowerCase(),o=s.startsWith(t),c=n.startsWith(t);return o&&!c?-1:!o&&c?1:a.code?.toLowerCase()===t&&r.code?.toLowerCase()!==t?-1:a.code?.toLowerCase()!==t&&r.code?.toLowerCase()===t?1:s.localeCompare(n,"vi",{sensitivity:"base"})}).slice(0,10):N.slice(0,10)},[N,_]),be=l.useMemo(()=>{const t=O.toLowerCase();return L.filter(a=>(a.name||"").toLowerCase().includes(t)||(a.phone||"").includes(t)).sort((a,r)=>{const s=(a.name||"").toLowerCase(),n=(r.name||"").toLowerCase(),o=s.startsWith(t),c=n.startsWith(t);return o&&!c?-1:!o&&c?1:s.localeCompare(n,"vi",{sensitivity:"base"})})},[L,O]);return e.jsx("div",{className:"flex flex-col h-screen main-content-bg font-sans overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden no-print",children:[e.jsxs("div",{className:"p-4 flex gap-6 items-center print:hidden transition-colors relative border-[#d4a574]/20 z-[110]",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute right-[-40px] top-[-40px] opacity-[0.03] dark:opacity-[0.06] -rotate-12 transition-all duration-1000",children:e.jsx(Be,{size:240,className:"text-primary"})}),e.jsx("div",{className:"absolute left-[-20px] bottom-[-20px] opacity-[0.02] dark:opacity-[0.04] rotate-45 transition-all duration-1000",children:e.jsx(le,{size:180,className:"text-[#4a7c59]"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mr-4 relative z-10",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-primary-hover rounded-2xl shadow-lg",children:e.jsx(Be,{size:28,className:"text-white",strokeWidth:2.5})}),e.jsxs("h1",{className:"text-2xl font-black text-primary dark:text-[#d4a574] uppercase tracking-tighter flex items-center gap-2",children:["Kho HÃ ng",e.jsxs("span",{className:"text-sm font-bold px-3 py-1 bg-gradient-to-r from-[#d4a574]/20 to-[#f4c430]/20 text-muted dark:text-[#d4a574] rounded-xl border border-[#d4a574]/30",children:["#",q||"Má»šI"]})]}),e.jsxs("button",{onClick:()=>{const t={display_id:q?`ÄÆ¡n #${q}`:"XEM TRÆ¯á»šC",date:new Date().toISOString(),partner_name:d?d.name:"NCC VÃ£ng Lai",partner_address:d?d.address:"",partner_phone:d?d.phone:"",total_amount:A,amount_paid:p,payment_method:h,note:M,old_debt:Se,partner_id:d?d.id:null,details:u.map(a=>({...a}))};Tt(t),at(!0)},className:"flex items-center gap-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm text-muted hover:text-primary hover:bg-[#d4a574]/20 dark:hover:bg-[#4a7c59]/20 px-4 py-2 rounded-xl border-2 border-[#d4a574]/30 transition-all font-black text-[10px] uppercase tracking-widest shadow-sm hover:shadow-md",children:[e.jsx(kt,{size:16})," Xem trÆ°á»›c in"]})]}),e.jsxs("div",{className:"flex-1 flex gap-4 relative z-10",children:[e.jsxs("div",{className:"w-80 relative z-50",onBlur:()=>setTimeout(()=>D(!1),200),children:[e.jsxs("div",{className:"relative cursor-pointer",onDoubleClick:t=>{t.preventDefault(),d&&(ot(d),$e(!0))},children:[e.jsx(le,{className:"absolute left-3 top-3 text-[#4a7c59]",size:18,strokeWidth:2.5}),e.jsx("input",{type:"text",className:"w-full pl-10 p-2.5 border-2 border-[#d4a574]/30 dark:border-slate-800 rounded-xl focus:border-primary dark:focus:border-[#4a7c59] outline-none font-bold text-primary dark:text-gray-200 bg-white/90 dark:bg-slate-950/90 backdrop-blur-sm cursor-pointer transition-all shadow-sm focus:shadow-md",ref:me,placeholder:"ðŸ” TÃ¬m kiáº¿m NCC...",value:d?d.name:O,onDoubleClick:t=>{d&&(t.stopPropagation(),ot(d),$e(!0))},onChange:t=>{T(t.target.value),d&&v(null),D(!0)},onKeyDown:t=>{if(t.key==="ArrowDown")t.preventDefault(),ee(a=>{const r=Math.min(a+1,be.length),s=Me.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="ArrowUp")t.preventDefault(),ee(a=>{const r=Math.max(a-1,0),s=Me.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="Enter"){if(t.preventDefault(),g===0)v(null),T(""),D(!1);else if(be[g-1]){const a=be[g-1];v(a),T(""),D(!1)}}}}),d&&e.jsx("button",{onClick:()=>{v(null),T("")},className:"absolute right-3 top-3 text-muted hover:text-red-500 transition-colors",children:e.jsx(we,{size:16})})]}),e.jsx(Q,{children:ce&&!d&&e.jsxs(m.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{type:"spring",stiffness:400,damping:30},className:"dropdown-premium min-w-[320px] !z-[200]",ref:Me,children:[e.jsxs("div",{className:x("dropdown-item flex items-center gap-3",g===0&&"active"),onClick:()=>{v(null),T(""),D(!1)},children:[e.jsx("div",{className:x("w-8 h-8 rounded-full flex items-center justify-center transition-colors",g===0?"bg-white/20 text-white":"bg-gray-100 dark:bg-slate-800 text-gray-500"),children:e.jsx(ta,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:x("font-black uppercase tracking-tight",g===0?"text-white":"text-gray-800 dark:text-gray-100"),children:"NCC vÃ£ng lai"}),e.jsx("div",{className:x("text-[10px] font-bold",g===0?"text-white/70":"text-gray-400"),children:"Mua hÃ ng thanh toÃ¡n ngay"})]})]}),e.jsx("div",{className:"max-h-[350px] overflow-y-auto no-scrollbar scroll-smooth",children:be.map((t,a)=>e.jsxs("div",{onClick:()=>{v(t),T(""),D(!1)},className:x("dropdown-item flex justify-between items-center",g===a+1&&"active"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:x("w-8 h-8 rounded-full flex items-center justify-center transition-colors",g===a+1?"bg-white/20 text-white":"bg-primary/10 text-primary"),children:e.jsx(aa,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:x("font-black uppercase tracking-tight",g===a+1?"text-white":"text-gray-800 dark:text-gray-100"),children:t.name}),e.jsxs("div",{className:x("text-[10px] font-bold flex items-center gap-2",g===a+1?"text-white/70":"text-gray-400"),children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(ra,{size:10,strokeWidth:3})," ",t.phone||"N/A"]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-current opacity-30"}),e.jsx("span",{className:"flex items-center gap-0.5 uppercase tracking-tighter",children:t.is_customer&&t.is_supplier?"KH & NCC":t.is_customer?"KhÃ¡ch hÃ ng":"NhÃ  CC"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:x("text-[10px] font-black uppercase opacity-60 mb-0.5",g===a+1?"text-white/60":"text-gray-400"),children:"DÆ° ná»£"}),e.jsx("div",{className:x("font-black text-sm",g===a+1?"text-white":"text-red-500"),children:Yt(t.debt_balance)})]})]},t.id))}),O&&be.length===0&&e.jsxs("div",{className:"p-4 bg-primary text-white cursor-pointer font-black uppercase text-xs flex items-center gap-2 hover:brightness-110 transition-all",onClick:()=>{tt(O),ve(!0),D(!1)},children:[e.jsx(Ke,{size:18,strokeWidth:3}),' ThÃªm nhÃ  cung cáº¥p má»›i: "',O,'"']})]})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(m.button,{whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},onClick:()=>J(!0),className:"relative p-2.5 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm text-muted dark:text-gray-400 rounded-xl hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all font-bold flex items-center gap-2 border-2 border-[#d4a574]/20 shadow-sm hover:shadow-md",title:"ÄÆ¡n nháº­p táº¡m",children:[e.jsx(ye,{size:20}),W.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-gradient-to-br from-[#f4c430] to-[#d4a574] text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-black shadow-lg",children:W.length}),e.jsx("span",{className:"hidden lg:inline text-xs uppercase",children:"ÄÆ¡n Táº¡m"})]}),e.jsxs("div",{className:"flex bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-xl overflow-hidden shadow-sm border-2 border-[#d4a574]/20",children:[e.jsx(m.button,{whileTap:{scale:.9},onClick:()=>xt("prev"),className:"p-2.5 text-muted dark:text-gray-400 hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all border-r border-[#d4a574]/20 dark:border-slate-700",title:"ÄÆ¡n trÆ°á»›c",children:e.jsx(vt,{size:20})}),e.jsxs(m.button,{whileTap:{scale:.95},onClick:()=>{R!==0&&(qe()||B())},className:"px-3 flex flex-col items-center justify-center min-w-[70px] hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-colors",title:"Quay vá» Ä‘Æ¡n má»›i",children:[e.jsx("span",{className:x("text-[10px] font-black uppercase tracking-tighter",R===0?"text-primary dark:text-[#4a7c59]":"text-[#f4c430]"),children:R===0?"Má»›i":`#${R}`}),R!==0&&e.jsx("span",{className:"text-[8px] font-bold text-muted dark:text-gray-400 uppercase leading-none",children:"Vá» Má»›i"})]}),e.jsx(m.button,{whileTap:{scale:.9},onClick:()=>xt("next"),disabled:R===0,className:x("p-2.5 text-muted dark:text-gray-400 hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all border-l border-[#d4a574]/20 dark:border-slate-700",R===0&&"opacity-30 cursor-not-allowed"),title:"ÄÆ¡n sau",children:e.jsx(Ge,{size:20})})]}),e.jsxs(m.button,{whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},onClick:B,className:"p-2.5 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm text-muted dark:text-gray-400 rounded-xl hover:bg-[#d4a574]/20 dark:hover:bg-slate-700 transition-all font-bold flex items-center gap-2 border-2 border-[#d4a574]/20 shadow-sm hover:shadow-md",title:"LÃ m má»›i",children:[e.jsx(Qe,{size:20}),e.jsx("span",{className:"hidden lg:inline text-xs uppercase",children:"LÃ m má»›i"})]}),e.jsxs(m.button,{whileTap:{scale:.95},onClick:()=>Ut(I==="Retail"?"Wholesale":"Retail"),className:x("px-4 py-2.5 rounded-xl font-black text-xs uppercase tracking-wider flex items-center gap-2 transition-all cursor-pointer select-none shadow-sm hover:shadow-md border-2",I==="Wholesale"?"bg-gradient-to-r from-[#f4c430]/20 to-[#d4a574]/20 text-muted border-[#d4a574]/30 hover:from-[#f4c430]/30 hover:to-[#d4a574]/30":"bg-gradient-to-r from-primary/20 to-primary-hover/20 text-primary dark:text-[#4a7c59] border-[#4a7c59]/30 hover:from-primary/30 hover:to-primary-hover/30"),children:[e.jsx("div",{className:x("w-2 h-2 rounded-full",I==="Wholesale"?"bg-amber-500":"bg-emerald-500")}),I==="Wholesale"?"Sá»ˆ":"Láºº"]}),d&&e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>ut(!0),className:"p-2.5 bg-gradient-to-br from-emerald-500 to-teal-600 text-white rounded-xl shadow-lg hover:shadow-emerald-500/40 transition-all border-2 border-white/20 dark:border-slate-700/50 flex items-center justify-center",title:"Lá»‹ch sá»­ nháº­p hÃ ng",children:e.jsx(Ct,{size:20,strokeWidth:3})})]}),e.jsx("div",{className:"flex-1 flex justify-end items-center mr-2",children:e.jsxs("div",{className:"flex flex-col items-end opacity-80 hover:opacity-100 transition-opacity select-none",children:[e.jsx("div",{className:"text-2xl font-black text-primary dark:text-[#d4a574] tracking-tighter leading-none flex items-center gap-2 tabular-nums",children:dt.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"text-[10px] font-bold text-muted dark:text-gray-400 uppercase tracking-widest flex items-center gap-1.5",children:[e.jsx(Ve,{size:10,strokeWidth:2.5}),e.jsx("span",{children:dt.toLocaleDateString("vi-VN",{weekday:"short",day:"2-digit",month:"2-digit",year:"numeric"})})]})]})})]})]}),e.jsxs("div",{className:"flex-1 flex gap-3 p-4 pt-0 pb-4 print:hidden min-h-0 relative",children:[e.jsx(m.div,{initial:!1,animate:{width:ue?"78%":"calc(100% - 90px)"},transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col min-h-0 relative",children:e.jsxs("div",{className:x("flex-1 overflow-hidden relative shadow-2xl transition-all duration-500 rounded-[2.7rem]",$.ui_show_rainbow_border==="true"&&"premium-rainbow-border"),children:[e.jsxs("div",{className:"w-full h-full rounded-[2.5rem] overflow-hidden relative main-content-bg",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(139, 111, 71, 0.1) 10px, rgba(139, 111, 71, 0.1) 20px),
                                            radial-gradient(circle at 3px 3px, rgba(45, 80, 22, 0.08) 1px, transparent 0)`,backgroundSize:"40px 40px, 30px 30px",backgroundPosition:"0 0, 15px 15px"}}),e.jsx("div",{className:"absolute inset-0 overflow-auto",children:e.jsxs("div",{className:"min-w-[1000px] transition-colors relative group/decoration pb-40",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden rounded-[2.5rem] pointer-events-none",children:[e.jsx("div",{className:"absolute right-[-100px] bottom-[-100px] opacity-[0.02] dark:opacity-[0.04] group-hover/decoration:scale-110 transition-transform duration-[2000ms] text-[#4a7c59]",children:e.jsx(le,{size:600})}),e.jsx("div",{className:"absolute left-[-50px] top-[-50px] opacity-[0.015] dark:opacity-[0.03] group-hover/decoration:rotate-12 transition-transform duration-[3000ms] text-muted",children:e.jsx(Be,{size:400})})]}),e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsxs("thead",{className:"bg-gradient-to-r from-primary/10 via-primary/8 to-primary-hover/10 border-b-2 border-[#d4a574]/40 text-primary dark:text-[#d4a574] uppercase text-[11px] font-black tracking-wider transition-colors sticky top-0 z-[40] shadow-md backdrop-blur-sm",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,className:"p-2 w-16 text-center align-middle",children:"Stt"}),e.jsx("th",{className:"px-4 py-0 align-middle text-center min-w-[450px]",children:e.jsx("div",{className:"flex items-center justify-center gap-3 h-full min-h-[36px]",children:e.jsx("span",{className:"font-black uppercase tracking-wider",children:"TÃªn Sáº£n Pháº©m"})})}),e.jsx("th",{rowSpan:2,className:"p-2 w-32 text-center align-middle",children:"ÄVT"}),e.jsx("th",{className:"p-2 w-40 text-center whitespace-nowrap",children:"SL Quy Ä‘á»•i"}),e.jsx("th",{className:"p-2 w-24 text-center text-primary whitespace-nowrap",children:"Sá»‘ lÆ°á»£ng"}),e.jsx("th",{rowSpan:2,className:"p-2 w-40 text-center align-middle",children:"GiÃ¡ nháº­p"}),e.jsx("th",{rowSpan:2,className:"p-2 w-40 text-center align-middle",children:"ThÃ nh tiá»n"}),e.jsx("th",{rowSpan:2,className:"p-2 w-10 text-center align-middle"})]}),e.jsxs("tr",{className:"border-t border-[#d4a574]/20 text-[10px]",children:[e.jsxs("td",{className:"px-4 py-1 text-primary/60 dark:text-[#d4a574]/60 font-black uppercase tracking-[0.1em] text-center border-r border-[#d4a574]/10",children:["Tá»•ng Ä‘á»‘i soÃ¡t (",Rt," máº·t hÃ ng)"]}),e.jsx("td",{className:"px-4 py-1 text-center border-r border-[#d4a574]/10",children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-black text-primary dark:text-[#d4a574]",children:y(Ht)}),e.jsx("span",{className:"text-[8px] font-black text-primary/40 uppercase tracking-tighter",children:"Quy Ä‘á»•i"})]})}),e.jsx("td",{className:"px-4 py-1 text-center border-r border-[#d4a574]/10",children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-black text-primary dark:text-[#d4a574]",children:y($t)}),e.jsx("span",{className:"text-[8px] font-black text-primary/40 uppercase tracking-tighter",children:"SL Láº»"})]})})]})]}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800",children:[e.jsxs("tr",{className:"bg-gradient-to-r from-[#faf8f3]/60 via-white/40 to-[#faf8f3]/60 dark:bg-slate-900/40 print:hidden border-b-2 border-[#d4a574]/30 sticky top-[52px] z-[45] backdrop-blur-md cursor-pointer shadow-sm",onDoubleClick:()=>{i.product&&(_e(i.product),se(!0))},children:[e.jsx("td",{className:"p-4 text-center",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto",children:e.jsx(Ke,{size:18,className:"text-primary"})})}),e.jsx("td",{className:"p-2 relative",children:e.jsxs("div",{className:"relative group/search",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 text-gray-400",children:e.jsx(sa,{size:20})}),e.jsx("input",{type:"text",placeholder:"TÃªn sáº£n pháº©m (F2)...",className:"w-full p-2.5 pl-12 bg-white/80 dark:bg-slate-800 border-2 border-[#d4a574]/20 focus:border-primary dark:focus:border-[#4a7c59] focus:bg-white rounded-xl font-black text-gray-800 dark:text-gray-100 uppercase outline-none transition-all shadow-sm",autoComplete:"off",value:_,onChange:t=>{const a=t.target.value;E(a),ee(0),i.product&&a!==i.name&&H({...i,product:null,name:a})},onKeyDown:t=>{if(t.key==="ArrowUp")t.preventDefault(),ee(a=>{const r=Math.max(a-1,0),s=Re.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="ArrowDown")t.preventDefault(),ee(a=>{const r=Math.min(a+1,X.length-1),s=Re.current;if(s){const n=s.children[r];n&&n.scrollIntoView({block:"nearest"})}return r});else if(t.key==="Enter"){if(t.preventDefault(),_&&X[g]){const a=X[g],r=i.quantity>0?i.quantity:1;H({product:a,quantity:r,price:a.cost_price,secondary_qty:r/(a.multiplier||1),name:a.name}),E(a.name),ge(a,1,a.cost_price)}}else if(t.key==="Tab"){if(i.product){t.preventDefault();const a=I==="Wholesale"&&i.product.secondary_unit?Ce:ne;setTimeout(()=>{a.current?.focus(),a.current?.select()},10)}else if(_&&X[g]){t.preventDefault();const a=X[g],r=i.quantity>0?i.quantity:1;H({product:a,quantity:r,price:a.cost_price,secondary_qty:r/(a.multiplier||1),name:a.name}),E(a.name);const s=I==="Wholesale"&&a.secondary_unit?Ce:ne;setTimeout(()=>{s.current?.focus(),s.current?.select()},10)}}},ref:F}),i.product&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2 pointer-events-none",children:e.jsx("span",{className:x("px-2 py-0.5 rounded-lg text-[10px] font-black uppercase tracking-tight backdrop-blur-md border transition-all shadow-sm",i.product.stock<10?"bg-red-500/20 text-red-600 border-red-500/30":"bg-emerald-500/10 text-emerald-700 border-emerald-500/20 dark:bg-emerald-500/20 dark:text-emerald-400"),children:i.product.stock})}),e.jsx(Q,{children:_&&!i.product&&e.jsxs(m.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{type:"spring",stiffness:400,damping:30},className:"dropdown-premium min-w-[500px]",children:[e.jsx("div",{className:"max-h-[400px] overflow-y-auto no-scrollbar scroll-smooth",ref:Re,children:X.map((t,a)=>e.jsxs("div",{onClick:()=>{const r=i.quantity>0?i.quantity:1;H({product:t,quantity:r,price:t.cost_price,secondary_qty:r/(t.multiplier||1),name:t.name}),E(t.name);const s=I==="Wholesale"&&t.secondary_unit?Ce:ne;setTimeout(()=>{s.current?.focus(),s.current?.select()},10)},onDoubleClick:()=>{_e(t),se(!0)},className:x("dropdown-item flex justify-between items-center",a===g&&"active"),children:[e.jsxs("div",{children:[e.jsx("div",{className:x("font-black uppercase tracking-tight",a===g?"text-white":"text-gray-800 dark:text-gray-100"),children:t.name}),e.jsx("div",{className:x("text-[10px] font-bold italic mb-0.5",a===g?"text-white/80":"text-primary dark:text-emerald-400"),children:t.active_ingredient}),e.jsxs("div",{className:x("text-[10px] uppercase font-black flex items-center gap-2",a===g?"text-white/70":"text-gray-400"),children:[t.unit," ",t.multiplier>1&&`/ ${t.secondary_unit} (x${t.multiplier})`,e.jsx("span",{className:x("ml-2 px-2.5 py-1 rounded-lg text-sm font-black border shadow-sm",a===g?"bg-white/20 text-white border-white/30":"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-500/20 dark:text-emerald-400 dark:border-emerald-500/30"),children:t.stock})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:x("font-black text-lg tracking-tighter",a===g?"text-white":"text-emerald-400"),children:y(t.cost_price)})})]},t.id))}),_&&X.length===0&&e.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 hover:bg-primary hover:text-white cursor-pointer text-primary dark:text-emerald-400 font-black uppercase text-xs flex items-center gap-2",onClick:()=>{tt(_),je(!0)},children:[e.jsx(Ke,{size:16}),' ThÃªm sáº£n pháº©m má»›i: "',_,'"']})]})})]})}),e.jsxs("td",{className:"p-4 text-center",children:[e.jsx("div",{className:"font-bold text-gray-700 dark:text-gray-200 text-xs",children:i.product?.unit||"-"}),i.product?.secondary_unit&&e.jsxs("div",{className:"text-[10px] text-primary font-black uppercase tracking-tighter",children:["1 ",i.product.secondary_unit," = ",i.product.multiplier," ",i.product.unit]})]}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-1 h-9 px-2 bg-amber-50/50 dark:bg-amber-900/10 border-2 border-dashed border-[#d4a574]/40 rounded-xl focus-within:border-emerald-500 dark:focus-within:border-[#4a7c59] focus-within:ring-4 focus-within:ring-emerald-500/10 shadow-sm transition-all text-emerald-700 dark:text-emerald-400",children:[e.jsx("input",{type:"number",disabled:!i.product?.secondary_unit,className:"w-full min-w-0 bg-transparent text-center font-black text-base outline-none placeholder:text-gray-300 disabled:opacity-30",id:"working-sec-qty",ref:Ce,value:i.secondary_qty,autoComplete:"off",onFocus:t=>t.target.select(),onChange:t=>{const a=parseFloat(t.target.value)||0;H(r=>{const s=parseFloat(r.product?.multiplier)||1;return{...r,secondary_qty:a,quantity:a*s}})},onKeyDown:t=>{t.key==="Tab"?(t.preventDefault(),ne.current?.focus()):t.key==="Enter"&&(t.preventDefault(),i.product&&i.quantity!==0&&ge(i.product,i.quantity,i.price))}}),e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase pr-2 whitespace-nowrap",children:i.product?.secondary_unit})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full h-9 text-center bg-white dark:bg-slate-800 border-2 border-emerald-100 dark:border-emerald-800/50 rounded-xl focus:border-emerald-500 dark:focus:border-[#4a7c59] focus:ring-4 focus:ring-emerald-500/10 outline-none font-black text-lg text-emerald-700 dark:text-emerald-400 shadow-sm transition-all placeholder:text-gray-300",value:i.quantity,id:"working-main-qty",ref:ne,autoComplete:"off",onFocus:t=>t.target.select(),onChange:t=>{const a=parseFloat(t.target.value)||0;H(r=>{const s=parseFloat(r.product?.multiplier)||1;return{...r,quantity:a,secondary_qty:a/s}})},onKeyDown:t=>{t.key==="Tab"?(t.preventDefault(),Ae.current?.focus()):t.key==="Enter"&&(t.preventDefault(),i.product&&i.quantity!==0&&ge(i.product,i.quantity,i.price))}})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("input",{type:"text",className:"w-full p-2 text-right bg-transparent border-none focus:ring-2 focus:ring-emerald-200 rounded font-bold outline-none dark:text-gray-200",value:y(i.price),id:"working-price",ref:Ae,autoComplete:"off",onFocus:t=>t.target.select(),onChange:t=>{const a=parseFloat(t.target.value.replace(/,/g,""))||0;H({...i,price:a})},onKeyDown:t=>{t.key==="Enter"?(t.preventDefault(),i.product&&i.quantity!==0&&ge(i.product,i.quantity,i.price)):t.key==="Tab"&&!t.shiftKey&&(t.preventDefault(),F.current?.focus())}})}),e.jsx("td",{className:"p-4 text-right font-black text-gray-900 dark:text-white text-lg",children:y(i.price*i.quantity)}),e.jsx("td",{className:"p-2 text-center",children:i.product&&e.jsx("button",{onClick:()=>H({product:null,quantity:1,price:0,secondary_qty:0,name:""}),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-xl transition-all",title:"XÃ³a dÃ²ng",children:e.jsx(we,{size:20})})})]}),e.jsx(Q,{initial:!1,mode:"wait",children:St?e.jsx(m.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"w-full",children:e.jsx("td",{colSpan:10,className:"h-[400px] text-center relative align-middle",children:e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-xl rounded-full"}),e.jsx(na,{size:48,className:"animate-spin text-primary relative z-10"})]}),e.jsx("span",{className:"text-sm font-black text-muted dark:text-[#d4a574] uppercase tracking-widest",children:"Äang Ä‘á»“ng bá»™ dá»¯ liá»‡u..."})]})})},"loading-skeleton"):u.map((t,a)=>e.jsxs(m.tr,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}},transition:{duration:.2,delay:a*.01},className:x("transition-all group cursor-pointer",a%2===0?"bg-white/30 hover:bg-[#d4a574]/10":"bg-[#faf8f3]/20 hover:bg-[#d4a574]/15"),onDoubleClick:()=>{const r=N.find(s=>s.id===t.product_id);r&&(_e(r),se(!0))},children:[e.jsx("td",{className:"p-4 text-center text-gray-400 font-bold",children:a+1}),e.jsx("td",{className:"p-2 relative",children:e.jsxs("div",{className:"relative group/search-row",onDoubleClick:r=>{r.preventDefault();const s=N.find(n=>n.id===t.product_id);s&&(_e(s),se(!0))},children:[e.jsx("input",{className:"w-full p-2 bg-transparent border-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 rounded font-bold text-gray-800 dark:text-gray-100 uppercase outline-none",autoComplete:"off",value:ae===a?re:t.product_name,onFocus:r=>{V(a),lt(t.product_name),Ne(0),r.target.select()},onChange:r=>{lt(r.target.value),Ne(0)},onBlur:()=>{setTimeout(()=>{V(r=>r===a?null:r)},200)},onKeyDown:r=>{const s=N.filter(n=>{const o=re.toLowerCase();return(n.name||"").toLowerCase().includes(o)||(n.code||"").toLowerCase().includes(o)||(n.active_ingredient||"").toLowerCase().includes(o)}).sort((n,o)=>{const c=re.toLowerCase(),j=(n.name||"").toLowerCase(),k=(o.name||"").toLowerCase(),S=j.startsWith(c),P=k.startsWith(c);return S&&!P?-1:!S&&P?1:n.code?.toLowerCase()===c&&o.code?.toLowerCase()!==c?-1:n.code?.toLowerCase()!==c&&o.code?.toLowerCase()===c?1:j.localeCompare(k,"vi",{sensitivity:"base"})}).slice(0,10);if(r.key==="ArrowDown")if(ae===a&&s.length>0)r.preventDefault(),Ne(n=>{const o=Math.min(n+1,s.length-1);if(xe.current){const c=xe.current.children[o];c&&c.scrollIntoView({block:"nearest"})}return o});else{r.preventDefault();const n=a+1;n<u.length&&document.getElementById(`row-name-${n}`)?.focus()}else if(r.key==="ArrowUp")if(ae===a&&s.length>0)r.preventDefault(),Ne(n=>{const o=Math.max(n-1,0);if(xe.current){const c=xe.current.children[o];c&&c.scrollIntoView({block:"nearest"})}return o});else{r.preventDefault();const n=a-1;n>=0?document.getElementById(`row-name-${n}`)?.focus():F.current?.focus()}else if(r.key==="Enter"){if(r.preventDefault(),s[pe]){const n=s[pe];let o=[...u];const c=o[a].quantity,j=o.findIndex((k,S)=>S!==a&&k.product_id===n.id);j>-1?(o[j].quantity+=c,o[j].secondary_qty=o[j].quantity/(o[j].multiplier||1),o.splice(a,1)):o[a]={...o[a],product_id:n.id,product_name:n.name,unit:n.unit,secondary_unit:n.secondary_unit,multiplier:n.multiplier||1,price:n.cost_price,stock:n.stock,secondary_qty:c/(n.multiplier||1),active_ingredient:n.active_ingredient},C(o),V(null)}F.current?.focus()}else if(r.key==="Tab"){r.preventDefault();const n=s.length>0?s:[];if(n[pe]){const o=n[pe];let c=[...u];const j=c[a].quantity,k=c.findIndex((S,P)=>P!==a&&S.product_id===o.id);k>-1?(c[k].quantity+=j,c[k].secondary_qty=c[k].quantity/(c[k].multiplier||1),c.splice(a,1),C(c),V(null),setTimeout(()=>{const S=k>a?k-1:k,P=document.getElementById(`qty-sec-${S}`);if(I==="Wholesale"&&P&&!P.disabled)P.focus(),P.select?.();else{const mt=document.getElementById(`qty-main-${S}`);mt?.focus(),mt?.select?.()}},200)):(c[a]={...c[a],product_id:o.id,product_name:o.name,unit:o.unit,secondary_unit:o.secondary_unit,multiplier:o.multiplier||1,price:o.cost_price,stock:o.stock,secondary_qty:j/(o.multiplier||1),active_ingredient:o.active_ingredient},C(c),V(null),setTimeout(()=>{const S=document.getElementById(`qty-sec-${a}`);if(I==="Wholesale"&&S&&!S.disabled)S.focus(),S.select?.();else{const P=document.getElementById(`qty-main-${a}`);P?.focus(),P?.select?.()}},200))}else V(null),setTimeout(()=>{const o=document.getElementById(`qty-sec-${a}`);if(I==="Wholesale"&&o&&!o.disabled)o.focus(),o.select?.();else{const c=document.getElementById(`qty-main-${a}`);c?.focus(),c?.select?.()}},200)}},id:`row-name-${a}`}),ae===a&&re&&e.jsx("div",{className:"dropdown-premium min-w-[400px] mt-2",children:e.jsx("div",{ref:xe,className:"max-h-64 overflow-y-auto no-scrollbar",children:N.filter(r=>{const s=re.toLowerCase();return(r.name||"").toLowerCase().includes(s)||(r.code||"").toLowerCase().includes(s)||(r.active_ingredient||"").toLowerCase().includes(s)}).sort((r,s)=>{const n=re.toLowerCase(),o=(r.name||"").toLowerCase(),c=(s.name||"").toLowerCase(),j=o.startsWith(n),k=c.startsWith(n);return j&&!k?-1:!j&&k?1:r.code?.toLowerCase()===n&&s.code?.toLowerCase()!==n?-1:r.code?.toLowerCase()!==n&&s.code?.toLowerCase()===n?1:o.localeCompare(c,"vi",{sensitivity:"base"})}).slice(0,10).map((r,s)=>e.jsxs("div",{onClick:()=>{let n=[...u];const o=n[a].quantity,c=n.findIndex((j,k)=>k!==a&&j.product_id===r.id);c>-1?(n[c].quantity+=o,n[c].secondary_qty=n[c].quantity/(n[c].multiplier||1),n.splice(a,1)):n[a]={...n[a],product_id:r.id,product_name:r.name,unit:r.unit,secondary_unit:r.secondary_unit,multiplier:r.multiplier||1,price:r.cost_price,stock:r.stock,secondary_qty:o/(r.multiplier||1),active_ingredient:r.active_ingredient},C(n),V(null)},className:x("dropdown-item flex justify-between items-center",s===pe&&"active"),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-black text-gray-800 dark:text-gray-100 uppercase tracking-tight",children:r.name}),e.jsxs("div",{className:"text-[11px] text-gray-500 uppercase font-black flex items-center gap-2",children:[e.jsx("span",{children:r.unit}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),e.jsx("span",{className:"text-emerald-500 bg-emerald-500/10 px-1.5 py-0.5 rounded-md backdrop-blur-sm border border-emerald-500/20",children:r.stock})]})]}),e.jsx("div",{className:"text-right font-black text-primary",children:y(r.cost_price)})]},r.id))})}),t.active_ingredient&&e.jsxs("div",{className:"absolute left-0 bottom-full mb-2 hidden group-hover/search-row:block z-[2000] w-64 bg-slate-800 text-white p-3 rounded-xl shadow-2xl animate-in fade-in slide-in-from-bottom-2 duration-200 border border-slate-700 uppercase-none",children:[e.jsx("div",{className:"text-[10px] font-black uppercase text-emerald-400 mb-1 tracking-widest border-b border-white/10 pb-1",children:"Hoáº¡t cháº¥t / ThÃ nh pháº§n"}),e.jsx("div",{className:"text-xs font-bold leading-relaxed",children:t.active_ingredient})]})]})}),e.jsxs("td",{className:"p-4 text-center",children:[e.jsx("div",{className:"font-bold text-gray-700 dark:text-gray-200",children:t.unit}),t.secondary_unit&&e.jsxs("div",{className:"text-[10px] text-primary font-black uppercase tracking-tighter",children:["1 ",t.secondary_unit," = ",t.multiplier," ",t.unit]})]}),e.jsx("td",{className:"p-2",children:t.secondary_unit?e.jsxs("div",{className:"flex items-center gap-1 h-9 px-2 bg-amber-50/50 dark:bg-amber-900/10 border-2 border-dashed border-[#d4a574]/40 rounded-xl focus-within:border-emerald-500 dark:focus-within:border-[#4a7c59] focus-within:ring-4 focus-within:ring-emerald-500/10 shadow-sm transition-all text-emerald-700 dark:text-emerald-400",children:[e.jsx("input",{type:"number",className:"w-full min-w-0 bg-transparent text-center font-black text-base outline-none placeholder:text-gray-300",value:t.secondary_qty,onFocus:r=>r.target.select(),autoComplete:"off",onChange:r=>Ie(a,"secondary_qty",parseFloat(r.target.value)||0),onKeyDown:r=>{if(r.key==="ArrowDown"){r.preventDefault();const s=a+1;s<u.length&&document.getElementById(`qty-sec-${s}`)?.focus()}else if(r.key==="ArrowUp"){r.preventDefault();const s=a-1;s>=0&&document.getElementById(`qty-sec-${s}`)?.focus()}},id:`qty-sec-${a}`}),e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase pr-2 whitespace-nowrap",children:t.secondary_unit})]}):e.jsx("div",{className:"text-center text-gray-300 italic text-[10px] font-bold",children:"N/A"})}),e.jsxs("td",{className:"p-2 relative group/qty",children:[e.jsx("input",{type:"number",className:"w-full h-9 text-center bg-white dark:bg-slate-800 border-2 border-emerald-100 dark:border-emerald-800/50 rounded-xl focus:border-emerald-500 dark:focus:border-[#4a7c59] focus:ring-4 focus:ring-emerald-500/10 outline-none font-black text-lg text-emerald-700 dark:text-emerald-400 shadow-sm transition-all placeholder:text-gray-300",value:t.quantity,onFocus:r=>r.target.select(),autoComplete:"off",onChange:r=>Ie(a,"quantity",parseFloat(r.target.value)||0),onKeyDown:r=>{if(r.key==="Enter")r.preventDefault(),F.current?.focus();else if(r.key==="Tab")r.preventDefault(),document.getElementById(`price-${a}`)?.focus();else if(r.key==="ArrowDown"){r.preventDefault();const s=a+1;s<u.length&&document.getElementById(`qty-main-${s}`)?.focus()}else if(r.key==="ArrowUp"){r.preventDefault();const s=a-1;s>=0?document.getElementById(`qty-main-${s}`)?.focus():ne.current?.focus()}},id:`qty-main-${a}`}),e.jsx("button",{tabIndex:-1,className:"absolute -top-2 -right-2 w-5 h-5 flex items-center justify-center bg-[#8b6f47] text-white rounded-full shadow-md hover:bg-[#8b6f47]/90 active:scale-95 z-[70] transition-all hover:scale-110 border border-white dark:border-slate-800 opacity-0 group-hover/qty:opacity-100 duration-200",onClick:()=>Ie(a,"quantity",t.quantity*-1),title:"Äá»•i thÃ nh Tráº£ HÃ ng (Ã‚m)",children:e.jsx(Qe,{size:12})})]}),e.jsx("td",{className:"p-2 text-right text-gray-700 dark:text-gray-200 font-bold",children:e.jsx("input",{type:"text",className:"w-full p-2 text-right bg-transparent border-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 rounded font-bold outline-none",value:y(t.price),onFocus:r=>r.target.select(),autoComplete:"off",onChange:r=>{const s=parseFloat(r.target.value.replace(/,/g,""))||0;Ie(a,"price",s)},onKeyDown:r=>{if(r.key==="Enter"||r.key==="Tab")r.preventDefault(),F.current?.focus();else if(r.key==="ArrowDown"){r.preventDefault();const s=a+1;s<u.length&&document.getElementById(`price-${s}`)?.focus()}else if(r.key==="ArrowUp"){r.preventDefault();const s=a-1;s>=0?document.getElementById(`price-${s}`)?.focus():Ae.current?.focus()}},id:`price-${a}`})}),e.jsx("td",{className:"p-4 text-right font-black text-gray-900 dark:text-white text-lg",children:y(t.price*t.quantity)}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("button",{onClick:r=>{r.stopPropagation();const s=[...u];s.splice(a,1),C(s)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-all opacity-0 group-hover:opacity-100",title:"XÃ³a dÃ²ng",children:e.jsx(jt,{size:18})})})]},`edit-row-${a}`))})]})]})]})})]}),e.jsx(Q,{children:!ue&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{layout:!0,initial:{scale:.8,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:20},className:"absolute bottom-10 left-10 z-[110] pointer-events-none",children:e.jsxs("div",{onClick:()=>me.current?.focus(),className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-3xl px-6 py-4 rounded-[2rem] shadow-[0_20px_50px_rgba(0,0,0,0.1)] border border-white/40 flex items-center gap-4 group/partner-bubble cursor-pointer hover:scale-105 active:scale-95 transition-all duration-300 pointer-events-auto hover:bg-white dark:hover:bg-slate-800",children:[e.jsx("div",{className:"w-12 h-12 bg-[#8b6f47] dark:bg-[#d4a574] rounded-2xl flex items-center justify-center text-white shadow-lg shadow-[#8b6f47]/20 group-hover/partner-bubble:rotate-12 transition-transform",children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"flex flex-col min-w-0 max-w-[280px]",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-muted dark:text-[#d4a574]/60 mb-0.5",children:"NhÃ  cung cáº¥p"}),e.jsx("div",{className:"text-xl font-black text-primary dark:text-white uppercase leading-tight tracking-tight truncate py-0.5",children:d?d.name:"NhÃ  cung cáº¥p láº»"}),d?.address&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 text-[10px] font-bold text-muted/70 dark:text-[#d4a574]/80 truncate",children:[e.jsx(Nt,{size:10,strokeWidth:2.5,className:"shrink-0"}),e.jsx("span",{className:"truncate",children:d.address})]})]})]})},"partner-bubble"),e.jsx(m.div,{layout:!0,initial:{scale:.8,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:20},className:"absolute bottom-10 right-10 z-[110] pointer-events-none",children:e.jsxs("div",{className:"bg-[#8b6f47]/90 dark:bg-[#d4a574]/90 backdrop-blur-3xl text-white px-8 py-4 rounded-[2rem] shadow-[0_20px_50px_rgba(139,111,71,0.5)] border border-white/20 flex flex-col items-end group/total cursor-pointer hover:scale-105 active:scale-95 transition-all duration-300 pointer-events-auto hover:bg-[#8b6f47] dark:hover:bg-[#d4a574]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white/50 animate-pulse"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-80",children:"Tá»•ng cá»™ng nháº­p kho"})]}),e.jsxs("div",{className:"text-4xl font-black tracking-tighter tabular-nums drop-shadow-lg flex items-baseline gap-1",children:[y(A),e.jsx("span",{className:"text-sm opacity-60 font-bold",children:"Ä‘"})]})]})},"total-bubble")]})})]})}),e.jsx(m.div,{initial:!1,animate:{width:ue?"22%":"90px"},transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col bg-transparent pr-1 min-h-0 relative",children:e.jsx("div",{className:"p-1 transition-colors relative flex-1 flex flex-col min-h-0",children:e.jsxs(Q,{mode:"wait",children:[!ue&&e.jsxs(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col items-center py-4 gap-8 h-full relative z-10",children:[e.jsx("div",{className:x("w-14 h-14 rounded-2xl flex items-center justify-center border-2 transition-all shadow-lg",d?"bg-[#8b6f47] text-white border-white/20":"bg-white/50 dark:bg-slate-800/50 text-muted border-white/50"),children:e.jsx(le,{size:24})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(m.button,{whileHover:{scale:1.15},whileTap:{scale:.9},onClick:()=>it(!0),className:"w-16 h-16 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-[#8b6f47] dark:text-[#d4a574] border-2 border-[#d4a574]/30 shadow-xl hover:shadow-2xl transition-all group/toggle",children:e.jsx(vt,{size:32,strokeWidth:3,className:"group-hover/toggle:-translate-x-1 transition-transform"})})}),e.jsxs("div",{className:"flex flex-col gap-3 pb-4",children:[e.jsx(m.button,{whileHover:{scale:1.1,y:-2},whileTap:{scale:.9},onClick:Fe,disabled:u.length===0,className:"w-14 h-14 bg-white/80 dark:bg-slate-800/80 rounded-2xl flex items-center justify-center text-[#8b6f47] border-2 border-[#d4a574]/30 shadow-md hover:shadow-lg transition-all",title:"Táº¡m Ä‘Æ¡n",children:e.jsx(ye,{size:24})}),e.jsx(m.button,{whileHover:{scale:1.1,y:-2},whileTap:{scale:.9},onClick:()=>ie(!1),disabled:u.length===0||U,className:"w-14 h-14 bg-white/80 dark:bg-slate-800/80 rounded-2xl flex items-center justify-center text-primary border-2 border-primary/30 shadow-md hover:shadow-lg transition-all",title:"Chá»‰ lÆ°u",children:U?e.jsx("div",{className:"w-5 h-5 border-3 border-primary/30 border-t-primary rounded-full animate-spin"}):e.jsx(_t,{size:24})}),e.jsx(m.button,{whileHover:{scale:1.1,y:-2},whileTap:{scale:.9},onClick:()=>ie(!0),disabled:u.length===0||U,className:"w-14 h-14 bg-primary text-white rounded-2xl flex items-center justify-center shadow-lg shadow-primary/30 hover:shadow-primary/50 animate-pulse-smooth border border-white/20 transition-all",title:"LÆ°u vÃ  In",children:U?e.jsx("div",{className:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Ue,{size:28})})]})]},"mini-sidebar"),ue&&e.jsxs(m.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2},className:"h-full flex flex-col relative",children:[e.jsx(m.button,{whileHover:{scale:1.15,x:1},whileTap:{scale:.95},onClick:()=>it(!1),className:"absolute -left-4 top-1/2 -translate-y-1/2 w-9 h-9 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-[#8b6f47] dark:text-[#d4a574] border-2 border-[#d4a574]/30 z-[130] shadow-lg transition-all",children:e.jsx(Ge,{size:18,strokeWidth:4})}),e.jsxs("div",{className:"flex flex-col gap-3 relative z-10 flex-1 overflow-y-auto -mr-2 pr-2 pb-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{onClick:()=>me.current?.focus(),className:"flex items-center gap-4 bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl p-4 rounded-[1.5rem] border border-white/50 dark:border-white/10 shadow-sm transition-all hover:shadow-md group/partner cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary/10 to-primary-hover/20 rounded-2xl shadow-inner flex items-center justify-center text-primary dark:text-[#d4a574] border border-white dark:border-slate-800 shrink-0",children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[10px] font-black text-muted dark:text-[#d4a574]/60 uppercase tracking-[0.2em]",children:"NhÃ  cung cáº¥p"}),e.jsx("div",{className:"font-black text-primary dark:text-white text-lg uppercase leading-tight truncate",children:d?d.name:"NhÃ  cung cáº¥p láº»"}),d?.address&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-muted/80 dark:text-[#d4a574]/80 truncate mt-1",children:[e.jsx(Nt,{size:8,strokeWidth:2.5}),e.jsx("span",{className:"truncate",children:d.address})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-3 text-primary/40 dark:text-[#d4a574]/40 z-10",children:e.jsx(ia,{size:16})}),e.jsx("textarea",{placeholder:"Ghi chÃº Ä‘Æ¡n nháº­p...",className:"w-full pl-9 p-3 bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/40 dark:border-white/10 rounded-[1.5rem] focus:bg-white/70 dark:focus:bg-slate-800/70 focus:border-primary/50 dark:focus:border-[#4a7c59] outline-none transition-all resize-none h-16 text-xs italic dark:text-gray-300 shadow-sm",value:M,onChange:t=>G(t.target.value)})]})]}),e.jsxs("div",{className:"flex-1 space-y-3 pt-1",children:[e.jsxs("div",{className:x("p-4 rounded-[1.5rem] border border-white/40 dark:border-white/10 shadow-sm transition-all duration-500 bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl hover:shadow-md",A>0?"border-primary/30 shadow-primary/10":""),children:[e.jsx("div",{className:"text-[10px] font-black text-muted dark:text-[#d4a574]/80 uppercase tracking-widest mb-1 text-center",children:"Tá»•ng tiá»n nháº­p kho"}),e.jsx("div",{className:"font-black text-3xl text-primary dark:text-[#f4c430] text-center whitespace-nowrap overflow-hidden",children:y(A)})]}),e.jsxs("div",{className:"space-y-3 px-1",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl p-3 rounded-[1.2rem] border border-white/40 dark:border-white/10 shadow-sm hover:shadow-md transition-all",children:[e.jsx("span",{className:"text-[10px] font-black text-muted/60 dark:text-[#d4a574]/40 uppercase tracking-widest",children:"Ná»£ cÅ© NCC:"}),e.jsx("span",{className:"font-black text-sm text-red-500 dark:text-red-400/80",children:y(Se)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl p-1.5 rounded-[1.2rem] gap-1 border border-white/40 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:()=>b("Cash"),className:x("flex-1 py-1.5 rounded-lg text-[9px] font-black transition-all",h==="Cash"?"bg-primary text-white shadow-md":"text-primary/60 hover:text-primary dark:text-[#d4a574]/60"),children:"TIá»€N Máº¶T"}),e.jsx("button",{onClick:()=>{b("Debt"),w(0)},className:x("flex-1 py-1.5 rounded-lg text-[9px] font-black transition-all",h==="Debt"?"bg-[#8b6f47] text-white shadow-md":"text-muted/60 hover:text-muted dark:text-[#d4a574]/60"),children:"CÃ”NG Ná»¢"}),e.jsx("button",{onClick:()=>{b("Pending"),w(0)},className:x("flex-1 py-1.5 rounded-lg text-[9px] font-black transition-all",h==="Pending"?"bg-[#f4c430] text-white shadow-md":"text-[#f4c430]/60 hover:text-[#f4c430] dark:text-[#d4a574]/60"),children:"CHá»œ T/T"}),e.jsx("button",{onClick:()=>{b("Transfer")},className:x("flex-1 py-1.5 rounded-lg text-[9px] font-black transition-all",h==="Transfer"?"bg-blue-600 text-white shadow-md":"text-blue-600/60 hover:text-blue-600 dark:text-[#d4a574]/60"),children:"CHUYá»‚N KHOáº¢N"})]}),h==="Transfer"&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[9px] font-black text-blue-400 uppercase z-10",children:"TK Chuyá»ƒn:"}),e.jsx("select",{className:"w-full p-2.5 pl-24 bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-blue-200 dark:border-blue-900/30 rounded-[1.2rem] font-bold text-xs outline-none focus:ring-2 focus:ring-blue-500/20 transition-all dark:text-white",value:st,onChange:t=>nt(t.target.value),children:Dt.map(t=>e.jsxs("option",{value:t.id,children:[t.bank_name," - ",t.account_number]},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-black text-muted/40 uppercase z-10",children:"Thanh toÃ¡n:"}),e.jsx("input",{type:"text",readOnly:h==="Cash"||h==="Pending",className:x("w-full p-2.5 pl-24 text-right rounded-[1.2rem] font-black text-xl outline-none border border-white/40 dark:border-white/10 shadow-sm bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl transition-all",h==="Cash"||h==="Pending"?"text-primary/40 cursor-not-allowed":"text-primary dark:text-[#d4a574] focus:ring-2 focus:ring-primary/20 bg-white/70"),value:y(p),autoComplete:"off",onChange:t=>w(parseFloat(t.target.value.replace(/,/g,""))||0)})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary to-primary-hover text-white p-5 rounded-[1.5rem] flex items-center justify-between shadow-lg hover:shadow-xl transition-all hover:scale-[1.02] active:scale-95 border border-white/10 relative z-20",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-[10px] font-black uppercase opacity-70 tracking-[0.1em] block mb-1",children:"Ná»£ NCC sau Ä‘Æ¡n:"}),e.jsx("span",{className:"text-3xl font-black tracking-tighter block leading-none",children:y(Ft)})]}),e.jsx(la,{className:"text-white/20 shrink-0 ml-2 animate-pulse",size:32})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m.button,{whileTap:{scale:.95},disabled:u.length===0,onClick:Fe,className:"flex-1 bg-white/80 dark:bg-slate-800/80 text-[#8b6f47] dark:text-[#d4a574] rounded-2xl font-black hover:bg-[#d4a574]/10 transition-all border-2 border-[#d4a574]/20 flex items-center justify-center gap-3 p-3",children:[e.jsx(ye,{size:20,className:"shrink-0"}),e.jsx("span",{className:"text-lg uppercase tracking-widest font-black",children:"Táº M"})]}),e.jsxs(m.button,{whileTap:{scale:.95},disabled:u.length===0||U,onClick:()=>ie(!1),className:"flex-1 bg-white/80 dark:bg-slate-800/80 text-primary dark:text-[#d4a574] rounded-2xl font-black hover:bg-primary/5 transition-all border-2 border-primary/20 flex items-center justify-center gap-3 p-3",children:[e.jsx(_t,{size:20,className:"shrink-0"}),e.jsx("span",{className:"text-lg uppercase tracking-widest font-black",children:"LÆ¯U"})]})]}),e.jsx(m.button,{whileTap:{scale:.98},disabled:u.length===0||U,onClick:()=>ie(!0),className:"w-full bg-gradient-to-r from-primary to-primary-hover text-white rounded-2xl flex items-center justify-center border border-white/20 transition-all p-4 h-16 relative z-20",children:U?e.jsx("div",{className:"w-6 h-6 border-4 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{size:28,className:"shrink-0"}),e.jsx("span",{className:"text-3xl tracking-widest uppercase font-black",children:"IN"})]})})]})]})]},"expanded-sidebar")]})})})]}),e.jsx(Q,{children:Oe&&e.jsx(ht,{children:e.jsxs("div",{className:"fixed inset-0 z-[2000] flex justify-end font-sans",children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]",onClick:()=>J(!1)}),e.jsxs(m.div,{initial:{x:"100%",opacity:.5},animate:{x:0,opacity:1},exit:{x:"100%",opacity:.5},transition:{type:"spring",damping:30,stiffness:300,mass:.8},className:"relative w-[340px] md:w-[400px] bg-white dark:bg-slate-900 shadow-2xl h-full flex flex-col p-8 border-l border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-gray-800 dark:text-gray-100 uppercase tracking-tighter flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-xl",children:e.jsx(ye,{className:"text-amber-600 dark:text-amber-400",size:24})}),"ÄÆ¡n nháº­p táº¡m"]}),e.jsxs("p",{className:"text-[10px] font-black text-amber-600/60 uppercase tracking-[0.2em] mt-1 ml-1",children:["Äang chá» (",W.length,")"]})]}),e.jsx("button",{onClick:()=>J(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-full transition-all hover:rotate-90",children:e.jsx(we,{size:24,className:"text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-auto space-y-4 pr-2 no-scrollbar",children:W.length===0?e.jsxs("div",{className:"text-center py-32 text-gray-300 dark:text-slate-700",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx(ye,{size:64,className:"opacity-20 mx-auto"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white dark:from-slate-900 to-transparent"})]}),e.jsx("p",{className:"font-black uppercase text-xs tracking-widest",children:"Trá»‘ng tráº£i..."})]}):e.jsx(Q,{mode:"popLayout",children:W.map((t,a)=>e.jsxs(m.div,{layout:!0,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.9,x:20},transition:{delay:a*.05,type:"spring",stiffness:400,damping:30},className:"bg-white dark:bg-slate-800/40 border-2 border-amber-50 dark:border-amber-900/10 rounded-[2rem] p-5 hover:border-amber-200 dark:hover:border-amber-600/30 transition-all group shadow-sm hover:shadow-xl hover:-translate-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-black text-gray-800 dark:text-gray-100 uppercase text-sm leading-tight group-hover:text-amber-600 transition-colors",children:t.partner?t.partner.name:"NCC VÃƒNG LAI"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"text-[10px] font-black text-gray-400 bg-gray-50 dark:bg-slate-900 px-2 py-0.5 rounded-full uppercase tabular-nums",children:["ðŸ•’ ",t.time]}),e.jsxs("div",{className:"text-[10px] font-black text-amber-600/70 bg-amber-50 dark:bg-amber-900/20 px-2 py-0.5 rounded-full uppercase",children:[t.cart.length," mÃ³n"]})]})]}),e.jsx("button",{onClick:()=>Gt(t.id),className:"text-gray-300 hover:text-rose-500 transition-colors p-1.5 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg",children:e.jsx(jt,{size:18})})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-slate-900/50 p-3 rounded-2xl border border-dashed border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-black text-gray-400 uppercase leading-none mb-1",children:"Tá»•ng cá»™ng"}),e.jsx("div",{className:"text-amber-600 dark:text-amber-400 font-black text-xl tracking-tighter",children:y(t.total)})]}),e.jsxs(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>Vt(t),className:"bg-gradient-to-r from-amber-500 to-amber-600 text-white px-5 py-2 rounded-xl font-black text-[11px] uppercase flex items-center gap-2 shadow-lg shadow-amber-500/30 hover:shadow-amber-500/50 transition-all",children:[e.jsx(Qe,{size:14,strokeWidth:3}),"THU Há»’I"]})]})]},t.id))})}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-100 dark:border-slate-800",children:e.jsx("button",{onClick:()=>J(!1),className:"w-full py-4 rounded-2xl border-2 border-gray-200 dark:border-slate-800 text-gray-500 font-black uppercase text-xs hover:bg-gray-50 dark:hover:bg-slate-800 transition-all tracking-widest",children:"ÄÃ³ng sidebar"})})]})]})})}),e.jsx(bt,{isOpen:ze,partner:{name:et,is_customer:!1,is_supplier:!0},onClose:()=>ve(!1),onSave:()=>{fe(),ve(!1)}}),e.jsx(gt,{isOpen:Le,product:{name:et},onClose:()=>je(!1),onSave:()=>{he(),je(!1)}}),e.jsx(gt,{isOpen:We,onClose:()=>se(!1),product:Lt,onSave:he}),e.jsx(bt,{isOpen:Et,partner:Ot,onClose:()=>$e(!1),onSave:async()=>{if(await fe(),d){const a=(await z.get("/api/partners")).data.find(r=>r.id===d.id);a&&v(a)}}}),e.jsx(Q,{children:It&&rt&&e.jsx(ht,{children:e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs(m.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"text-xl font-black text-slate-800 dark:text-white flex items-center gap-3 uppercase tracking-tighter",children:[e.jsx(kt,{size:24,className:"text-primary"}),"XEM TRÆ¯á»šC Báº¢N IN"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center gap-2 bg-primary text-white px-6 py-2.5 rounded-2xl font-black uppercase text-xs hover:shadow-lg hover:shadow-primary/30 transition-all active:scale-95",children:[e.jsx(Ue,{size:18})," In ngay"]}),e.jsx("button",{onClick:()=>at(!1),className:"p-2.5 bg-slate-100 dark:bg-slate-800 text-slate-400 hover:text-red-500 rounded-xl transition-all",children:e.jsx(we,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 bg-slate-100 dark:bg-slate-950 flex justify-center custom-scrollbar",children:e.jsx("div",{className:"bg-white shadow-2xl h-fit",children:e.jsx(yt,{data:rt,settings:$,type:"Purchase",isPreview:!0})})})]})})})}),e.jsx(oa,{partner:d,isOpen:Mt,onClose:()=>ut(!1),onAddToCart:t=>ge(t,1,t.cost_price||0)}),e.jsx(Zt,{isVisible:U&&N.length===0,message:"Äang náº¡p dá»¯ liá»‡u Nháº­p hÃ ng..."}),f&&e.jsx("div",{className:"only-print",children:e.jsx(yt,{data:f,settings:$,type:"Purchase"})})]})})}export{wa as default};
