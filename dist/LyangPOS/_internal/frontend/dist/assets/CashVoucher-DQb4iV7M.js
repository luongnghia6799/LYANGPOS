import{r as s,j as e}from"./vendor-C23Namvk.js";import{a as p}from"./vendor-utils-C44aPrMG.js";import{c as n,a as ee,d as y,b as M,P as me}from"./index-DXxzNUOO.js";import{D as pe}from"./settings-DRiS_Ul1.js";import{T as he}from"./Toast-rpGoMLC9.js";import{C as ue}from"./ConfirmModal-BTMhiinM.js";import{q as te,a8 as Q,a9 as U,b as I,X as V,W as be,D as ge,O as fe,K as ye,d as A,a5 as E,aa as je,ab as Ne,a as S,_ as ae}from"./vendor-icons-C8Df64wb.js";import{A as D,m as h}from"./vendor-framer-DVZK1f_z.js";function He(){const[G,se]=s.useState([]),[f,H]=s.useState([]),[ve,re]=s.useState(null),[k,u]=s.useState(!1),[l,b]=s.useState({partner_id:"",amount:0,note:"",type:"Receipt"}),[P,O]=s.useState(""),[ne,w]=s.useState(!1),[ke,X]=s.useState(pe),[q,x]=s.useState(null),[j,L]=s.useState(null),[c,N]=s.useState({year:new Date().getFullYear(),month:new Date().getMonth()+1,day:new Date().getDate(),quarter:""}),[i,R]=s.useState("fund"),[K,$]=s.useState([]),[le,z]=s.useState(!1),[o,Y]=s.useState(null),[v,B]=s.useState(0),[C,W]=s.useState("");s.useEffect(()=>{T(),ie()},[]),s.useEffect(()=>{i==="fund"?_("manual"):i==="settlement_history"?_("settlement"):J()},[c,i]),s.useEffect(()=>{const t=a=>{a.key==="Escape"&&w(!1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const ie=async()=>{try{const a=(await p.get("/api/print-templates?module=CashVoucher")).data;if(a&&a.length>0){const r=a.find(m=>m.is_default)||a[0];if(r)try{const m=JSON.parse(r.config);X(F=>({...F,...m}))}catch(m){console.error("Error parsing template config",m)}}else{const r=await p.get("/api/settings");Object.keys(r.data).length>0&&X(m=>({...m,...r.data}))}}catch(t){console.error(t)}},T=async()=>{try{const t=await p.get("/api/partners");se(t.data)}catch(t){console.error("Fetch partners error:",t)}},_=async(t="manual")=>{u(!0);try{const a={year:c.year||void 0,month:c.month||void 0,day:c.day||void 0,quarter:c.quarter||void 0,source:t},r=await p.get("/api/vouchers",{params:a});if(r.data&&Array.isArray(r.data)){const m=r.data.sort((F,xe)=>new Date(xe.date)-new Date(F.date));H(m)}else H([])}catch(a){console.error("Fetch vouchers error:",a),H([]),x({message:"Lỗi khi tải dữ liệu quỹ",type:"error"})}finally{u(!1)}},J=async()=>{u(!0);try{const t=await p.get("/api/orders",{params:{payment_method:"Pending"}}),a=t.data.items||t.data;$(Array.isArray(a)?a:[])}catch(t){console.error("Fetch pending orders error:",t),$([])}finally{u(!1)}},oe=async()=>{if(o){u(!0);try{const a={...o,payment_method:"Debt",amount_paid:v,note:o.note+(C?` | QT: ${C}`:"")};if(await p.put(`/api/orders/${o.id}`,a),v>0){const r={partner_id:o.partner_id,amount:v,type:o.type==="Sale"?"Receipt":"Payment",note:`Thanh toán cho đơn ${o.display_id}${C?": "+C:""}`,source:"settlement",order_id:o.id};await p.post("/api/vouchers",r)}z(!1),Y(null),J(),T(),x({message:"Quyết toán đơn hàng thành công!",type:"success"})}catch(t){console.error("Settle order error:",t),x({message:"Lỗi khi quyết toán đơn hàng",type:"error"})}finally{u(!1)}}},ce=async()=>{if(!l.amount||l.amount<=0){x({message:"Vui lòng nhập số tiền hợp lệ",type:"error"});return}u(!0);try{await p.post("/api/vouchers",l),_(),T(),de(),x({message:"Đã lưu phiếu thành công!",type:"success"})}catch{x({message:"Lỗi khi tạo phiếu",type:"error"})}finally{u(!1)}},de=()=>{b({...l,partner_id:"",amount:0,note:""}),O(""),re(null)},Z=(t,a)=>{a!=="auto"&&L({title:"Xác nhận xóa phiếu",message:"Xóa phiếu này sẽ hoàn tác thay đổi công nợ của đối tác. Bạn có chắc chắn muốn thực hiện?",onConfirm:async()=>{try{await p.delete(`/api/vouchers/${t}`),_(i==="fund"?"manual":"settlement"),T(),x({message:"Đã xóa phiếu thành công",type:"success"})}catch(r){x({message:"Lỗi khi xóa phiếu: "+(r.response?.data?.error||r.message),type:"error"})}L(null)},type:"danger"})},g=G.find(t=>t.id===parseInt(l.partner_id)),d=l.type==="Receipt";return e.jsxs("div",{className:"p-4 pb-20 w-full transition-colors",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden no-print",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black text-[#2d5016] dark:text-[#4a7c59] uppercase tracking-tight flex items-center gap-3 py-1",children:[e.jsx(te,{size:36,className:"text-[#4a7c59]"}),i==="pending"?"ĐƠN CHỜ THANH TOÁN":i==="settlement_history"?"NHẬT KÝ QUYẾT TOÁN":"QUẢN LÝ QUỸ TIỀN"]}),e.jsx("p",{className:"text-[#8b6f47] dark:text-[#d4a574]/60 font-medium tracking-tight",children:i==="pending"?"Đối soát và quyết toán các đơn hàng sỉ đã giao":i==="settlement_history"?"Xem lại lịch sử các đợt quyết toán công nợ":"Thu hoạch và phân bổ ngân sách vụ mùa"})]}),e.jsxs("div",{className:"flex bg-[#d4a574]/10 dark:bg-slate-800/40 p-1.5 rounded-[2rem] border-2 border-[#d4a574]/20 backdrop-blur-md shadow-lg",children:[e.jsx("button",{onClick:()=>R("fund"),className:n("px-6 py-2.5 rounded-[1.5rem] text-[10px] font-black tracking-widest uppercase transition-all duration-300",i==="fund"?"bg-gradient-to-r from-[#2d5016] to-[#4a7c59] text-white shadow-xl":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:"SỔ QUỸ"}),e.jsx("button",{onClick:()=>R("pending"),className:n("px-6 py-2.5 rounded-[1.5rem] text-[10px] font-black tracking-widest uppercase transition-all duration-300",i==="pending"?"bg-gradient-to-r from-[#f4c430] to-[#d4a574] text-white shadow-xl":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:"ĐƠN CHỜ T/T"}),e.jsx("button",{onClick:()=>R("settlement_history"),className:n("px-6 py-2.5 rounded-[1.5rem] text-[10px] font-black tracking-widest uppercase transition-all duration-300",i==="settlement_history"?"bg-gradient-to-r from-[#4a7c59] to-[#8b6f47] text-white shadow-xl":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:"NHẬT KÝ QT"})]})]}),i==="fund"&&e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"flex p-1.5 bg-[#faf8f3]/80 dark:bg-slate-800/60 rounded-[2rem] border-2 border-[#d4a574]/30 backdrop-blur-md shadow-xl overflow-hidden ring-4 ring-[#d4a574]/5",children:[e.jsxs("button",{onClick:()=>b({...l,type:"Receipt"}),className:n("px-10 py-4 rounded-[1.5rem] font-black text-xs transition-all flex items-center gap-2 uppercase tracking-widest duration-500",d?"bg-gradient-to-r from-[#2d5016] to-[#4a7c59] text-white shadow-xl scale-[1.02]":"text-[#8b6f47] hover:bg-[#d4a574]/10"),children:[e.jsx(Q,{size:20,className:d?"animate-bounce":""})," PHIẾU THU VỤ MÙA"]}),e.jsxs("button",{onClick:()=>b({...l,type:"Payment"}),className:n("px-10 py-4 rounded-[1.5rem] font-black text-xs transition-all flex items-center gap-2 uppercase tracking-widest duration-500",d?"text-[#8b6f47] hover:bg-[#d4a574]/10":"bg-gradient-to-r from-[#8b6f47] to-[#d4a574] text-white shadow-xl scale-[1.02]"),children:[e.jsx(U,{size:20,className:d?"":"animate-bounce"})," PHIẾU CHI VỤ MÙA"]})]})})]}),e.jsx("div",{className:"flex justify-center mb-10",children:e.jsxs("div",{className:"flex items-center gap-3 bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl p-3 rounded-[2rem] shadow-xl border-2 border-[#d4a574]/30 ring-8 ring-[#d4a574]/5",children:[e.jsxs("div",{className:"flex items-center px-5 py-2.5 bg-gradient-to-r from-[#2d5016]/10 to-[#4a7c59]/10 rounded-2xl border border-[#d4a574]/20",children:[e.jsx(I,{size:18,className:"text-[#2d5016] dark:text-[#4a7c59] mr-2.5"}),e.jsx("span",{className:"text-[10px] font-black text-[#2d5016] dark:text-[#d4a574] uppercase tracking-[0.2em]",children:"Kỳ thu hoạch"})]}),e.jsxs("div",{className:"flex items-center gap-2.5 px-4 h-10",children:[e.jsxs("select",{value:c.day,onChange:t=>N({...c,day:t.target.value}),className:"bg-transparent border-none outline-none font-black text-xs uppercase cursor-pointer text-[#8b6f47] dark:text-[#d4a574] appearance-none hover:text-[#2d5016] transition-colors",children:[e.jsx("option",{value:"",children:"Ngày"}),[...Array(31)].map((t,a)=>e.jsx("option",{value:a+1,children:a+1},a+1))]}),e.jsx("span",{className:"text-[#d4a574]/40 font-bold",children:"/"}),e.jsxs("select",{value:c.month,onChange:t=>N({...c,month:t.target.value}),className:"bg-transparent border-none outline-none font-black text-xs uppercase cursor-pointer text-[#8b6f47] dark:text-[#d4a574] appearance-none hover:text-[#2d5016] transition-colors",children:[e.jsx("option",{value:"",children:"Tháng"}),[...Array(12)].map((t,a)=>e.jsx("option",{value:a+1,children:a+1},a+1))]}),e.jsx("span",{className:"text-[#d4a574]/40 font-bold",children:"/"}),e.jsxs("select",{value:c.quarter,onChange:t=>N({...c,quarter:t.target.value}),className:"bg-transparent border-none outline-none font-black text-xs uppercase cursor-pointer text-[#8b6f47] dark:text-[#d4a574] appearance-none hover:text-[#2d5016] transition-colors",children:[e.jsx("option",{value:"",children:"Quý"}),e.jsx("option",{value:"1",children:"Q1"}),e.jsx("option",{value:"2",children:"Q2"}),e.jsx("option",{value:"3",children:"Q3"}),e.jsx("option",{value:"4",children:"Q4"})]}),e.jsx("span",{className:"text-[#d4a574]/40 font-bold",children:"/"}),e.jsxs("select",{value:c.year,onChange:t=>N({...c,year:t.target.value}),className:"bg-transparent border-none outline-none font-black text-xs uppercase cursor-pointer text-[#8b6f47] dark:text-[#d4a574] appearance-none hover:text-[#2d5016] transition-colors",children:[e.jsx("option",{value:"",children:"Năm"}),[...Array(5)].map((t,a)=>{const r=new Date().getFullYear()-a;return e.jsx("option",{value:r,children:r},r)})]})]}),e.jsx("button",{onClick:()=>{const t=new Date;N({year:t.getFullYear().toString(),month:(t.getMonth()+1).toString(),day:t.getDate().toString(),quarter:""})},className:"px-5 py-2.5 bg-[#2d5016] text-white text-[10px] font-black uppercase rounded-2xl hover:bg-[#4a7c59] transition-all shadow-lg shadow-[#2d5016]/20 tracking-widest",children:"Hôm nay"}),e.jsx("button",{onClick:()=>N({year:"",month:"",day:"",quarter:""}),className:"p-2.5 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-2xl transition-all",title:"Xóa lọc",children:e.jsx(V,{size:18})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-8 flex flex-col items-center text-emerald-950 dark:text-emerald-50",children:[i==="fund"&&e.jsxs("div",{className:"w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl border-2 border-[#d4a574]/30 p-10 rounded-[3rem] space-y-8 relative overflow-hidden group shadow-2xl",children:[e.jsx("div",{className:"absolute -top-10 -right-10 opacity-10 group-hover:opacity-20 transition-all duration-700 transform group-hover:rotate-12 group-hover:scale-110",children:d?e.jsx(be,{size:240,className:"text-[#4a7c59]"}):e.jsx(ge,{size:240,className:"text-[#8b6f47]"})}),e.jsxs("h2",{className:"text-3xl font-black text-[#2d5016] dark:text-[#4a7c59] flex items-center gap-4 uppercase tracking-tighter relative z-10",children:[e.jsx("div",{className:n("p-1.5 rounded-xl text-white shadow-lg shadow-black/5",d?"bg-[#2d5016]":"bg-[#8b6f47]"),children:e.jsx(fe,{size:24})}),"Tạo ",d?"Phiếu Thu":"Phiếu Chi"," Mới"]}),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsxs("div",{className:"space-y-2",onBlur:()=>setTimeout(()=>w(!1),200),children:[e.jsx("label",{className:"text-[10px] font-black text-emerald-600/50 dark:text-emerald-400/50 uppercase tracking-[0.2em] ml-1",children:"Đối tác vụ mùa"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-5 top-5 text-emerald-500/50",size:24}),e.jsx("input",{type:"text",className:"input-premium w-full p-5 font-black text-lg",style:{paddingLeft:"3.5rem"},placeholder:"Gõ để tìm tên đối tác...",value:g?g.name:P,onChange:t=>{O(t.target.value),l.partner_id&&b({...l,partner_id:""}),w(!0)},onFocus:()=>w(!0)}),g&&e.jsx("button",{onClick:()=>{b({...l,partner_id:""}),O("")},className:"absolute right-5 top-5 text-rose-400 hover:text-rose-600 z-[20]",children:e.jsx(V,{size:24})}),e.jsx(D,{children:ne&&!g&&e.jsx(h.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{type:"spring",stiffness:400,damping:30},className:"dropdown-premium max-h-80 overflow-y-auto no-scrollbar",children:e.jsx(D,{mode:"popLayout",children:G.filter(t=>(t.name||"").toLowerCase().includes(P.toLowerCase())||t.phone?.includes(P)).sort((t,a)=>(t.name||"").localeCompare(a.name||"","vi",{sensitivity:"base"})).map((t,a)=>e.jsxs(h.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.9},transition:{delay:a*.02,duration:.15},onClick:()=>{b({...l,partner_id:t.id.toString()}),w(!1)},className:"dropdown-item p-5",children:[e.jsxs("div",{className:"font-black text-gray-800 dark:text-emerald-50 uppercase tracking-tight flex justify-between items-center transition-colors",children:[e.jsx("span",{children:t.name}),e.jsxs("div",{className:"flex gap-1",children:[t.is_customer&&e.jsx("span",{className:"text-[9px] px-2.5 py-1 rounded-lg bg-emerald-100/50 text-emerald-600 font-black tracking-widest uppercase",children:"Khách"}),t.is_supplier&&e.jsx("span",{className:"text-[9px] px-2.5 py-1 rounded-lg bg-amber-100/50 text-amber-600 font-black tracking-widest uppercase",children:"NCC"})]})]}),e.jsxs("div",{className:"text-[10px] font-black text-gray-400 mt-2 uppercase flex gap-4 transition-colors",children:[e.jsx("span",{children:t.phone||"Không sđt"}),e.jsx("span",{className:"text-amber-500",children:ee(t.debt_balance)})]})]},t.id))})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-emerald-600/50 dark:text-emerald-400/50 uppercase tracking-[0.2em] ml-1",children:"Số tiền kết quả (VNĐ)"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:n("absolute left-5 top-6 z-10",d?"text-emerald-400":"text-rose-400"),size:28}),e.jsx("input",{type:"text",className:n("input-premium w-full pl-16 p-6 font-black text-5xl text-right",d?"text-emerald-600 dark:text-emerald-400 focus:border-emerald-500":"text-rose-600 dark:text-rose-400 focus:border-rose-500 shadow-rose-500/10 focus:shadow-rose-500/20"),placeholder:"0",value:y(l.amount),onChange:t=>b({...l,amount:parseFloat(t.target.value.replace(/,/g,""))||0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-[#8b6f47] dark:text-[#d4a574]/60 uppercase tracking-[0.3em] ml-2",children:"Ghi chú vụ mùa"}),e.jsxs("div",{className:"relative group",children:[e.jsx(E,{className:"absolute left-6 top-6 text-[#d4a574]/40 group-focus-within:text-[#4a7c59] transition-colors",size:24}),e.jsx("textarea",{className:"w-full bg-white/40 dark:bg-slate-800/40 border-2 border-[#d4a574]/20 focus:border-[#4a7c59] dark:focus:border-[#4a7c59] rounded-[2rem] p-6 pl-16 font-bold h-32 resize-none placeholder:text-[#d4a574]/30 dark:placeholder:text-[#d4a574]/20 outline-none transition-all shadow-sm focus:shadow-xl dark:text-white",placeholder:d?"Mô tả nội dung thu hoạch...":"Mô tả mục đích phân bổ...",value:l.note,onChange:t=>b({...l,note:t.target.value})})]})]}),e.jsxs("button",{disabled:k,onClick:ce,className:n("w-full bg-gradient-to-r text-white py-6 rounded-[2.5rem] font-black text-xl flex flex-col items-center justify-center transition-all shadow-2xl active:scale-95 disabled:opacity-50 uppercase tracking-[0.2em] relative overflow-hidden group/btn",d?"from-[#2d5016] to-[#4a7c59] shadow-[#2d5016]/20":"from-[#8b6f47] to-[#d4a574] shadow-[#8b6f47]/20"),children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-500"}),e.jsxs("div",{className:"relative z-10 flex items-center gap-4",children:[k?e.jsx(je,{className:"animate-spin",size:24}):e.jsx(Ne,{size:24}),k?"ĐANG XỬ LÝ...":`XÁC NHẬN PHIẾU ${d?"THU":"CHI"}`]})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[g&&e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:n("text-white p-10 rounded-[3.5rem] shadow-2xl transition-all duration-700 flex flex-col justify-between relative overflow-hidden",d?"bg-gradient-to-br from-emerald-500 to-[#065f46]":"bg-gradient-to-br from-rose-500 to-rose-900"),children:[e.jsx("div",{className:"absolute -bottom-10 -right-10 opacity-10",children:e.jsx(te,{size:240})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"text-[10px] font-black opacity-60 uppercase tracking-[0.5em] mb-3",children:"Số dư công nợ hiện tại"}),e.jsx("div",{className:"text-4xl font-black tracking-tighter mb-8 font-mono",children:ee(g.debt_balance)}),e.jsxs("div",{className:"pt-8 border-t border-white/20 flex flex-col gap-2",children:[e.jsx("div",{className:"font-black text-xl uppercase tracking-tighter",children:g.name}),e.jsx("div",{className:"text-sm font-bold opacity-60 tracking-widest",children:g.phone||"CHƯA CẬP NHẬT SỐ ĐIỆN THOẠI"})]})]})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl border-2 border-[#d4a574]/30 p-8 rounded-[3rem] flex-1 overflow-hidden transition-colors flex flex-col max-h-[600px] shadow-2xl",children:[e.jsxs("h3",{className:"text-[10px] font-black text-[#8b6f47] dark:text-[#d4a574]/60 uppercase mb-8 flex items-center gap-2 tracking-[0.4em] ml-2",children:[e.jsx(S,{size:16,className:"text-[#4a7c59]"})," LỊCH SỬ GIAO DỊCH QUỸ"]}),e.jsxs("div",{className:"space-y-4 overflow-y-auto pr-2 no-scrollbar",children:[(Array.isArray(f)?f:[]).map((t,a)=>e.jsxs(h.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:a*.03},className:n("p-5 rounded-3xl border flex justify-between items-center group transition-all",t.source==="auto"?"bg-slate-50 dark:bg-slate-900 border-slate-100 dark:border-slate-800":"bg-emerald-50/20 dark:bg-emerald-950/20 border-emerald-50 dark:border-emerald-900/30 hover:bg-white dark:hover:bg-slate-800"),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:n("w-12 h-12 rounded-2xl flex items-center justify-center text-white shadow-lg relative",t.type==="Receipt"?"bg-emerald-500":"bg-rose-500"),children:[t.type==="Receipt"?e.jsx(Q,{size:20}):e.jsx(U,{size:20}),t.source==="auto"&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-blue-500 border-2 border-white flex items-center justify-center",children:e.jsx("span",{className:"text-[6px] font-bold",children:"A"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-black text-gray-800 dark:text-emerald-50 text-sm uppercase tracking-tight",children:t.partner_name}),t.source==="auto"&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-blue-100/50 text-blue-600 font-bold uppercase tracking-wide",children:t.order_display_id?`Từ đơn hàng #${t.order_display_id}`:"Từ đơn hàng"})]}),e.jsx("div",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest mt-1",children:M(t.date)}),e.jsx("div",{className:"text-[10px] text-emerald-600/60 dark:text-emerald-400/40 mt-1 font-bold italic line-clamp-1",children:t.note||"Không có ghi chú"})]})]}),e.jsxs("div",{className:"text-right flex items-center gap-4",children:[e.jsxs("div",{className:n("font-black text-lg tracking-tighter",t.type==="Receipt"?"text-emerald-600":"text-rose-600"),children:[t.type==="Receipt"?"+":"-",y(t.amount)]}),t.source!=="auto"&&e.jsx("button",{onClick:()=>Z(t.id,t.source),className:"p-2.5 text-gray-200 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-xl transition-all opacity-0 group-hover:opacity-100",title:"Xóa phiếu",children:e.jsx(ae,{size:18})})]})]},t.id)),(!f||f.length===0)&&e.jsx("div",{className:"p-20 text-center text-emerald-600/20 font-black uppercase text-xs tracking-widest",children:"Chưa có giao dịch quỹ"})]})]})]})]}),i==="pending"&&e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-6xl",children:e.jsxs("div",{className:"bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl border-2 border-[#d4a574]/30 p-10 rounded-[3rem] shadow-2xl relative overflow-hidden",children:[e.jsxs("h2",{className:"text-3xl font-black text-amber-600 uppercase mb-10 flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-amber-500 rounded-2xl text-white shadow-lg shadow-amber-500/20",children:e.jsx(S,{size:28})}),"Danh sách đơn chờ quyết toán"]}),e.jsxs("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:[K.map((t,a)=>e.jsxs(h.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"p-8 rounded-[2.5rem] border-2 border-amber-100 dark:border-amber-900/10 bg-white/40 dark:bg-slate-800/40 hover:border-amber-400/50 transition-all flex flex-col md:flex-row justify-between items-center group gap-6",children:[e.jsxs("div",{className:"flex items-center gap-8 w-full md:w-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100/50 dark:bg-amber-900/40 rounded-3xl flex items-center justify-center text-amber-600 shadow-inner shrink-0",children:e.jsx(E,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-black text-gray-400 text-xs tracking-widest",children:["#",t.display_id]}),e.jsx("span",{className:n("px-3 py-1 rounded-lg text-[9px] font-black uppercase tracking-[0.2em] shadow-sm",t.type==="Sale"?"bg-emerald-500 text-white":"bg-rose-500 text-white"),children:t.type==="Sale"?"BÁN HÀNG":"NHẬP HÀNG"})]}),e.jsx("div",{className:"font-black text-gray-900 dark:text-emerald-50 text-2xl uppercase mt-1 tracking-tight transition-colors",children:t.partner_name}),e.jsxs("div",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-1 flex items-center gap-2",children:[e.jsx(I,{size:12})," ",M(t.date)]})]})]}),e.jsxs("div",{className:"flex items-center gap-10 w-full md:w-auto justify-between md:justify-end",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"Tổng tiền đơn"}),e.jsx("div",{className:"font-black text-3xl text-amber-600 tracking-tighter",children:y(t.total_amount)})]}),e.jsx("button",{onClick:()=>{Y(t),B(t.total_amount),W(""),z(!0)},className:"bg-gradient-to-r from-amber-500 to-amber-600 text-white px-10 py-5 rounded-[2rem] font-black uppercase text-xs tracking-widest hover:scale-105 active:scale-95 transition-all shadow-xl shadow-amber-500/20",children:"QUYẾT TOÁN"})]})]},t.id)),K.length===0&&e.jsxs("div",{className:"p-32 text-center flex flex-col items-center gap-6 text-gray-300",children:[e.jsx(S,{size:80,className:"opacity-10"}),e.jsx("div",{className:"font-black uppercase tracking-[0.4em] text-sm",children:"Không có đơn hàng chờ quyết toán"})]})]})]})}),i==="settlement_history"&&e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-6xl",children:e.jsxs("div",{className:"bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl border-2 border-[#d4a574]/30 p-10 rounded-[3.5rem] shadow-2xl relative overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6",children:[e.jsxs("h2",{className:"text-3xl font-black text-[#4a7c59] uppercase flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-[#4a7c59] rounded-2xl text-white shadow-lg shadow-[#4a7c59]/20",children:e.jsx(S,{size:28})}),"Nhật ký quyết toán công nợ"]}),e.jsxs("div",{className:"px-6 py-3 bg-[#4a7c59]/10 rounded-2xl border border-[#4a7c59]/20",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mr-2",children:"Tổng nhật ký:"}),e.jsx("span",{className:"text-2xl font-black text-[#4a7c59] tracking-tighter",children:f.length})]})]}),e.jsxs("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:[f.map((t,a)=>e.jsxs(h.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"p-8 rounded-[2.5rem] bg-white/40 dark:bg-slate-800/40 border-2 border-[#d4a574]/10 hover:border-[#4a7c59]/50 transition-all flex flex-col md:flex-row justify-between items-center group gap-6",children:[e.jsxs("div",{className:"flex items-center gap-8 w-full md:w-auto",children:[e.jsx("div",{className:n("w-16 h-16 rounded-3xl flex items-center justify-center shadow-lg transform group-hover:rotate-6 transition-transform",t.type==="Receipt"?"bg-gradient-to-br from-emerald-500 to-[#065f46] text-white":"bg-gradient-to-br from-rose-500 to-rose-900 text-white"),children:t.type==="Receipt"?e.jsx(Q,{size:32}):e.jsx(U,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-black text-2xl uppercase tracking-tighter text-gray-900 dark:text-emerald-50",children:t.partner_name}),e.jsxs("span",{className:"text-[9px] bg-blue-100/50 text-blue-600 px-3 py-1 rounded-full font-black uppercase tracking-widest",children:["ĐƠN #",t.order_display_id||"N/A"]})]}),e.jsxs("div",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest mt-1 flex items-center gap-2",children:[e.jsx(I,{size:12})," ",M(t.date)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2 italic line-clamp-1",children:t.note})]})]}),e.jsxs("div",{className:"flex items-center gap-10 w-full md:w-auto justify-between md:justify-end",children:[e.jsxs("div",{className:n("text-3xl font-black tracking-tighter",t.type==="Receipt"?"text-emerald-600":"text-rose-600"),children:[t.type==="Receipt"?"+":"-",y(t.amount)]}),e.jsx("button",{onClick:()=>Z(t.id,t.source),className:"p-4 bg-rose-50 dark:bg-rose-950/20 text-rose-300 hover:text-rose-500 rounded-2xl transition-all opacity-0 group-hover:opacity-100",title:"Xóa quyết toán",children:e.jsx(ae,{size:24})})]})]},t.id)),f.length===0&&e.jsxs("div",{className:"p-32 text-center flex flex-col items-center gap-6 text-gray-300",children:[e.jsx(S,{size:80}),e.jsx("div",{className:"font-black uppercase tracking-[0.4em] text-sm",children:"Chưa có dữ liệu quyết toán"})]})]})]})})]}),e.jsx(D,{children:le&&o&&e.jsx(me,{children:e.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:e.jsxs(h.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"bg-white dark:bg-slate-900 w-full max-w-lg rounded-[3rem] shadow-[0_32px_128px_-16px_rgba(0,0,0,0.5)] overflow-hidden border-2 border-[#f4c430]/30",children:[e.jsxs("div",{className:"p-10 border-b-2 border-[#f4c430]/10 bg-gradient-to-r from-amber-50 to-white dark:from-amber-950/20 dark:to-slate-900 flex justify-between items-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-10 opacity-5 pointer-events-none",children:e.jsx(A,{size:120,className:"text-amber-500"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h2",{className:"text-2xl font-black text-amber-600 uppercase tracking-tighter flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-amber-500 rounded-2xl text-white shadow-lg shadow-amber-500/30",children:e.jsx(A,{size:28})}),"QUYẾT TOÁN VỤ MÙA"]}),e.jsxs("div",{className:"text-[10px] font-black text-amber-500/60 uppercase tracking-[0.3em] mt-3",children:["Đơn #",o.display_id," • ",o.partner_name]})]}),e.jsx("button",{onClick:()=>z(!1),className:"p-4 hover:bg-amber-100 dark:hover:bg-amber-900/40 rounded-3xl transition-all relative z-10 text-amber-600",children:e.jsx(V,{size:32})})]}),e.jsxs("div",{className:"p-10 space-y-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-[11px] font-black text-gray-400 uppercase tracking-[0.4em] ml-2 font-mono",children:["Số tiền thực ",o.type==="Sale"?"nhận":"trả"]}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-6 top-8 text-amber-500/40",size:32}),e.jsx("input",{type:"text",className:"w-full pl-16 p-8 bg-amber-50/30 dark:bg-slate-800/50 border-2 border-transparent focus:border-amber-500 rounded-[2.5rem] outline-none font-black text-5xl text-right transition-all shadow-inner dark:text-white",value:y(v),onChange:t=>B(parseFloat(t.target.value.replace(/,/g,""))||0),onFocus:t=>t.target.select()})]}),e.jsxs("div",{className:"flex justify-between items-center p-6 bg-amber-50/50 dark:bg-amber-950/20 rounded-3xl border-2 border-amber-100/50 dark:border-amber-900/30",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1",children:"TỔNG ĐƠN"}),e.jsx("div",{className:"font-black text-xl text-gray-700 dark:text-gray-200",children:y(o.total_amount)})]}),e.jsx("div",{className:"w-px h-10 bg-amber-200 dark:bg-amber-800"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1",children:"CÒN LẠI (NỢ)"}),e.jsx("div",{className:n("font-black text-2xl tracking-tighter",v<o.total_amount?"text-rose-500":"text-emerald-500"),children:y(Math.max(0,o.total_amount-v))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[11px] font-black text-gray-400 uppercase tracking-[0.4em] ml-2 font-mono",children:"Ghi chú bút lục"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-6 top-6 text-amber-500/40",size:24}),e.jsx("textarea",{className:"w-full pl-16 p-6 bg-amber-50/30 dark:bg-slate-800/50 border-2 border-transparent focus:border-amber-500 rounded-[2.5rem] outline-none font-bold h-32 resize-none transition-all shadow-inner dark:text-white",placeholder:"Ghi chú thêm nếu có...",value:C,onChange:t=>W(t.target.value)})]})]}),e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx("button",{onClick:()=>z(!1),className:"flex-1 px-8 py-6 rounded-[2rem] font-black text-gray-400 uppercase text-xs tracking-widest hover:bg-gray-100 transition-all",children:"Hủy bỏ"}),e.jsx("button",{onClick:oe,disabled:k,className:"flex-[2] bg-gradient-to-r from-amber-500 to-amber-600 text-white px-8 py-6 rounded-[2rem] font-black uppercase text-sm tracking-widest hover:shadow-2xl shadow-amber-500/40 active:scale-95 transition-all disabled:opacity-50",children:k?"ĐANG XỬ LÝ...":"XÁC NHẬN KẾT TOÁN"})]})]})]})})})}),e.jsx(D,{children:q&&e.jsx(he,{message:q.message,type:q.type,onClose:()=>x(null)})}),j&&e.jsx(ue,{isOpen:!!j,title:j.title,message:j.message,onConfirm:j.onConfirm,onCancel:()=>L(null),type:j.type})]})}export{He as default};
